{
  "schema_version": "1.0.0",
  "spectrometer_version": "V12.2",
  "generated_at": "2025-12-23T10:08:48.958047",
  "analysis_time_ms": 149,
  "target_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code",
  "target_name": "cosmicpython__code",
  "target_type": "directory",
  "nodes": [
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py:in_memory_sqlite_db",
      "name": "in_memory_sqlite_db",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py",
      "start_line": 21,
      "end_line": 24,
      "role": "Configuration",
      "role_confidence": 99.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [
        "pytest.fixture"
      ],
      "docstring": "",
      "signature": "def in_memory_sqlite_db():",
      "body_source": "def in_memory_sqlite_db():\n    engine = create_engine(\"sqlite:///:memory:\")\n    metadata.create_all(engine)\n    return engine",
      "complexity": 0,
      "lines_of_code": 3,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py:sqlite_session_factory",
      "name": "sqlite_session_factory",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py",
      "start_line": 28,
      "end_line": 29,
      "role": "Configuration",
      "role_confidence": 99.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "in_memory_sqlite_db"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [
        "pytest.fixture"
      ],
      "docstring": "",
      "signature": "def sqlite_session_factory(in_memory_sqlite_db):",
      "body_source": "def sqlite_session_factory(in_memory_sqlite_db):\n    yield sessionmaker(bind=in_memory_sqlite_db)",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py:mappers",
      "name": "mappers",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py",
      "start_line": 33,
      "end_line": 36,
      "role": "Configuration",
      "role_confidence": 99.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [
        "pytest.fixture"
      ],
      "docstring": "",
      "signature": "def mappers():",
      "body_source": "def mappers():\n    start_mappers()\n    yield\n    clear_mappers()",
      "complexity": 0,
      "lines_of_code": 3,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py:wait_for_postgres_to_come_up",
      "name": "wait_for_postgres_to_come_up",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py",
      "start_line": 40,
      "end_line": 41,
      "role": "Test",
      "role_confidence": 80.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "engine"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [
        "retry"
      ],
      "docstring": "",
      "signature": "def wait_for_postgres_to_come_up(engine):",
      "body_source": "def wait_for_postgres_to_come_up(engine):\n    return engine.connect()",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py:wait_for_webapp_to_come_up",
      "name": "wait_for_webapp_to_come_up",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py",
      "start_line": 45,
      "end_line": 46,
      "role": "Test",
      "role_confidence": 80.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [
        "retry"
      ],
      "docstring": "",
      "signature": "def wait_for_webapp_to_come_up():",
      "body_source": "def wait_for_webapp_to_come_up():\n    return requests.get(config.get_api_url())",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py:wait_for_redis_to_come_up",
      "name": "wait_for_redis_to_come_up",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py",
      "start_line": 50,
      "end_line": 52,
      "role": "Test",
      "role_confidence": 80.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [
        "retry"
      ],
      "docstring": "",
      "signature": "def wait_for_redis_to_come_up():",
      "body_source": "def wait_for_redis_to_come_up():\n    r = redis.Redis(**config.get_redis_host_and_port())\n    return r.ping()",
      "complexity": 0,
      "lines_of_code": 2,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py:postgres_db",
      "name": "postgres_db",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py",
      "start_line": 56,
      "end_line": 60,
      "role": "Configuration",
      "role_confidence": 99.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [
        "pytest.fixture"
      ],
      "docstring": "",
      "signature": "def postgres_db():",
      "body_source": "def postgres_db():\n    engine = create_engine(config.get_postgres_uri(), isolation_level=\"SERIALIZABLE\")\n    wait_for_postgres_to_come_up(engine)\n    metadata.create_all(engine)\n    return engine",
      "complexity": 0,
      "lines_of_code": 4,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py:postgres_session_factory",
      "name": "postgres_session_factory",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py",
      "start_line": 64,
      "end_line": 65,
      "role": "Configuration",
      "role_confidence": 99.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "postgres_db"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [
        "pytest.fixture"
      ],
      "docstring": "",
      "signature": "def postgres_session_factory(postgres_db):",
      "body_source": "def postgres_session_factory(postgres_db):\n    yield sessionmaker(bind=postgres_db)",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py:postgres_session",
      "name": "postgres_session",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py",
      "start_line": 69,
      "end_line": 70,
      "role": "Configuration",
      "role_confidence": 99.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "postgres_session_factory"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [
        "pytest.fixture"
      ],
      "docstring": "",
      "signature": "def postgres_session(postgres_session_factory):",
      "body_source": "def postgres_session(postgres_session_factory):\n    return postgres_session_factory()",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py:restart_api",
      "name": "restart_api",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py",
      "start_line": 74,
      "end_line": 77,
      "role": "Configuration",
      "role_confidence": 99.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [
        "pytest.fixture"
      ],
      "docstring": "",
      "signature": "def restart_api():",
      "body_source": "def restart_api():\n    (Path(__file__).parent / \"../src/allocation/entrypoints/flask_app.py\").touch()\n    time.sleep(0.5)\n    wait_for_webapp_to_come_up()",
      "complexity": 0,
      "lines_of_code": 3,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py:restart_redis_pubsub",
      "name": "restart_redis_pubsub",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py",
      "start_line": 81,
      "end_line": 89,
      "role": "Configuration",
      "role_confidence": 99.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [
        "pytest.fixture"
      ],
      "docstring": "",
      "signature": "def restart_redis_pubsub():",
      "body_source": "def restart_redis_pubsub():\n    wait_for_redis_to_come_up()\n    if not shutil.which(\"docker-compose\"):\n        print(\"skipping restart, assumes running in container\")\n        return\n    subprocess.run(\n        [\"docker-compose\", \"restart\", \"-t\", \"0\", \"redis_pubsub\"],\n        check=True,\n    )",
      "complexity": 0,
      "lines_of_code": 8,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/random_refs.py:random_suffix",
      "name": "random_suffix",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/random_refs.py",
      "start_line": 4,
      "end_line": 5,
      "role": "Utility",
      "role_confidence": 60.0,
      "discovery_method": "heuristic_pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def random_suffix():",
      "body_source": "def random_suffix():\n    return uuid.uuid4().hex[:6]",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/random_refs.py:random_sku",
      "name": "random_sku",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/random_refs.py",
      "start_line": 8,
      "end_line": 9,
      "role": "Utility",
      "role_confidence": 60.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "name",
          "default": "''"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def random_sku(name=\"\"):",
      "body_source": "def random_sku(name=\"\"):\n    return f\"sku-{name}-{random_suffix()}\"",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/random_refs.py:random_batchref",
      "name": "random_batchref",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/random_refs.py",
      "start_line": 12,
      "end_line": 13,
      "role": "Query",
      "role_confidence": 70.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "name",
          "default": "''"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def random_batchref(name=\"\"):",
      "body_source": "def random_batchref(name=\"\"):\n    return f\"batch-{name}-{random_suffix()}\"",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/random_refs.py:random_orderid",
      "name": "random_orderid",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/random_refs.py",
      "start_line": 16,
      "end_line": 17,
      "role": "Query",
      "role_confidence": 75.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "name",
          "default": "''"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def random_orderid(name=\"\"):",
      "body_source": "def random_orderid(name=\"\"):\n    return f\"order-{name}-{random_suffix()}\"",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py:FakeRepository",
      "name": "FakeRepository",
      "kind": "class",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
      "start_line": 14,
      "end_line": 14,
      "role": "Repository",
      "role_confidence": 99.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [
        "AbstractRepository"
      ],
      "decorators": [],
      "docstring": "",
      "signature": "class FakeRepository(repository.AbstractRepository):",
      "body_source": "",
      "complexity": 0,
      "lines_of_code": 0,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py:FakeRepository.__init__",
      "name": "FakeRepository.__init__",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
      "start_line": 15,
      "end_line": 17,
      "role": "ApplicationService",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "products"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def __init__(self, products):",
      "body_source": "    def __init__(self, products):\n        super().__init__()\n        self._products = set(products)",
      "complexity": 0,
      "lines_of_code": 2,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py:FakeRepository._add",
      "name": "FakeRepository._add",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
      "start_line": 19,
      "end_line": 20,
      "role": "Internal",
      "role_confidence": 70.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "product"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def _add(self, product):",
      "body_source": "    def _add(self, product):\n        self._products.add(product)",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py:FakeRepository._get",
      "name": "FakeRepository._get",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
      "start_line": 22,
      "end_line": 23,
      "role": "Query",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "sku"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def _get(self, sku):",
      "body_source": "    def _get(self, sku):\n        return next((p for p in self._products if p.sku == sku), None)",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py:FakeRepository._get_by_batchref",
      "name": "FakeRepository._get_by_batchref",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
      "start_line": 25,
      "end_line": 29,
      "role": "Query",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "batchref"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def _get_by_batchref(self, batchref):",
      "body_source": "    def _get_by_batchref(self, batchref):\n        return next(\n            (p for p in self._products for b in p.batches if b.reference == batchref),\n            None,\n        )",
      "complexity": 0,
      "lines_of_code": 4,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py:FakeUnitOfWork",
      "name": "FakeUnitOfWork",
      "kind": "class",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
      "start_line": 32,
      "end_line": 32,
      "role": "Test",
      "role_confidence": 80.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [
        "AbstractUnitOfWork"
      ],
      "decorators": [],
      "docstring": "",
      "signature": "class FakeUnitOfWork(unit_of_work.AbstractUnitOfWork):",
      "body_source": "",
      "complexity": 0,
      "lines_of_code": 0,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py:FakeUnitOfWork.__init__",
      "name": "FakeUnitOfWork.__init__",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
      "start_line": 33,
      "end_line": 35,
      "role": "ApplicationService",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def __init__(self):",
      "body_source": "    def __init__(self):\n        self.products = FakeRepository([])\n        self.committed = False",
      "complexity": 0,
      "lines_of_code": 2,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py:FakeUnitOfWork._commit",
      "name": "FakeUnitOfWork._commit",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
      "start_line": 37,
      "end_line": 38,
      "role": "Command",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def _commit(self):",
      "body_source": "    def _commit(self):\n        self.committed = True",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py:FakeUnitOfWork.rollback",
      "name": "FakeUnitOfWork.rollback",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
      "start_line": 40,
      "end_line": 41,
      "role": "Utility",
      "role_confidence": 60.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "self"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def rollback(self):",
      "body_source": "    def rollback(self):\n        pass",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py:FakeNotifications",
      "name": "FakeNotifications",
      "kind": "class",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
      "start_line": 44,
      "end_line": 44,
      "role": "Test",
      "role_confidence": 80.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [
        "AbstractNotifications"
      ],
      "decorators": [],
      "docstring": "",
      "signature": "class FakeNotifications(notifications.AbstractNotifications):",
      "body_source": "",
      "complexity": 0,
      "lines_of_code": 0,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py:FakeNotifications.__init__",
      "name": "FakeNotifications.__init__",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
      "start_line": 45,
      "end_line": 46,
      "role": "ApplicationService",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def __init__(self):",
      "body_source": "    def __init__(self):\n        self.sent = defaultdict(list)  # type: Dict[str, List[str]]",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py:FakeNotifications.send",
      "name": "FakeNotifications.send",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
      "start_line": 48,
      "end_line": 49,
      "role": "Command",
      "role_confidence": 75.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "destination"
        },
        {
          "name": "message"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def send(self, destination, message):",
      "body_source": "    def send(self, destination, message):\n        self.sent[destination].append(message)",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py:bootstrap_test_app",
      "name": "bootstrap_test_app",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
      "start_line": 52,
      "end_line": 58,
      "role": "ApplicationService",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def bootstrap_test_app():",
      "body_source": "def bootstrap_test_app():\n    return bootstrap.bootstrap(\n        start_orm=False,\n        uow=FakeUnitOfWork(),\n        notifications=FakeNotifications(),\n        publish=lambda *args: None,\n    )",
      "complexity": 0,
      "lines_of_code": 6,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py:TestAddBatch",
      "name": "TestAddBatch",
      "kind": "class",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
      "start_line": 61,
      "end_line": 61,
      "role": "Test",
      "role_confidence": 80.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "class TestAddBatch:",
      "body_source": "",
      "complexity": 0,
      "lines_of_code": 0,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py:TestAddBatch.test_for_new_product",
      "name": "TestAddBatch.test_for_new_product",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
      "start_line": 62,
      "end_line": 66,
      "role": "Test",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def test_for_new_product(self):",
      "body_source": "    def test_for_new_product(self):\n        bus = bootstrap_test_app()\n        bus.handle(commands.CreateBatch(\"b1\", \"CRUNCHY-ARMCHAIR\", 100, None))\n        assert bus.uow.products.get(\"CRUNCHY-ARMCHAIR\") is not None\n        assert bus.uow.committed",
      "complexity": 0,
      "lines_of_code": 4,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py:TestAddBatch.test_for_existing_product",
      "name": "TestAddBatch.test_for_existing_product",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
      "start_line": 68,
      "end_line": 74,
      "role": "Test",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def test_for_existing_product(self):",
      "body_source": "    def test_for_existing_product(self):\n        bus = bootstrap_test_app()\n        bus.handle(commands.CreateBatch(\"b1\", \"GARISH-RUG\", 100, None))\n        bus.handle(commands.CreateBatch(\"b2\", \"GARISH-RUG\", 99, None))\n        assert \"b2\" in [\n            b.reference for b in bus.uow.products.get(\"GARISH-RUG\").batches\n        ]",
      "complexity": 0,
      "lines_of_code": 6,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py:TestAllocate",
      "name": "TestAllocate",
      "kind": "class",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
      "start_line": 77,
      "end_line": 77,
      "role": "Test",
      "role_confidence": 80.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "class TestAllocate:",
      "body_source": "",
      "complexity": 0,
      "lines_of_code": 0,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py:TestAllocate.test_allocates",
      "name": "TestAllocate.test_allocates",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
      "start_line": 78,
      "end_line": 83,
      "role": "Test",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def test_allocates(self):",
      "body_source": "    def test_allocates(self):\n        bus = bootstrap_test_app()\n        bus.handle(commands.CreateBatch(\"batch1\", \"COMPLICATED-LAMP\", 100, None))\n        bus.handle(commands.Allocate(\"o1\", \"COMPLICATED-LAMP\", 10))\n        [batch] = bus.uow.products.get(\"COMPLICATED-LAMP\").batches\n        assert batch.available_quantity == 90",
      "complexity": 0,
      "lines_of_code": 5,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py:TestAllocate.test_errors_for_invalid_sku",
      "name": "TestAllocate.test_errors_for_invalid_sku",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
      "start_line": 85,
      "end_line": 90,
      "role": "Test",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def test_errors_for_invalid_sku(self):",
      "body_source": "    def test_errors_for_invalid_sku(self):\n        bus = bootstrap_test_app()\n        bus.handle(commands.CreateBatch(\"b1\", \"AREALSKU\", 100, None))\n\n        with pytest.raises(handlers.InvalidSku, match=\"Invalid sku NONEXISTENTSKU\"):\n            bus.handle(commands.Allocate(\"o1\", \"NONEXISTENTSKU\", 10))",
      "complexity": 0,
      "lines_of_code": 5,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py:TestAllocate.test_commits",
      "name": "TestAllocate.test_commits",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
      "start_line": 92,
      "end_line": 96,
      "role": "Test",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def test_commits(self):",
      "body_source": "    def test_commits(self):\n        bus = bootstrap_test_app()\n        bus.handle(commands.CreateBatch(\"b1\", \"OMINOUS-MIRROR\", 100, None))\n        bus.handle(commands.Allocate(\"o1\", \"OMINOUS-MIRROR\", 10))\n        assert bus.uow.committed",
      "complexity": 0,
      "lines_of_code": 4,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py:TestAllocate.test_sends_email_on_out_of_stock_error",
      "name": "TestAllocate.test_sends_email_on_out_of_stock_error",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
      "start_line": 98,
      "end_line": 110,
      "role": "Observer",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def test_sends_email_on_out_of_stock_error(self):",
      "body_source": "    def test_sends_email_on_out_of_stock_error(self):\n        fake_notifs = FakeNotifications()\n        bus = bootstrap.bootstrap(\n            start_orm=False,\n            uow=FakeUnitOfWork(),\n            notifications=fake_notifs,\n            publish=lambda *args: None,\n        )\n        bus.handle(commands.CreateBatch(\"b1\", \"POPULAR-CURTAINS\", 9, None))\n        bus.handle(commands.Allocate(\"o1\", \"POPULAR-CURTAINS\", 10))\n        assert fake_notifs.sent[\"stock@made.com\"] == [\n            f\"Out of stock for POPULAR-CURTAINS\",\n        ]",
      "complexity": 0,
      "lines_of_code": 12,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py:TestChangeBatchQuantity",
      "name": "TestChangeBatchQuantity",
      "kind": "class",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
      "start_line": 113,
      "end_line": 113,
      "role": "Test",
      "role_confidence": 80.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "class TestChangeBatchQuantity:",
      "body_source": "",
      "complexity": 0,
      "lines_of_code": 0,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py:TestChangeBatchQuantity.test_changes_available_quantity",
      "name": "TestChangeBatchQuantity.test_changes_available_quantity",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
      "start_line": 114,
      "end_line": 121,
      "role": "Test",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def test_changes_available_quantity(self):",
      "body_source": "    def test_changes_available_quantity(self):\n        bus = bootstrap_test_app()\n        bus.handle(commands.CreateBatch(\"batch1\", \"ADORABLE-SETTEE\", 100, None))\n        [batch] = bus.uow.products.get(sku=\"ADORABLE-SETTEE\").batches\n        assert batch.available_quantity == 100\n\n        bus.handle(commands.ChangeBatchQuantity(\"batch1\", 50))\n        assert batch.available_quantity == 50",
      "complexity": 0,
      "lines_of_code": 7,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py:TestChangeBatchQuantity.test_reallocates_if_necessary",
      "name": "TestChangeBatchQuantity.test_reallocates_if_necessary",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
      "start_line": 123,
      "end_line": 142,
      "role": "Test",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def test_reallocates_if_necessary(self):",
      "body_source": "    def test_reallocates_if_necessary(self):\n        bus = bootstrap_test_app()\n        history = [\n            commands.CreateBatch(\"batch1\", \"INDIFFERENT-TABLE\", 50, None),\n            commands.CreateBatch(\"batch2\", \"INDIFFERENT-TABLE\", 50, date.today()),\n            commands.Allocate(\"order1\", \"INDIFFERENT-TABLE\", 20),\n            commands.Allocate(\"order2\", \"INDIFFERENT-TABLE\", 20),\n        ]\n        for msg in history:\n            bus.handle(msg)\n        [batch1, batch2] = bus.uow.products.get(sku=\"INDIFFERENT-TABLE\").batches\n        assert batch1.available_quantity == 10\n        assert batch2.available_quantity == 50\n\n        bus.handle(commands.ChangeBatchQuantity(\"batch1\", 25))\n\n        # order1 or order2 will be deallocated, so we'll have 25 - 20\n        assert batch1.available_quantity == 5\n        # and 20 will be reallocated to the next batch\n        assert batch2.available_quantity == 30",
      "complexity": 0,
      "lines_of_code": 19,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_product.py:test_prefers_warehouse_batches_to_shipments",
      "name": "test_prefers_warehouse_batches_to_shipments",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_product.py",
      "start_line": 11,
      "end_line": 20,
      "role": "Test",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def test_prefers_warehouse_batches_to_shipments():",
      "body_source": "def test_prefers_warehouse_batches_to_shipments():\n    in_stock_batch = Batch(\"in-stock-batch\", \"RETRO-CLOCK\", 100, eta=None)\n    shipment_batch = Batch(\"shipment-batch\", \"RETRO-CLOCK\", 100, eta=tomorrow)\n    product = Product(sku=\"RETRO-CLOCK\", batches=[in_stock_batch, shipment_batch])\n    line = OrderLine(\"oref\", \"RETRO-CLOCK\", 10)\n\n    product.allocate(line)\n\n    assert in_stock_batch.available_quantity == 90\n    assert shipment_batch.available_quantity == 100",
      "complexity": 0,
      "lines_of_code": 9,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_product.py:test_prefers_earlier_batches",
      "name": "test_prefers_earlier_batches",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_product.py",
      "start_line": 23,
      "end_line": 34,
      "role": "Test",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def test_prefers_earlier_batches():",
      "body_source": "def test_prefers_earlier_batches():\n    earliest = Batch(\"speedy-batch\", \"MINIMALIST-SPOON\", 100, eta=today)\n    medium = Batch(\"normal-batch\", \"MINIMALIST-SPOON\", 100, eta=tomorrow)\n    latest = Batch(\"slow-batch\", \"MINIMALIST-SPOON\", 100, eta=later)\n    product = Product(sku=\"MINIMALIST-SPOON\", batches=[medium, earliest, latest])\n    line = OrderLine(\"order1\", \"MINIMALIST-SPOON\", 10)\n\n    product.allocate(line)\n\n    assert earliest.available_quantity == 90\n    assert medium.available_quantity == 100\n    assert latest.available_quantity == 100",
      "complexity": 0,
      "lines_of_code": 11,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_product.py:test_returns_allocated_batch_ref",
      "name": "test_returns_allocated_batch_ref",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_product.py",
      "start_line": 37,
      "end_line": 43,
      "role": "Test",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def test_returns_allocated_batch_ref():",
      "body_source": "def test_returns_allocated_batch_ref():\n    in_stock_batch = Batch(\"in-stock-batch-ref\", \"HIGHBROW-POSTER\", 100, eta=None)\n    shipment_batch = Batch(\"shipment-batch-ref\", \"HIGHBROW-POSTER\", 100, eta=tomorrow)\n    line = OrderLine(\"oref\", \"HIGHBROW-POSTER\", 10)\n    product = Product(sku=\"HIGHBROW-POSTER\", batches=[in_stock_batch, shipment_batch])\n    allocation = product.allocate(line)\n    assert allocation == in_stock_batch.reference",
      "complexity": 0,
      "lines_of_code": 6,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_product.py:test_outputs_allocated_event",
      "name": "test_outputs_allocated_event",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_product.py",
      "start_line": 46,
      "end_line": 54,
      "role": "Test",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def test_outputs_allocated_event():",
      "body_source": "def test_outputs_allocated_event():\n    batch = Batch(\"batchref\", \"RETRO-LAMPSHADE\", 100, eta=None)\n    line = OrderLine(\"oref\", \"RETRO-LAMPSHADE\", 10)\n    product = Product(sku=\"RETRO-LAMPSHADE\", batches=[batch])\n    product.allocate(line)\n    expected = events.Allocated(\n        orderid=\"oref\", sku=\"RETRO-LAMPSHADE\", qty=10, batchref=batch.reference\n    )\n    assert product.events[-1] == expected",
      "complexity": 0,
      "lines_of_code": 8,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_product.py:test_records_out_of_stock_event_if_cannot_allocate",
      "name": "test_records_out_of_stock_event_if_cannot_allocate",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_product.py",
      "start_line": 57,
      "end_line": 64,
      "role": "Test",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def test_records_out_of_stock_event_if_cannot_allocate():",
      "body_source": "def test_records_out_of_stock_event_if_cannot_allocate():\n    batch = Batch(\"batch1\", \"SMALL-FORK\", 10, eta=today)\n    product = Product(sku=\"SMALL-FORK\", batches=[batch])\n    product.allocate(OrderLine(\"order1\", \"SMALL-FORK\", 10))\n\n    allocation = product.allocate(OrderLine(\"order2\", \"SMALL-FORK\", 1))\n    assert product.events[-1] == events.OutOfStock(sku=\"SMALL-FORK\")\n    assert allocation is None",
      "complexity": 0,
      "lines_of_code": 7,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_product.py:test_increments_version_number",
      "name": "test_increments_version_number",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_product.py",
      "start_line": 67,
      "end_line": 74,
      "role": "Test",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def test_increments_version_number():",
      "body_source": "def test_increments_version_number():\n    line = OrderLine(\"oref\", \"SCANDI-PEN\", 10)\n    product = Product(\n        sku=\"SCANDI-PEN\", batches=[Batch(\"b1\", \"SCANDI-PEN\", 100, eta=None)]\n    )\n    product.version_number = 7\n    product.allocate(line)\n    assert product.version_number == 8",
      "complexity": 0,
      "lines_of_code": 7,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_batches.py:test_allocating_to_a_batch_reduces_the_available_quantity",
      "name": "test_allocating_to_a_batch_reduces_the_available_quantity",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_batches.py",
      "start_line": 5,
      "end_line": 11,
      "role": "Test",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def test_allocating_to_a_batch_reduces_the_available_quantity():",
      "body_source": "def test_allocating_to_a_batch_reduces_the_available_quantity():\n    batch = Batch(\"batch-001\", \"SMALL-TABLE\", qty=20, eta=date.today())\n    line = OrderLine(\"order-ref\", \"SMALL-TABLE\", 2)\n\n    batch.allocate(line)\n\n    assert batch.available_quantity == 18",
      "complexity": 0,
      "lines_of_code": 6,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_batches.py:make_batch_and_line",
      "name": "make_batch_and_line",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_batches.py",
      "start_line": 14,
      "end_line": 18,
      "role": "Factory",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "sku"
        },
        {
          "name": "batch_qty"
        },
        {
          "name": "line_qty"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def make_batch_and_line(sku, batch_qty, line_qty):",
      "body_source": "def make_batch_and_line(sku, batch_qty, line_qty):\n    return (\n        Batch(\"batch-001\", sku, batch_qty, eta=date.today()),\n        OrderLine(\"order-123\", sku, line_qty),\n    )",
      "complexity": 0,
      "lines_of_code": 4,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_batches.py:test_can_allocate_if_available_greater_than_required",
      "name": "test_can_allocate_if_available_greater_than_required",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_batches.py",
      "start_line": 21,
      "end_line": 23,
      "role": "Specification",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def test_can_allocate_if_available_greater_than_required():",
      "body_source": "def test_can_allocate_if_available_greater_than_required():\n    large_batch, small_line = make_batch_and_line(\"ELEGANT-LAMP\", 20, 2)\n    assert large_batch.can_allocate(small_line)",
      "complexity": 0,
      "lines_of_code": 2,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_batches.py:test_cannot_allocate_if_available_smaller_than_required",
      "name": "test_cannot_allocate_if_available_smaller_than_required",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_batches.py",
      "start_line": 26,
      "end_line": 28,
      "role": "Test",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def test_cannot_allocate_if_available_smaller_than_required():",
      "body_source": "def test_cannot_allocate_if_available_smaller_than_required():\n    small_batch, large_line = make_batch_and_line(\"ELEGANT-LAMP\", 2, 20)\n    assert small_batch.can_allocate(large_line) is False",
      "complexity": 0,
      "lines_of_code": 2,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_batches.py:test_can_allocate_if_available_equal_to_required",
      "name": "test_can_allocate_if_available_equal_to_required",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_batches.py",
      "start_line": 31,
      "end_line": 33,
      "role": "Specification",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def test_can_allocate_if_available_equal_to_required():",
      "body_source": "def test_can_allocate_if_available_equal_to_required():\n    batch, line = make_batch_and_line(\"ELEGANT-LAMP\", 2, 2)\n    assert batch.can_allocate(line)",
      "complexity": 0,
      "lines_of_code": 2,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_batches.py:test_cannot_allocate_if_skus_do_not_match",
      "name": "test_cannot_allocate_if_skus_do_not_match",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_batches.py",
      "start_line": 36,
      "end_line": 39,
      "role": "Test",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def test_cannot_allocate_if_skus_do_not_match():",
      "body_source": "def test_cannot_allocate_if_skus_do_not_match():\n    batch = Batch(\"batch-001\", \"UNCOMFORTABLE-CHAIR\", 100, eta=None)\n    different_sku_line = OrderLine(\"order-123\", \"EXPENSIVE-TOASTER\", 10)\n    assert batch.can_allocate(different_sku_line) is False",
      "complexity": 0,
      "lines_of_code": 3,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_batches.py:test_allocation_is_idempotent",
      "name": "test_allocation_is_idempotent",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_batches.py",
      "start_line": 42,
      "end_line": 46,
      "role": "Specification",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def test_allocation_is_idempotent():",
      "body_source": "def test_allocation_is_idempotent():\n    batch, line = make_batch_and_line(\"ANGULAR-DESK\", 20, 2)\n    batch.allocate(line)\n    batch.allocate(line)\n    assert batch.available_quantity == 18",
      "complexity": 0,
      "lines_of_code": 4,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_repository.py:test_get_by_batchref",
      "name": "test_get_by_batchref",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_repository.py",
      "start_line": 8,
      "end_line": 19,
      "role": "Query",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "sqlite_session_factory"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def test_get_by_batchref(sqlite_session_factory):",
      "body_source": "def test_get_by_batchref(sqlite_session_factory):\n    session = sqlite_session_factory()\n    repo = repository.SqlAlchemyRepository(session)\n    b1 = model.Batch(ref=\"b1\", sku=\"sku1\", qty=100, eta=None)\n    b2 = model.Batch(ref=\"b2\", sku=\"sku1\", qty=100, eta=None)\n    b3 = model.Batch(ref=\"b3\", sku=\"sku2\", qty=100, eta=None)\n    p1 = model.Product(sku=\"sku1\", batches=[b1, b2])\n    p2 = model.Product(sku=\"sku2\", batches=[b3])\n    repo.add(p1)\n    repo.add(p2)\n    assert repo.get_by_batchref(\"b2\") == p1\n    assert repo.get_by_batchref(\"b3\") == p2",
      "complexity": 0,
      "lines_of_code": 11,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_email.py:bus",
      "name": "bus",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_email.py",
      "start_line": 13,
      "end_line": 21,
      "role": "Configuration",
      "role_confidence": 90.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "sqlite_session_factory"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [
        "pytest.fixture"
      ],
      "docstring": "",
      "signature": "def bus(sqlite_session_factory):",
      "body_source": "def bus(sqlite_session_factory):\n    bus = bootstrap.bootstrap(\n        start_orm=True,\n        uow=unit_of_work.SqlAlchemyUnitOfWork(sqlite_session_factory),\n        notifications=notifications.EmailNotifications(),\n        publish=lambda *args: None,\n    )\n    yield bus\n    clear_mappers()",
      "complexity": 0,
      "lines_of_code": 8,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_email.py:get_email_from_mailhog",
      "name": "get_email_from_mailhog",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_email.py",
      "start_line": 24,
      "end_line": 27,
      "role": "Query",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "sku"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def get_email_from_mailhog(sku):",
      "body_source": "def get_email_from_mailhog(sku):\n    host, port = map(config.get_email_host_and_port().get, [\"host\", \"http_port\"])\n    all_emails = requests.get(f\"http://{host}:{port}/api/v2/messages\").json()\n    return next(m for m in all_emails[\"items\"] if sku in str(m))",
      "complexity": 0,
      "lines_of_code": 3,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_email.py:test_out_of_stock_email",
      "name": "test_out_of_stock_email",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_email.py",
      "start_line": 30,
      "end_line": 37,
      "role": "Test",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "bus"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def test_out_of_stock_email(bus):",
      "body_source": "def test_out_of_stock_email(bus):\n    sku = random_sku()\n    bus.handle(commands.CreateBatch(\"batch1\", sku, 9, None))\n    bus.handle(commands.Allocate(\"order1\", sku, 10))\n    email = get_email_from_mailhog(sku)\n    assert email[\"Raw\"][\"From\"] == \"allocations@example.com\"\n    assert email[\"Raw\"][\"To\"] == [\"stock@made.com\"]\n    assert f\"Out of stock for {sku}\" in email[\"Raw\"][\"Data\"]",
      "complexity": 0,
      "lines_of_code": 7,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_views.py:sqlite_bus",
      "name": "sqlite_bus",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_views.py",
      "start_line": 14,
      "end_line": 22,
      "role": "Configuration",
      "role_confidence": 90.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "sqlite_session_factory"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [
        "pytest.fixture"
      ],
      "docstring": "",
      "signature": "def sqlite_bus(sqlite_session_factory):",
      "body_source": "def sqlite_bus(sqlite_session_factory):\n    bus = bootstrap.bootstrap(\n        start_orm=True,\n        uow=unit_of_work.SqlAlchemyUnitOfWork(sqlite_session_factory),\n        notifications=mock.Mock(),\n        publish=lambda *args: None,\n    )\n    yield bus\n    clear_mappers()",
      "complexity": 0,
      "lines_of_code": 8,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_views.py:test_allocations_view",
      "name": "test_allocations_view",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_views.py",
      "start_line": 25,
      "end_line": 38,
      "role": "Test",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "sqlite_bus"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def test_allocations_view(sqlite_bus):",
      "body_source": "def test_allocations_view(sqlite_bus):\n    sqlite_bus.handle(commands.CreateBatch(\"sku1batch\", \"sku1\", 50, None))\n    sqlite_bus.handle(commands.CreateBatch(\"sku2batch\", \"sku2\", 50, today))\n    sqlite_bus.handle(commands.Allocate(\"order1\", \"sku1\", 20))\n    sqlite_bus.handle(commands.Allocate(\"order1\", \"sku2\", 20))\n    # add a spurious batch and order to make sure we're getting the right ones\n    sqlite_bus.handle(commands.CreateBatch(\"sku1batch-later\", \"sku1\", 50, today))\n    sqlite_bus.handle(commands.Allocate(\"otherorder\", \"sku1\", 30))\n    sqlite_bus.handle(commands.Allocate(\"otherorder\", \"sku2\", 10))\n\n    assert views.allocations(\"order1\", sqlite_bus.uow) == [\n        {\"sku\": \"sku1\", \"batchref\": \"sku1batch\"},\n        {\"sku\": \"sku2\", \"batchref\": \"sku2batch\"},\n    ]",
      "complexity": 0,
      "lines_of_code": 13,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_views.py:test_deallocation",
      "name": "test_deallocation",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_views.py",
      "start_line": 41,
      "end_line": 49,
      "role": "Test",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "sqlite_bus"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def test_deallocation(sqlite_bus):",
      "body_source": "def test_deallocation(sqlite_bus):\n    sqlite_bus.handle(commands.CreateBatch(\"b1\", \"sku1\", 50, None))\n    sqlite_bus.handle(commands.CreateBatch(\"b2\", \"sku1\", 50, today))\n    sqlite_bus.handle(commands.Allocate(\"o1\", \"sku1\", 40))\n    sqlite_bus.handle(commands.ChangeBatchQuantity(\"b1\", 10))\n\n    assert views.allocations(\"o1\", sqlite_bus.uow) == [\n        {\"sku\": \"sku1\", \"batchref\": \"b2\"},\n    ]",
      "complexity": 0,
      "lines_of_code": 8,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_uow.py:insert_batch",
      "name": "insert_batch",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_uow.py",
      "start_line": 15,
      "end_line": 24,
      "role": "Utility",
      "role_confidence": 60.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "session"
        },
        {
          "name": "ref"
        },
        {
          "name": "sku"
        },
        {
          "name": "qty"
        },
        {
          "name": "eta"
        },
        {
          "name": "product_version",
          "default": "1"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def insert_batch(session, ref, sku, qty, eta, product_version=1):",
      "body_source": "def insert_batch(session, ref, sku, qty, eta, product_version=1):\n    session.execute(\n        \"INSERT INTO products (sku, version_number) VALUES (:sku, :version)\",\n        dict(sku=sku, version=product_version),\n    )\n    session.execute(\n        \"INSERT INTO batches (reference, sku, _purchased_quantity, eta)\"\n        \" VALUES (:ref, :sku, :qty, :eta)\",\n        dict(ref=ref, sku=sku, qty=qty, eta=eta),\n    )",
      "complexity": 0,
      "lines_of_code": 9,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_uow.py:get_allocated_batch_ref",
      "name": "get_allocated_batch_ref",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_uow.py",
      "start_line": 27,
      "end_line": 37,
      "role": "Query",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "session"
        },
        {
          "name": "orderid"
        },
        {
          "name": "sku"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def get_allocated_batch_ref(session, orderid, sku):",
      "body_source": "def get_allocated_batch_ref(session, orderid, sku):\n    [[orderlineid]] = session.execute(\n        \"SELECT id FROM order_lines WHERE orderid=:orderid AND sku=:sku\",\n        dict(orderid=orderid, sku=sku),\n    )\n    [[batchref]] = session.execute(\n        \"SELECT b.reference FROM allocations JOIN batches AS b ON batch_id = b.id\"\n        \" WHERE orderline_id=:orderlineid\",\n        dict(orderlineid=orderlineid),\n    )\n    return batchref",
      "complexity": 0,
      "lines_of_code": 10,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_uow.py:test_uow_can_retrieve_a_batch_and_allocate_to_it",
      "name": "test_uow_can_retrieve_a_batch_and_allocate_to_it",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_uow.py",
      "start_line": 40,
      "end_line": 53,
      "role": "Specification",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "sqlite_session_factory"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def test_uow_can_retrieve_a_batch_and_allocate_to_it(sqlite_session_factory):",
      "body_source": "def test_uow_can_retrieve_a_batch_and_allocate_to_it(sqlite_session_factory):\n    session = sqlite_session_factory()\n    insert_batch(session, \"batch1\", \"HIPSTER-WORKBENCH\", 100, None)\n    session.commit()\n\n    uow = unit_of_work.SqlAlchemyUnitOfWork(sqlite_session_factory)\n    with uow:\n        product = uow.products.get(sku=\"HIPSTER-WORKBENCH\")\n        line = model.OrderLine(\"o1\", \"HIPSTER-WORKBENCH\", 10)\n        product.allocate(line)\n        uow.commit()\n\n    batchref = get_allocated_batch_ref(session, \"o1\", \"HIPSTER-WORKBENCH\")\n    assert batchref == \"batch1\"",
      "complexity": 0,
      "lines_of_code": 13,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_uow.py:test_rolls_back_uncommitted_work_by_default",
      "name": "test_rolls_back_uncommitted_work_by_default",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_uow.py",
      "start_line": 56,
      "end_line": 63,
      "role": "Test",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "sqlite_session_factory"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def test_rolls_back_uncommitted_work_by_default(sqlite_session_factory):",
      "body_source": "def test_rolls_back_uncommitted_work_by_default(sqlite_session_factory):\n    uow = unit_of_work.SqlAlchemyUnitOfWork(sqlite_session_factory)\n    with uow:\n        insert_batch(uow.session, \"batch1\", \"MEDIUM-PLINTH\", 100, None)\n\n    new_session = sqlite_session_factory()\n    rows = list(new_session.execute('SELECT * FROM \"batches\"'))\n    assert rows == []",
      "complexity": 0,
      "lines_of_code": 7,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_uow.py:test_rolls_back_on_error",
      "name": "test_rolls_back_on_error",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_uow.py",
      "start_line": 66,
      "end_line": 78,
      "role": "Observer",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "sqlite_session_factory"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def test_rolls_back_on_error(sqlite_session_factory):",
      "body_source": "def test_rolls_back_on_error(sqlite_session_factory):\n    class MyException(Exception):\n        pass\n\n    uow = unit_of_work.SqlAlchemyUnitOfWork(sqlite_session_factory)\n    with pytest.raises(MyException):\n        with uow:\n            insert_batch(uow.session, \"batch1\", \"LARGE-FORK\", 100, None)\n            raise MyException()\n\n    new_session = sqlite_session_factory()\n    rows = list(new_session.execute('SELECT * FROM \"batches\"'))\n    assert rows == []",
      "complexity": 0,
      "lines_of_code": 12,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_uow.py:MyException",
      "name": "MyException",
      "kind": "class",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_uow.py",
      "start_line": 67,
      "end_line": 67,
      "role": "Test",
      "role_confidence": 80.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [
        "Exception"
      ],
      "decorators": [],
      "docstring": "",
      "signature": "class MyException(Exception):",
      "body_source": "",
      "complexity": 0,
      "lines_of_code": 0,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_uow.py:try_to_allocate",
      "name": "try_to_allocate",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_uow.py",
      "start_line": 81,
      "end_line": 91,
      "role": "Utility",
      "role_confidence": 60.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "orderid"
        },
        {
          "name": "sku"
        },
        {
          "name": "exceptions"
        },
        {
          "name": "session_factory"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def try_to_allocate(orderid, sku, exceptions, session_factory):",
      "body_source": "def try_to_allocate(orderid, sku, exceptions, session_factory):\n    line = model.OrderLine(orderid, sku, 10)\n    try:\n        with unit_of_work.SqlAlchemyUnitOfWork(session_factory) as uow:\n            product = uow.products.get(sku=sku)\n            product.allocate(line)\n            time.sleep(0.2)\n            uow.commit()\n    except Exception as e:  # pylint: disable=broad-except\n        print(traceback.format_exc())\n        exceptions.append(e)",
      "complexity": 0,
      "lines_of_code": 10,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_uow.py:test_concurrent_updates_to_version_are_not_allowed",
      "name": "test_concurrent_updates_to_version_are_not_allowed",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_uow.py",
      "start_line": 94,
      "end_line": 132,
      "role": "Test",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "postgres_session_factory"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def test_concurrent_updates_to_version_are_not_allowed(postgres_session_factory):",
      "body_source": "def test_concurrent_updates_to_version_are_not_allowed(postgres_session_factory):\n    sku, batch = random_sku(), random_batchref()\n    session = postgres_session_factory()\n    insert_batch(session, batch, sku, 100, eta=None, product_version=1)\n    session.commit()\n\n    order1, order2 = random_orderid(1), random_orderid(2)\n    exceptions = []  # type: List[Exception]\n    try_to_allocate_order1 = lambda: try_to_allocate(\n        order1, sku, exceptions, postgres_session_factory\n    )\n    try_to_allocate_order2 = lambda: try_to_allocate(\n        order2, sku, exceptions, postgres_session_factory\n    )\n    thread1 = threading.Thread(target=try_to_allocate_order1)\n    thread2 = threading.Thread(target=try_to_allocate_order2)\n    thread1.start()\n    thread2.start()\n    thread1.join()\n    thread2.join()\n\n    [[version]] = session.execute(\n        \"SELECT version_number FROM products WHERE sku=:sku\",\n        dict(sku=sku),\n    )\n    assert version == 2\n    [exception] = exceptions\n    assert \"could not serialize access due to concurrent update\" in str(exception)\n\n    orders = session.execute(\n        \"SELECT orderid FROM allocations\"\n        \" JOIN batches ON allocations.batch_id = batches.id\"\n        \" JOIN order_lines ON allocations.orderline_id = order_lines.id\"\n        \" WHERE order_lines.sku=:sku\",\n        dict(sku=sku),\n    )\n    assert orders.rowcount == 1\n    with unit_of_work.SqlAlchemyUnitOfWork(postgres_session_factory) as uow:\n        uow.session.execute(\"select 1\")",
      "complexity": 0,
      "lines_of_code": 38,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/e2e/redis_client.py:subscribe_to",
      "name": "subscribe_to",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/e2e/redis_client.py",
      "start_line": 9,
      "end_line": 14,
      "role": "Observer",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "channel"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def subscribe_to(channel):",
      "body_source": "def subscribe_to(channel):\n    pubsub = r.pubsub()\n    pubsub.subscribe(channel)\n    confirmation = pubsub.get_message(timeout=3)\n    assert confirmation[\"type\"] == \"subscribe\"\n    return pubsub",
      "complexity": 0,
      "lines_of_code": 5,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/e2e/redis_client.py:publish_message",
      "name": "publish_message",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/e2e/redis_client.py",
      "start_line": 17,
      "end_line": 18,
      "role": "Command",
      "role_confidence": 75.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "channel"
        },
        {
          "name": "message"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def publish_message(channel, message):",
      "body_source": "def publish_message(channel, message):\n    r.publish(channel, json.dumps(message))",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/e2e/test_api.py:test_happy_path_returns_202_and_batch_is_allocated",
      "name": "test_happy_path_returns_202_and_batch_is_allocated",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/e2e/test_api.py",
      "start_line": 8,
      "end_line": 25,
      "role": "Configuration",
      "role_confidence": 90.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [
        "pytest.mark.usefixtures",
        "pytest.mark.usefixtures"
      ],
      "docstring": "",
      "signature": "def test_happy_path_returns_202_and_batch_is_allocated():",
      "body_source": "def test_happy_path_returns_202_and_batch_is_allocated():\n    orderid = random_orderid()\n    sku, othersku = random_sku(), random_sku(\"other\")\n    earlybatch = random_batchref(1)\n    laterbatch = random_batchref(2)\n    otherbatch = random_batchref(3)\n    api_client.post_to_add_batch(laterbatch, sku, 100, \"2011-01-02\")\n    api_client.post_to_add_batch(earlybatch, sku, 100, \"2011-01-01\")\n    api_client.post_to_add_batch(otherbatch, othersku, 100, None)\n\n    r = api_client.post_to_allocate(orderid, sku, qty=3)\n    assert r.status_code == 202\n\n    r = api_client.get_allocation(orderid)\n    assert r.ok\n    assert r.json() == [\n        {\"sku\": sku, \"batchref\": earlybatch},\n    ]",
      "complexity": 0,
      "lines_of_code": 17,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/e2e/test_api.py:test_unhappy_path_returns_400_and_error_message",
      "name": "test_unhappy_path_returns_400_and_error_message",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/e2e/test_api.py",
      "start_line": 30,
      "end_line": 39,
      "role": "Configuration",
      "role_confidence": 90.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [
        "pytest.mark.usefixtures",
        "pytest.mark.usefixtures"
      ],
      "docstring": "",
      "signature": "def test_unhappy_path_returns_400_and_error_message():",
      "body_source": "def test_unhappy_path_returns_400_and_error_message():\n    unknown_sku, orderid = random_sku(), random_orderid()\n    r = api_client.post_to_allocate(\n        orderid, unknown_sku, qty=20, expect_success=False\n    )\n    assert r.status_code == 400\n    assert r.json()[\"message\"] == f\"Invalid sku {unknown_sku}\"\n\n    r = api_client.get_allocation(orderid)\n    assert r.status_code == 404",
      "complexity": 0,
      "lines_of_code": 9,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/e2e/test_external_events.py:test_change_batch_quantity_leading_to_reallocation",
      "name": "test_change_batch_quantity_leading_to_reallocation",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/e2e/test_external_events.py",
      "start_line": 11,
      "end_line": 40,
      "role": "Configuration",
      "role_confidence": 90.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [
        "pytest.mark.usefixtures",
        "pytest.mark.usefixtures",
        "pytest.mark.usefixtures"
      ],
      "docstring": "",
      "signature": "def test_change_batch_quantity_leading_to_reallocation():",
      "body_source": "def test_change_batch_quantity_leading_to_reallocation():\n    # start with two batches and an order allocated to one of them\n    orderid, sku = random_orderid(), random_sku()\n    earlier_batch, later_batch = random_batchref(\"old\"), random_batchref(\"newer\")\n    api_client.post_to_add_batch(earlier_batch, sku, qty=10, eta=\"2011-01-01\")\n    api_client.post_to_add_batch(later_batch, sku, qty=10, eta=\"2011-01-02\")\n    r = api_client.post_to_allocate(orderid, sku, 10)\n    assert r.ok\n    response = api_client.get_allocation(orderid)\n    assert response.json()[0][\"batchref\"] == earlier_batch\n\n    subscription = redis_client.subscribe_to(\"line_allocated\")\n\n    # change quantity on allocated batch so it's less than our order\n    redis_client.publish_message(\n        \"change_batch_quantity\",\n        {\"batchref\": earlier_batch, \"qty\": 5},\n    )\n\n    # wait until we see a message saying the order has been reallocated\n    messages = []\n    for attempt in Retrying(stop=stop_after_delay(3), reraise=True):\n        with attempt:\n            message = subscription.get_message(timeout=1)\n            if message:\n                messages.append(message)\n                print(messages)\n            data = json.loads(messages[-1][\"data\"])\n            assert data[\"orderid\"] == orderid\n            assert data[\"batchref\"] == later_batch",
      "complexity": 0,
      "lines_of_code": 29,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/e2e/api_client.py:post_to_add_batch",
      "name": "post_to_add_batch",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/e2e/api_client.py",
      "start_line": 5,
      "end_line": 10,
      "role": "Fixture",
      "role_confidence": 70.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "ref"
        },
        {
          "name": "sku"
        },
        {
          "name": "qty"
        },
        {
          "name": "eta"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def post_to_add_batch(ref, sku, qty, eta):",
      "body_source": "def post_to_add_batch(ref, sku, qty, eta):\n    url = config.get_api_url()\n    r = requests.post(\n        f\"{url}/add_batch\", json={\"ref\": ref, \"sku\": sku, \"qty\": qty, \"eta\": eta}\n    )\n    assert r.status_code == 201",
      "complexity": 0,
      "lines_of_code": 5,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/e2e/api_client.py:post_to_allocate",
      "name": "post_to_allocate",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/e2e/api_client.py",
      "start_line": 13,
      "end_line": 25,
      "role": "Fixture",
      "role_confidence": 70.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "orderid"
        },
        {
          "name": "sku"
        },
        {
          "name": "qty"
        },
        {
          "name": "expect_success",
          "default": "True"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def post_to_allocate(orderid, sku, qty, expect_success=True):",
      "body_source": "def post_to_allocate(orderid, sku, qty, expect_success=True):\n    url = config.get_api_url()\n    r = requests.post(\n        f\"{url}/allocate\",\n        json={\n            \"orderid\": orderid,\n            \"sku\": sku,\n            \"qty\": qty,\n        },\n    )\n    if expect_success:\n        assert r.status_code == 202\n    return r",
      "complexity": 0,
      "lines_of_code": 12,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/e2e/api_client.py:get_allocation",
      "name": "get_allocation",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/e2e/api_client.py",
      "start_line": 28,
      "end_line": 30,
      "role": "Query",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "orderid"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def get_allocation(orderid):",
      "body_source": "def get_allocation(orderid):\n    url = config.get_api_url()\n    return requests.get(f\"{url}/allocations/{orderid}\")",
      "complexity": 0,
      "lines_of_code": 2,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/bootstrap.py:bootstrap",
      "name": "bootstrap",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/bootstrap.py",
      "start_line": 11,
      "end_line": 41,
      "role": "ApplicationService",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "start_orm",
          "type": "bool",
          "default": "True"
        },
        {
          "name": "uow",
          "type": "unit_of_work.AbstractUnitOfWork",
          "default": "unit_of_work.SqlAlchemyUnitOfWork()"
        },
        {
          "name": "notifications",
          "type": "AbstractNotifications",
          "default": "None"
        },
        {
          "name": "publish",
          "type": "Callable",
          "default": "redis_eventpublisher.publish"
        }
      ],
      "return_type": "messagebus.MessageBus",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def bootstrap(",
      "body_source": "def bootstrap(\n    start_orm: bool = True,\n    uow: unit_of_work.AbstractUnitOfWork = unit_of_work.SqlAlchemyUnitOfWork(),\n    notifications: AbstractNotifications = None,\n    publish: Callable = redis_eventpublisher.publish,\n) -> messagebus.MessageBus:\n\n    if notifications is None:\n        notifications = EmailNotifications()\n\n    if start_orm:\n        orm.start_mappers()\n\n    dependencies = {\"uow\": uow, \"notifications\": notifications, \"publish\": publish}\n    injected_event_handlers = {\n        event_type: [\n            inject_dependencies(handler, dependencies)\n            for handler in event_handlers\n        ]\n        for event_type, event_handlers in handlers.EVENT_HANDLERS.items()\n    }\n    injected_command_handlers = {\n        command_type: inject_dependencies(handler, dependencies)\n        for command_type, handler in handlers.COMMAND_HANDLERS.items()\n    }\n\n    return messagebus.MessageBus(\n        uow=uow,\n        event_handlers=injected_event_handlers,\n        command_handlers=injected_command_handlers,\n    )",
      "complexity": 0,
      "lines_of_code": 30,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/bootstrap.py:inject_dependencies",
      "name": "inject_dependencies",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/bootstrap.py",
      "start_line": 44,
      "end_line": 51,
      "role": "Utility",
      "role_confidence": 60.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "handler"
        },
        {
          "name": "dependencies"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def inject_dependencies(handler, dependencies):",
      "body_source": "def inject_dependencies(handler, dependencies):\n    params = inspect.signature(handler).parameters\n    deps = {\n        name: dependency\n        for name, dependency in dependencies.items()\n        if name in params\n    }\n    return lambda message: handler(message, **deps)",
      "complexity": 0,
      "lines_of_code": 7,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/config.py:get_postgres_uri",
      "name": "get_postgres_uri",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/config.py",
      "start_line": 4,
      "end_line": 9,
      "role": "Query",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def get_postgres_uri():",
      "body_source": "def get_postgres_uri():\n    host = os.environ.get(\"DB_HOST\", \"localhost\")\n    port = 54321 if host == \"localhost\" else 5432\n    password = os.environ.get(\"DB_PASSWORD\", \"abc123\")\n    user, db_name = \"allocation\", \"allocation\"\n    return f\"postgresql://{user}:{password}@{host}:{port}/{db_name}\"",
      "complexity": 0,
      "lines_of_code": 5,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/config.py:get_api_url",
      "name": "get_api_url",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/config.py",
      "start_line": 12,
      "end_line": 15,
      "role": "Query",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def get_api_url():",
      "body_source": "def get_api_url():\n    host = os.environ.get(\"API_HOST\", \"localhost\")\n    port = 5005 if host == \"localhost\" else 80\n    return f\"http://{host}:{port}\"",
      "complexity": 0,
      "lines_of_code": 3,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/config.py:get_redis_host_and_port",
      "name": "get_redis_host_and_port",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/config.py",
      "start_line": 18,
      "end_line": 21,
      "role": "Query",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def get_redis_host_and_port():",
      "body_source": "def get_redis_host_and_port():\n    host = os.environ.get(\"REDIS_HOST\", \"localhost\")\n    port = 63791 if host == \"localhost\" else 6379\n    return dict(host=host, port=port)",
      "complexity": 0,
      "lines_of_code": 3,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/config.py:get_email_host_and_port",
      "name": "get_email_host_and_port",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/config.py",
      "start_line": 24,
      "end_line": 28,
      "role": "Query",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def get_email_host_and_port():",
      "body_source": "def get_email_host_and_port():\n    host = os.environ.get(\"EMAIL_HOST\", \"localhost\")\n    port = 11025 if host == \"localhost\" else 1025\n    http_port = 18025 if host == \"localhost\" else 8025\n    return dict(host=host, port=port, http_port=http_port)",
      "complexity": 0,
      "lines_of_code": 4,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/views.py:allocations",
      "name": "allocations",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/views.py",
      "start_line": 4,
      "end_line": 12,
      "role": "Utility",
      "role_confidence": 60.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "orderid",
          "type": "str"
        },
        {
          "name": "uow",
          "type": "unit_of_work.SqlAlchemyUnitOfWork"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def allocations(orderid: str, uow: unit_of_work.SqlAlchemyUnitOfWork):",
      "body_source": "def allocations(orderid: str, uow: unit_of_work.SqlAlchemyUnitOfWork):\n    with uow:\n        results = uow.session.execute(\n            \"\"\"\n            SELECT sku, batchref FROM allocations_view WHERE orderid = :orderid\n            \"\"\",\n            dict(orderid=orderid),\n        )\n    return [dict(r) for r in results]",
      "complexity": 0,
      "lines_of_code": 8,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/orm.py:start_mappers",
      "name": "start_mappers",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/orm.py",
      "start_line": 63,
      "end_line": 81,
      "role": "UseCase",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def start_mappers():",
      "body_source": "def start_mappers():\n    logger.info(\"Starting mappers\")\n    lines_mapper = mapper(model.OrderLine, order_lines)\n    batches_mapper = mapper(\n        model.Batch,\n        batches,\n        properties={\n            \"_allocations\": relationship(\n                lines_mapper,\n                secondary=allocations,\n                collection_class=set,\n            )\n        },\n    )\n    mapper(\n        model.Product,\n        products,\n        properties={\"batches\": relationship(batches_mapper)},\n    )",
      "complexity": 0,
      "lines_of_code": 18,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/orm.py:receive_load",
      "name": "receive_load",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/orm.py",
      "start_line": 85,
      "end_line": 86,
      "role": "Query",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "product"
        },
        {
          "name": "_"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [
        "event.listens_for"
      ],
      "docstring": "",
      "signature": "def receive_load(product, _):",
      "body_source": "def receive_load(product, _):\n    product.events = []",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/notifications.py:AbstractNotifications",
      "name": "AbstractNotifications",
      "kind": "class",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/notifications.py",
      "start_line": 7,
      "end_line": 7,
      "role": "Adapter",
      "role_confidence": 75.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [
        "ABC"
      ],
      "decorators": [],
      "docstring": "",
      "signature": "class AbstractNotifications(abc.ABC):",
      "body_source": "",
      "complexity": 0,
      "lines_of_code": 0,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/notifications.py:AbstractNotifications.send",
      "name": "AbstractNotifications.send",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/notifications.py",
      "start_line": 9,
      "end_line": 10,
      "role": "Command",
      "role_confidence": 75.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "destination"
        },
        {
          "name": "message"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [
        "abc.abstractmethod"
      ],
      "docstring": "",
      "signature": "def send(self, destination, message):",
      "body_source": "    def send(self, destination, message):\n        raise NotImplementedError",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/notifications.py:EmailNotifications",
      "name": "EmailNotifications",
      "kind": "class",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/notifications.py",
      "start_line": 17,
      "end_line": 17,
      "role": "Adapter",
      "role_confidence": 75.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [
        "AbstractNotifications"
      ],
      "decorators": [],
      "docstring": "",
      "signature": "class EmailNotifications(AbstractNotifications):",
      "body_source": "",
      "complexity": 0,
      "lines_of_code": 0,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/notifications.py:EmailNotifications.__init__",
      "name": "EmailNotifications.__init__",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/notifications.py",
      "start_line": 18,
      "end_line": 20,
      "role": "ApplicationService",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "smtp_host",
          "default": "DEFAULT_HOST"
        },
        {
          "name": "port",
          "default": "DEFAULT_PORT"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def __init__(self, smtp_host=DEFAULT_HOST, port=DEFAULT_PORT):",
      "body_source": "    def __init__(self, smtp_host=DEFAULT_HOST, port=DEFAULT_PORT):\n        self.server = smtplib.SMTP(smtp_host, port=port)\n        self.server.noop()",
      "complexity": 0,
      "lines_of_code": 2,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/notifications.py:EmailNotifications.send",
      "name": "EmailNotifications.send",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/notifications.py",
      "start_line": 22,
      "end_line": 28,
      "role": "Command",
      "role_confidence": 75.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "destination"
        },
        {
          "name": "message"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def send(self, destination, message):",
      "body_source": "    def send(self, destination, message):\n        msg = f\"Subject: allocation service notification\\n{message}\"\n        self.server.sendmail(\n            from_addr=\"allocations@example.com\",\n            to_addrs=[destination],\n            msg=msg,\n        )",
      "complexity": 0,
      "lines_of_code": 6,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py:AbstractRepository",
      "name": "AbstractRepository",
      "kind": "class",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py",
      "start_line": 7,
      "end_line": 7,
      "role": "Adapter",
      "role_confidence": 75.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [
        "ABC"
      ],
      "decorators": [],
      "docstring": "",
      "signature": "class AbstractRepository(abc.ABC):",
      "body_source": "",
      "complexity": 0,
      "lines_of_code": 0,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py:AbstractRepository.__init__",
      "name": "AbstractRepository.__init__",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py",
      "start_line": 8,
      "end_line": 9,
      "role": "ApplicationService",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def __init__(self):",
      "body_source": "    def __init__(self):\n        self.seen = set()  # type: Set[model.Product]",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py:AbstractRepository.add",
      "name": "AbstractRepository.add",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py",
      "start_line": 11,
      "end_line": 13,
      "role": "Utility",
      "role_confidence": 60.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "product",
          "type": "model.Product"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def add(self, product: model.Product):",
      "body_source": "    def add(self, product: model.Product):\n        self._add(product)\n        self.seen.add(product)",
      "complexity": 0,
      "lines_of_code": 2,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py:AbstractRepository.get",
      "name": "AbstractRepository.get",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py",
      "start_line": 15,
      "end_line": 19,
      "role": "Query",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "sku"
        }
      ],
      "return_type": "model.Product",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def get(self, sku) -> model.Product:",
      "body_source": "    def get(self, sku) -> model.Product:\n        product = self._get(sku)\n        if product:\n            self.seen.add(product)\n        return product",
      "complexity": 0,
      "lines_of_code": 4,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py:AbstractRepository.get_by_batchref",
      "name": "AbstractRepository.get_by_batchref",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py",
      "start_line": 21,
      "end_line": 25,
      "role": "Query",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "batchref"
        }
      ],
      "return_type": "model.Product",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def get_by_batchref(self, batchref) -> model.Product:",
      "body_source": "    def get_by_batchref(self, batchref) -> model.Product:\n        product = self._get_by_batchref(batchref)\n        if product:\n            self.seen.add(product)\n        return product",
      "complexity": 0,
      "lines_of_code": 4,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py:AbstractRepository._add",
      "name": "AbstractRepository._add",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py",
      "start_line": 28,
      "end_line": 29,
      "role": "Internal",
      "role_confidence": 70.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "product",
          "type": "model.Product"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [
        "abc.abstractmethod"
      ],
      "docstring": "",
      "signature": "def _add(self, product: model.Product):",
      "body_source": "    def _add(self, product: model.Product):\n        raise NotImplementedError",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py:AbstractRepository._get",
      "name": "AbstractRepository._get",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py",
      "start_line": 32,
      "end_line": 33,
      "role": "Query",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "sku"
        }
      ],
      "return_type": "model.Product",
      "base_classes": [],
      "decorators": [
        "abc.abstractmethod"
      ],
      "docstring": "",
      "signature": "def _get(self, sku) -> model.Product:",
      "body_source": "    def _get(self, sku) -> model.Product:\n        raise NotImplementedError",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py:AbstractRepository._get_by_batchref",
      "name": "AbstractRepository._get_by_batchref",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py",
      "start_line": 36,
      "end_line": 37,
      "role": "Query",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "batchref"
        }
      ],
      "return_type": "model.Product",
      "base_classes": [],
      "decorators": [
        "abc.abstractmethod"
      ],
      "docstring": "",
      "signature": "def _get_by_batchref(self, batchref) -> model.Product:",
      "body_source": "    def _get_by_batchref(self, batchref) -> model.Product:\n        raise NotImplementedError",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py:SqlAlchemyRepository",
      "name": "SqlAlchemyRepository",
      "kind": "class",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py",
      "start_line": 40,
      "end_line": 40,
      "role": "Repository",
      "role_confidence": 99.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [
        "AbstractRepository"
      ],
      "decorators": [],
      "docstring": "",
      "signature": "class SqlAlchemyRepository(AbstractRepository):",
      "body_source": "",
      "complexity": 0,
      "lines_of_code": 0,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py:SqlAlchemyRepository.__init__",
      "name": "SqlAlchemyRepository.__init__",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py",
      "start_line": 41,
      "end_line": 43,
      "role": "ApplicationService",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "session"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def __init__(self, session):",
      "body_source": "    def __init__(self, session):\n        super().__init__()\n        self.session = session",
      "complexity": 0,
      "lines_of_code": 2,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py:SqlAlchemyRepository._add",
      "name": "SqlAlchemyRepository._add",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py",
      "start_line": 45,
      "end_line": 46,
      "role": "Internal",
      "role_confidence": 70.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "product"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def _add(self, product):",
      "body_source": "    def _add(self, product):\n        self.session.add(product)",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py:SqlAlchemyRepository._get",
      "name": "SqlAlchemyRepository._get",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py",
      "start_line": 48,
      "end_line": 49,
      "role": "Query",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "sku"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def _get(self, sku):",
      "body_source": "    def _get(self, sku):\n        return self.session.query(model.Product).filter_by(sku=sku).first()",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py:SqlAlchemyRepository._get_by_batchref",
      "name": "SqlAlchemyRepository._get_by_batchref",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py",
      "start_line": 51,
      "end_line": 59,
      "role": "Query",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "batchref"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def _get_by_batchref(self, batchref):",
      "body_source": "    def _get_by_batchref(self, batchref):\n        return (\n            self.session.query(model.Product)\n            .join(model.Batch)\n            .filter(\n                orm.batches.c.reference == batchref,\n            )\n            .first()\n        )",
      "complexity": 0,
      "lines_of_code": 8,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/redis_eventpublisher.py:publish",
      "name": "publish",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/redis_eventpublisher.py",
      "start_line": 14,
      "end_line": 16,
      "role": "Command",
      "role_confidence": 75.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "channel"
        },
        {
          "name": "event",
          "type": "events.Event"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def publish(channel, event: events.Event):",
      "body_source": "def publish(channel, event: events.Event):\n    logging.info(\"publishing: channel=%s, event=%s\", channel, event)\n    r.publish(channel, json.dumps(asdict(event)))",
      "complexity": 0,
      "lines_of_code": 2,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/handlers.py:InvalidSku",
      "name": "InvalidSku",
      "kind": "class",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/handlers.py",
      "start_line": 13,
      "end_line": 13,
      "role": "Exception",
      "role_confidence": 75.0,
      "discovery_method": "heuristic_pattern",
      "params": [],
      "return_type": "",
      "base_classes": [
        "Exception"
      ],
      "decorators": [],
      "docstring": "",
      "signature": "class InvalidSku(Exception):",
      "body_source": "",
      "complexity": 0,
      "lines_of_code": 0,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/handlers.py:add_batch",
      "name": "add_batch",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/handlers.py",
      "start_line": 17,
      "end_line": 27,
      "role": "Command",
      "role_confidence": 85.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "cmd",
          "type": "commands.CreateBatch"
        },
        {
          "name": "uow",
          "type": "unit_of_work.AbstractUnitOfWork"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def add_batch(",
      "body_source": "def add_batch(\n    cmd: commands.CreateBatch,\n    uow: unit_of_work.AbstractUnitOfWork,\n):\n    with uow:\n        product = uow.products.get(sku=cmd.sku)\n        if product is None:\n            product = model.Product(cmd.sku, batches=[])\n            uow.products.add(product)\n        product.batches.append(model.Batch(cmd.ref, cmd.sku, cmd.qty, cmd.eta))\n        uow.commit()",
      "complexity": 0,
      "lines_of_code": 10,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/handlers.py:allocate",
      "name": "allocate",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/handlers.py",
      "start_line": 30,
      "end_line": 40,
      "role": "Utility",
      "role_confidence": 60.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "cmd",
          "type": "commands.Allocate"
        },
        {
          "name": "uow",
          "type": "unit_of_work.AbstractUnitOfWork"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def allocate(",
      "body_source": "def allocate(\n    cmd: commands.Allocate,\n    uow: unit_of_work.AbstractUnitOfWork,\n):\n    line = OrderLine(cmd.orderid, cmd.sku, cmd.qty)\n    with uow:\n        product = uow.products.get(sku=line.sku)\n        if product is None:\n            raise InvalidSku(f\"Invalid sku {line.sku}\")\n        product.allocate(line)\n        uow.commit()",
      "complexity": 0,
      "lines_of_code": 10,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/handlers.py:reallocate",
      "name": "reallocate",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/handlers.py",
      "start_line": 43,
      "end_line": 47,
      "role": "Utility",
      "role_confidence": 60.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "event",
          "type": "events.Deallocated"
        },
        {
          "name": "uow",
          "type": "unit_of_work.AbstractUnitOfWork"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def reallocate(",
      "body_source": "def reallocate(\n    event: events.Deallocated,\n    uow: unit_of_work.AbstractUnitOfWork,\n):\n    allocate(commands.Allocate(**asdict(event)), uow=uow)",
      "complexity": 0,
      "lines_of_code": 4,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/handlers.py:change_batch_quantity",
      "name": "change_batch_quantity",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/handlers.py",
      "start_line": 50,
      "end_line": 57,
      "role": "Utility",
      "role_confidence": 60.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "cmd",
          "type": "commands.ChangeBatchQuantity"
        },
        {
          "name": "uow",
          "type": "unit_of_work.AbstractUnitOfWork"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def change_batch_quantity(",
      "body_source": "def change_batch_quantity(\n    cmd: commands.ChangeBatchQuantity,\n    uow: unit_of_work.AbstractUnitOfWork,\n):\n    with uow:\n        product = uow.products.get_by_batchref(batchref=cmd.ref)\n        product.change_batch_quantity(ref=cmd.ref, qty=cmd.qty)\n        uow.commit()",
      "complexity": 0,
      "lines_of_code": 7,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/handlers.py:send_out_of_stock_notification",
      "name": "send_out_of_stock_notification",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/handlers.py",
      "start_line": 63,
      "end_line": 70,
      "role": "Command",
      "role_confidence": 75.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "event",
          "type": "events.OutOfStock"
        },
        {
          "name": "notifications",
          "type": "notifications.AbstractNotifications"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def send_out_of_stock_notification(",
      "body_source": "def send_out_of_stock_notification(\n    event: events.OutOfStock,\n    notifications: notifications.AbstractNotifications,\n):\n    notifications.send(\n        \"stock@made.com\",\n        f\"Out of stock for {event.sku}\",\n    )",
      "complexity": 0,
      "lines_of_code": 7,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/handlers.py:publish_allocated_event",
      "name": "publish_allocated_event",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/handlers.py",
      "start_line": 73,
      "end_line": 77,
      "role": "Command",
      "role_confidence": 75.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "event",
          "type": "events.Allocated"
        },
        {
          "name": "publish",
          "type": "Callable"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def publish_allocated_event(",
      "body_source": "def publish_allocated_event(\n    event: events.Allocated,\n    publish: Callable,\n):\n    publish(\"line_allocated\", event)",
      "complexity": 0,
      "lines_of_code": 4,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/handlers.py:add_allocation_to_read_model",
      "name": "add_allocation_to_read_model",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/handlers.py",
      "start_line": 80,
      "end_line": 92,
      "role": "Query",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "event",
          "type": "events.Allocated"
        },
        {
          "name": "uow",
          "type": "unit_of_work.SqlAlchemyUnitOfWork"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def add_allocation_to_read_model(",
      "body_source": "def add_allocation_to_read_model(\n    event: events.Allocated,\n    uow: unit_of_work.SqlAlchemyUnitOfWork,\n):\n    with uow:\n        uow.session.execute(\n            \"\"\"\n            INSERT INTO allocations_view (orderid, sku, batchref)\n            VALUES (:orderid, :sku, :batchref)\n            \"\"\",\n            dict(orderid=event.orderid, sku=event.sku, batchref=event.batchref),\n        )\n        uow.commit()",
      "complexity": 0,
      "lines_of_code": 12,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/handlers.py:remove_allocation_from_read_model",
      "name": "remove_allocation_from_read_model",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/handlers.py",
      "start_line": 95,
      "end_line": 107,
      "role": "Query",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "event",
          "type": "events.Deallocated"
        },
        {
          "name": "uow",
          "type": "unit_of_work.SqlAlchemyUnitOfWork"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def remove_allocation_from_read_model(",
      "body_source": "def remove_allocation_from_read_model(\n    event: events.Deallocated,\n    uow: unit_of_work.SqlAlchemyUnitOfWork,\n):\n    with uow:\n        uow.session.execute(\n            \"\"\"\n            DELETE FROM allocations_view\n            WHERE orderid = :orderid AND sku = :sku\n            \"\"\",\n            dict(orderid=event.orderid, sku=event.sku),\n        )\n        uow.commit()",
      "complexity": 0,
      "lines_of_code": 12,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/messagebus.py:MessageBus",
      "name": "MessageBus",
      "kind": "class",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/messagebus.py",
      "start_line": 15,
      "end_line": 15,
      "role": "DTO",
      "role_confidence": 65.0,
      "discovery_method": "heuristic_pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "class MessageBus:",
      "body_source": "",
      "complexity": 0,
      "lines_of_code": 0,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/messagebus.py:MessageBus.__init__",
      "name": "MessageBus.__init__",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/messagebus.py",
      "start_line": 16,
      "end_line": 24,
      "role": "ApplicationService",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "uow",
          "type": "unit_of_work.AbstractUnitOfWork"
        },
        {
          "name": "event_handlers",
          "type": "Dict[Type[events.Event], List[Callable]]"
        },
        {
          "name": "command_handlers",
          "type": "Dict[Type[commands.Command], Callable]"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def __init__(",
      "body_source": "    def __init__(\n        self,\n        uow: unit_of_work.AbstractUnitOfWork,\n        event_handlers: Dict[Type[events.Event], List[Callable]],\n        command_handlers: Dict[Type[commands.Command], Callable],\n    ):\n        self.uow = uow\n        self.event_handlers = event_handlers\n        self.command_handlers = command_handlers",
      "complexity": 0,
      "lines_of_code": 8,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/messagebus.py:MessageBus.handle",
      "name": "MessageBus.handle",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/messagebus.py",
      "start_line": 26,
      "end_line": 35,
      "role": "EventHandler",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "message",
          "type": "Message"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def handle(self, message: Message):",
      "body_source": "    def handle(self, message: Message):\n        self.queue = [message]\n        while self.queue:\n            message = self.queue.pop(0)\n            if isinstance(message, events.Event):\n                self.handle_event(message)\n            elif isinstance(message, commands.Command):\n                self.handle_command(message)\n            else:\n                raise Exception(f\"{message} was not an Event or Command\")",
      "complexity": 0,
      "lines_of_code": 9,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/messagebus.py:MessageBus.handle_event",
      "name": "MessageBus.handle_event",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/messagebus.py",
      "start_line": 37,
      "end_line": 45,
      "role": "EventHandler",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "event",
          "type": "events.Event"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def handle_event(self, event: events.Event):",
      "body_source": "    def handle_event(self, event: events.Event):\n        for handler in self.event_handlers[type(event)]:\n            try:\n                logger.debug(\"handling event %s with handler %s\", event, handler)\n                handler(event)\n                self.queue.extend(self.uow.collect_new_events())\n            except Exception:\n                logger.exception(\"Exception handling event %s\", event)\n                continue",
      "complexity": 0,
      "lines_of_code": 8,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/messagebus.py:MessageBus.handle_command",
      "name": "MessageBus.handle_command",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/messagebus.py",
      "start_line": 47,
      "end_line": 55,
      "role": "EventHandler",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "command",
          "type": "commands.Command"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def handle_command(self, command: commands.Command):",
      "body_source": "    def handle_command(self, command: commands.Command):\n        logger.debug(\"handling command %s\", command)\n        try:\n            handler = self.command_handlers[type(command)]\n            handler(command)\n            self.queue.extend(self.uow.collect_new_events())\n        except Exception:\n            logger.exception(\"Exception handling command %s\", command)\n            raise",
      "complexity": 0,
      "lines_of_code": 8,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py:AbstractUnitOfWork",
      "name": "AbstractUnitOfWork",
      "kind": "class",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py",
      "start_line": 13,
      "end_line": 13,
      "role": "DTO",
      "role_confidence": 65.0,
      "discovery_method": "heuristic_pattern",
      "params": [],
      "return_type": "",
      "base_classes": [
        "ABC"
      ],
      "decorators": [],
      "docstring": "",
      "signature": "class AbstractUnitOfWork(abc.ABC):",
      "body_source": "",
      "complexity": 0,
      "lines_of_code": 0,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py:AbstractUnitOfWork.__enter__",
      "name": "AbstractUnitOfWork.__enter__",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py",
      "start_line": 16,
      "end_line": 17,
      "role": "Lifecycle",
      "role_confidence": 95.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "self"
        }
      ],
      "return_type": "AbstractUnitOfWork",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def __enter__(self) -> AbstractUnitOfWork:",
      "body_source": "    def __enter__(self) -> AbstractUnitOfWork:\n        return self",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py:AbstractUnitOfWork.__exit__",
      "name": "AbstractUnitOfWork.__exit__",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py",
      "start_line": 19,
      "end_line": 20,
      "role": "Lifecycle",
      "role_confidence": 95.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "*args"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def __exit__(self, *args):",
      "body_source": "    def __exit__(self, *args):\n        self.rollback()",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py:AbstractUnitOfWork.commit",
      "name": "AbstractUnitOfWork.commit",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py",
      "start_line": 22,
      "end_line": 23,
      "role": "Command",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def commit(self):",
      "body_source": "    def commit(self):\n        self._commit()",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py:AbstractUnitOfWork.collect_new_events",
      "name": "AbstractUnitOfWork.collect_new_events",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py",
      "start_line": 25,
      "end_line": 28,
      "role": "Service",
      "role_confidence": 70.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "self"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def collect_new_events(self):",
      "body_source": "    def collect_new_events(self):\n        for product in self.products.seen:\n            while product.events:\n                yield product.events.pop(0)",
      "complexity": 0,
      "lines_of_code": 3,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py:AbstractUnitOfWork._commit",
      "name": "AbstractUnitOfWork._commit",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py",
      "start_line": 31,
      "end_line": 32,
      "role": "Command",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [
        "abc.abstractmethod"
      ],
      "docstring": "",
      "signature": "def _commit(self):",
      "body_source": "    def _commit(self):\n        raise NotImplementedError",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py:AbstractUnitOfWork.rollback",
      "name": "AbstractUnitOfWork.rollback",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py",
      "start_line": 35,
      "end_line": 36,
      "role": "Utility",
      "role_confidence": 60.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "self"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [
        "abc.abstractmethod"
      ],
      "docstring": "",
      "signature": "def rollback(self):",
      "body_source": "    def rollback(self):\n        raise NotImplementedError",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py:SqlAlchemyUnitOfWork",
      "name": "SqlAlchemyUnitOfWork",
      "kind": "class",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py",
      "start_line": 47,
      "end_line": 47,
      "role": "Repository",
      "role_confidence": 75.0,
      "discovery_method": "heuristic_pattern",
      "params": [],
      "return_type": "",
      "base_classes": [
        "AbstractUnitOfWork"
      ],
      "decorators": [],
      "docstring": "",
      "signature": "class SqlAlchemyUnitOfWork(AbstractUnitOfWork):",
      "body_source": "",
      "complexity": 0,
      "lines_of_code": 0,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py:SqlAlchemyUnitOfWork.__init__",
      "name": "SqlAlchemyUnitOfWork.__init__",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py",
      "start_line": 48,
      "end_line": 49,
      "role": "ApplicationService",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "session_factory",
          "default": "DEFAULT_SESSION_FACTORY"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def __init__(self, session_factory=DEFAULT_SESSION_FACTORY):",
      "body_source": "    def __init__(self, session_factory=DEFAULT_SESSION_FACTORY):\n        self.session_factory = session_factory",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py:SqlAlchemyUnitOfWork.__enter__",
      "name": "SqlAlchemyUnitOfWork.__enter__",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py",
      "start_line": 51,
      "end_line": 54,
      "role": "Lifecycle",
      "role_confidence": 95.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "self"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def __enter__(self):",
      "body_source": "    def __enter__(self):\n        self.session = self.session_factory()  # type: Session\n        self.products = repository.SqlAlchemyRepository(self.session)\n        return super().__enter__()",
      "complexity": 0,
      "lines_of_code": 3,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py:SqlAlchemyUnitOfWork.__exit__",
      "name": "SqlAlchemyUnitOfWork.__exit__",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py",
      "start_line": 56,
      "end_line": 58,
      "role": "Lifecycle",
      "role_confidence": 95.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "*args"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def __exit__(self, *args):",
      "body_source": "    def __exit__(self, *args):\n        super().__exit__(*args)\n        self.session.close()",
      "complexity": 0,
      "lines_of_code": 2,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py:SqlAlchemyUnitOfWork._commit",
      "name": "SqlAlchemyUnitOfWork._commit",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py",
      "start_line": 60,
      "end_line": 61,
      "role": "Command",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def _commit(self):",
      "body_source": "    def _commit(self):\n        self.session.commit()",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py:SqlAlchemyUnitOfWork.rollback",
      "name": "SqlAlchemyUnitOfWork.rollback",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py",
      "start_line": 63,
      "end_line": 64,
      "role": "Utility",
      "role_confidence": 60.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "self"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def rollback(self):",
      "body_source": "    def rollback(self):\n        self.session.rollback()",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/entrypoints/redis_eventconsumer.py:main",
      "name": "main",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/entrypoints/redis_eventconsumer.py",
      "start_line": 13,
      "end_line": 20,
      "role": "Controller",
      "role_confidence": 75.0,
      "discovery_method": "heuristic_pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def main():",
      "body_source": "def main():\n    logger.info(\"Redis pubsub starting\")\n    bus = bootstrap.bootstrap()\n    pubsub = r.pubsub(ignore_subscribe_messages=True)\n    pubsub.subscribe(\"change_batch_quantity\")\n\n    for m in pubsub.listen():\n        handle_change_batch_quantity(m, bus)",
      "complexity": 0,
      "lines_of_code": 7,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/entrypoints/redis_eventconsumer.py:handle_change_batch_quantity",
      "name": "handle_change_batch_quantity",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/entrypoints/redis_eventconsumer.py",
      "start_line": 23,
      "end_line": 27,
      "role": "EventHandler",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "m"
        },
        {
          "name": "bus"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def handle_change_batch_quantity(m, bus):",
      "body_source": "def handle_change_batch_quantity(m, bus):\n    logger.info(\"handling %s\", m)\n    data = json.loads(m[\"data\"])\n    cmd = commands.ChangeBatchQuantity(ref=data[\"batchref\"], qty=data[\"qty\"])\n    bus.handle(cmd)",
      "complexity": 0,
      "lines_of_code": 4,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/entrypoints/flask_app.py:add_batch",
      "name": "add_batch",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/entrypoints/flask_app.py",
      "start_line": 12,
      "end_line": 20,
      "role": "Command",
      "role_confidence": 85.0,
      "discovery_method": "heuristic_pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [
        "app.route"
      ],
      "docstring": "",
      "signature": "def add_batch():",
      "body_source": "def add_batch():\n    eta = request.json[\"eta\"]\n    if eta is not None:\n        eta = datetime.fromisoformat(eta).date()\n    cmd = commands.CreateBatch(\n        request.json[\"ref\"], request.json[\"sku\"], request.json[\"qty\"], eta\n    )\n    bus.handle(cmd)\n    return \"OK\", 201",
      "complexity": 0,
      "lines_of_code": 8,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/entrypoints/flask_app.py:allocate_endpoint",
      "name": "allocate_endpoint",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/entrypoints/flask_app.py",
      "start_line": 24,
      "end_line": 33,
      "role": "Controller",
      "role_confidence": 75.0,
      "discovery_method": "heuristic_pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [
        "app.route"
      ],
      "docstring": "",
      "signature": "def allocate_endpoint():",
      "body_source": "def allocate_endpoint():\n    try:\n        cmd = commands.Allocate(\n            request.json[\"orderid\"], request.json[\"sku\"], request.json[\"qty\"]\n        )\n        bus.handle(cmd)\n    except InvalidSku as e:\n        return {\"message\": str(e)}, 400\n\n    return \"OK\", 202",
      "complexity": 0,
      "lines_of_code": 9,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/entrypoints/flask_app.py:allocations_view_endpoint",
      "name": "allocations_view_endpoint",
      "kind": "function",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/entrypoints/flask_app.py",
      "start_line": 37,
      "end_line": 41,
      "role": "Controller",
      "role_confidence": 75.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "orderid"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [
        "app.route"
      ],
      "docstring": "",
      "signature": "def allocations_view_endpoint(orderid):",
      "body_source": "def allocations_view_endpoint(orderid):\n    result = views.allocations(orderid, bus.uow)\n    if not result:\n        return \"not found\", 404\n    return jsonify(result), 200",
      "complexity": 0,
      "lines_of_code": 4,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/events.py:Event",
      "name": "Event",
      "kind": "class",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/events.py",
      "start_line": 5,
      "end_line": 5,
      "role": "DomainEvent",
      "role_confidence": 75.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "class Event:",
      "body_source": "",
      "complexity": 0,
      "lines_of_code": 0,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/events.py:Allocated",
      "name": "Allocated",
      "kind": "class",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/events.py",
      "start_line": 10,
      "end_line": 10,
      "role": "DomainEvent",
      "role_confidence": 99.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [
        "Event"
      ],
      "decorators": [
        "dataclass"
      ],
      "docstring": "",
      "signature": "class Allocated(Event):",
      "body_source": "",
      "complexity": 0,
      "lines_of_code": 0,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/events.py:Deallocated",
      "name": "Deallocated",
      "kind": "class",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/events.py",
      "start_line": 18,
      "end_line": 18,
      "role": "DomainEvent",
      "role_confidence": 99.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [
        "Event"
      ],
      "decorators": [
        "dataclass"
      ],
      "docstring": "",
      "signature": "class Deallocated(Event):",
      "body_source": "",
      "complexity": 0,
      "lines_of_code": 0,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/events.py:OutOfStock",
      "name": "OutOfStock",
      "kind": "class",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/events.py",
      "start_line": 25,
      "end_line": 25,
      "role": "DomainEvent",
      "role_confidence": 99.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [
        "Event"
      ],
      "decorators": [
        "dataclass"
      ],
      "docstring": "",
      "signature": "class OutOfStock(Event):",
      "body_source": "",
      "complexity": 0,
      "lines_of_code": 0,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py:Product",
      "name": "Product",
      "kind": "class",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
      "start_line": 8,
      "end_line": 8,
      "role": "DTO",
      "role_confidence": 65.0,
      "discovery_method": "heuristic_pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "class Product:",
      "body_source": "",
      "complexity": 0,
      "lines_of_code": 0,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py:Product.__init__",
      "name": "Product.__init__",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
      "start_line": 9,
      "end_line": 13,
      "role": "ApplicationService",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "sku",
          "type": "str"
        },
        {
          "name": "batches",
          "type": "List[Batch]"
        },
        {
          "name": "version_number",
          "type": "int",
          "default": "0"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def __init__(self, sku: str, batches: List[Batch], version_number: int = 0):",
      "body_source": "    def __init__(self, sku: str, batches: List[Batch], version_number: int = 0):\n        self.sku = sku\n        self.batches = batches\n        self.version_number = version_number\n        self.events = []  # type: List[events.Event]",
      "complexity": 0,
      "lines_of_code": 4,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py:Product.allocate",
      "name": "Product.allocate",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
      "start_line": 15,
      "end_line": 31,
      "role": "Utility",
      "role_confidence": 60.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "line",
          "type": "OrderLine"
        }
      ],
      "return_type": "str",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def allocate(self, line: OrderLine) -> str:",
      "body_source": "    def allocate(self, line: OrderLine) -> str:\n        try:\n            batch = next(b for b in sorted(self.batches) if b.can_allocate(line))\n            batch.allocate(line)\n            self.version_number += 1\n            self.events.append(\n                events.Allocated(\n                    orderid=line.orderid,\n                    sku=line.sku,\n                    qty=line.qty,\n                    batchref=batch.reference,\n                )\n            )\n            return batch.reference\n        except StopIteration:\n            self.events.append(events.OutOfStock(line.sku))\n            return None",
      "complexity": 0,
      "lines_of_code": 16,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py:Product.change_batch_quantity",
      "name": "Product.change_batch_quantity",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
      "start_line": 33,
      "end_line": 38,
      "role": "Utility",
      "role_confidence": 60.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "ref",
          "type": "str"
        },
        {
          "name": "qty",
          "type": "int"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def change_batch_quantity(self, ref: str, qty: int):",
      "body_source": "    def change_batch_quantity(self, ref: str, qty: int):\n        batch = next(b for b in self.batches if b.reference == ref)\n        batch._purchased_quantity = qty\n        while batch.available_quantity < 0:\n            line = batch.deallocate_one()\n            self.events.append(events.Deallocated(line.orderid, line.sku, line.qty))",
      "complexity": 0,
      "lines_of_code": 5,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py:OrderLine",
      "name": "OrderLine",
      "kind": "class",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
      "start_line": 42,
      "end_line": 42,
      "role": "Query",
      "role_confidence": 75.0,
      "discovery_method": "heuristic_pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [
        "dataclass"
      ],
      "docstring": "",
      "signature": "class OrderLine:",
      "body_source": "",
      "complexity": 0,
      "lines_of_code": 0,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py:Batch",
      "name": "Batch",
      "kind": "class",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
      "start_line": 48,
      "end_line": 48,
      "role": "DTO",
      "role_confidence": 65.0,
      "discovery_method": "heuristic_pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "class Batch:",
      "body_source": "",
      "complexity": 0,
      "lines_of_code": 0,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py:Batch.__init__",
      "name": "Batch.__init__",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
      "start_line": 49,
      "end_line": 54,
      "role": "ApplicationService",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "ref",
          "type": "str"
        },
        {
          "name": "sku",
          "type": "str"
        },
        {
          "name": "qty",
          "type": "int"
        },
        {
          "name": "eta",
          "type": "Optional[date]"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def __init__(self, ref: str, sku: str, qty: int, eta: Optional[date]):",
      "body_source": "    def __init__(self, ref: str, sku: str, qty: int, eta: Optional[date]):\n        self.reference = ref\n        self.sku = sku\n        self.eta = eta\n        self._purchased_quantity = qty\n        self._allocations = set()  # type: Set[OrderLine]",
      "complexity": 0,
      "lines_of_code": 5,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py:Batch.__repr__",
      "name": "Batch.__repr__",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
      "start_line": 56,
      "end_line": 57,
      "role": "Utility",
      "role_confidence": 95.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "self"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def __repr__(self):",
      "body_source": "    def __repr__(self):\n        return f\"<Batch {self.reference}>\"",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py:Batch.__eq__",
      "name": "Batch.__eq__",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
      "start_line": 59,
      "end_line": 62,
      "role": "Specification",
      "role_confidence": 95.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "other"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def __eq__(self, other):",
      "body_source": "    def __eq__(self, other):\n        if not isinstance(other, Batch):\n            return False\n        return other.reference == self.reference",
      "complexity": 0,
      "lines_of_code": 3,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py:Batch.__hash__",
      "name": "Batch.__hash__",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
      "start_line": 64,
      "end_line": 65,
      "role": "Utility",
      "role_confidence": 95.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "self"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def __hash__(self):",
      "body_source": "    def __hash__(self):\n        return hash(self.reference)",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py:Batch.__gt__",
      "name": "Batch.__gt__",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
      "start_line": 67,
      "end_line": 72,
      "role": "Specification",
      "role_confidence": 95.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "other"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def __gt__(self, other):",
      "body_source": "    def __gt__(self, other):\n        if self.eta is None:\n            return False\n        if other.eta is None:\n            return True\n        return self.eta > other.eta",
      "complexity": 0,
      "lines_of_code": 5,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py:Batch.allocate",
      "name": "Batch.allocate",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
      "start_line": 74,
      "end_line": 76,
      "role": "Utility",
      "role_confidence": 60.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "line",
          "type": "OrderLine"
        }
      ],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def allocate(self, line: OrderLine):",
      "body_source": "    def allocate(self, line: OrderLine):\n        if self.can_allocate(line):\n            self._allocations.add(line)",
      "complexity": 0,
      "lines_of_code": 2,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py:Batch.deallocate_one",
      "name": "Batch.deallocate_one",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
      "start_line": 78,
      "end_line": 79,
      "role": "Utility",
      "role_confidence": 60.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "self"
        }
      ],
      "return_type": "OrderLine",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def deallocate_one(self) -> OrderLine:",
      "body_source": "    def deallocate_one(self) -> OrderLine:\n        return self._allocations.pop()",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py:Batch.allocated_quantity",
      "name": "Batch.allocated_quantity",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
      "start_line": 82,
      "end_line": 83,
      "role": "Utility",
      "role_confidence": 60.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "self"
        }
      ],
      "return_type": "int",
      "base_classes": [],
      "decorators": [
        "property"
      ],
      "docstring": "",
      "signature": "def allocated_quantity(self) -> int:",
      "body_source": "    def allocated_quantity(self) -> int:\n        return sum(line.qty for line in self._allocations)",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py:Batch.available_quantity",
      "name": "Batch.available_quantity",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
      "start_line": 86,
      "end_line": 87,
      "role": "Utility",
      "role_confidence": 60.0,
      "discovery_method": "heuristic_pattern",
      "params": [
        {
          "name": "self"
        }
      ],
      "return_type": "int",
      "base_classes": [],
      "decorators": [
        "property"
      ],
      "docstring": "",
      "signature": "def available_quantity(self) -> int:",
      "body_source": "    def available_quantity(self) -> int:\n        return self._purchased_quantity - self.allocated_quantity",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py:Batch.can_allocate",
      "name": "Batch.can_allocate",
      "kind": "method",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
      "start_line": 89,
      "end_line": 90,
      "role": "Specification",
      "role_confidence": 70.0,
      "discovery_method": "pattern",
      "params": [
        {
          "name": "self"
        },
        {
          "name": "line",
          "type": "OrderLine"
        }
      ],
      "return_type": "bool",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "def can_allocate(self, line: OrderLine) -> bool:",
      "body_source": "    def can_allocate(self, line: OrderLine) -> bool:\n        return self.sku == line.sku and self.available_quantity >= line.qty",
      "complexity": 0,
      "lines_of_code": 1,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/commands.py:Command",
      "name": "Command",
      "kind": "class",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/commands.py",
      "start_line": 7,
      "end_line": 7,
      "role": "Command",
      "role_confidence": 75.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [],
      "decorators": [],
      "docstring": "",
      "signature": "class Command:",
      "body_source": "",
      "complexity": 0,
      "lines_of_code": 0,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/commands.py:Allocate",
      "name": "Allocate",
      "kind": "class",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/commands.py",
      "start_line": 12,
      "end_line": 12,
      "role": "Command",
      "role_confidence": 99.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [
        "Command"
      ],
      "decorators": [
        "dataclass"
      ],
      "docstring": "",
      "signature": "class Allocate(Command):",
      "body_source": "",
      "complexity": 0,
      "lines_of_code": 0,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/commands.py:CreateBatch",
      "name": "CreateBatch",
      "kind": "class",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/commands.py",
      "start_line": 19,
      "end_line": 19,
      "role": "Command",
      "role_confidence": 99.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [
        "Command"
      ],
      "decorators": [
        "dataclass"
      ],
      "docstring": "",
      "signature": "class CreateBatch(Command):",
      "body_source": "",
      "complexity": 0,
      "lines_of_code": 0,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    },
    {
      "id": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/commands.py:ChangeBatchQuantity",
      "name": "ChangeBatchQuantity",
      "kind": "class",
      "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/commands.py",
      "start_line": 27,
      "end_line": 27,
      "role": "Command",
      "role_confidence": 99.0,
      "discovery_method": "pattern",
      "params": [],
      "return_type": "",
      "base_classes": [
        "Command"
      ],
      "decorators": [
        "dataclass"
      ],
      "docstring": "",
      "signature": "class ChangeBatchQuantity(Command):",
      "body_source": "",
      "complexity": 0,
      "lines_of_code": 0,
      "in_degree": 0,
      "out_degree": 0,
      "layer": null,
      "metadata": {}
    }
  ],
  "edges": [
    {
      "source": "FakeRepository",
      "target": "FakeRepository.__init__",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 15,
      "metadata": {}
    },
    {
      "source": "FakeRepository",
      "target": "FakeRepository._add",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 19,
      "metadata": {}
    },
    {
      "source": "FakeRepository",
      "target": "FakeRepository._get",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 22,
      "metadata": {}
    },
    {
      "source": "FakeRepository",
      "target": "FakeRepository._get_by_batchref",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 25,
      "metadata": {}
    },
    {
      "source": "FakeUnitOfWork",
      "target": "FakeUnitOfWork.__init__",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 33,
      "metadata": {}
    },
    {
      "source": "FakeUnitOfWork",
      "target": "FakeUnitOfWork._commit",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 37,
      "metadata": {}
    },
    {
      "source": "FakeUnitOfWork",
      "target": "FakeUnitOfWork.rollback",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 40,
      "metadata": {}
    },
    {
      "source": "FakeNotifications",
      "target": "FakeNotifications.__init__",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 45,
      "metadata": {}
    },
    {
      "source": "FakeNotifications",
      "target": "FakeNotifications.send",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 48,
      "metadata": {}
    },
    {
      "source": "TestAddBatch",
      "target": "TestAddBatch.test_for_new_product",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 62,
      "metadata": {}
    },
    {
      "source": "TestAddBatch",
      "target": "TestAddBatch.test_for_existing_product",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 68,
      "metadata": {}
    },
    {
      "source": "TestAllocate",
      "target": "TestAllocate.test_allocates",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 78,
      "metadata": {}
    },
    {
      "source": "TestAllocate",
      "target": "TestAllocate.test_errors_for_invalid_sku",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 85,
      "metadata": {}
    },
    {
      "source": "TestAllocate",
      "target": "TestAllocate.test_commits",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 92,
      "metadata": {}
    },
    {
      "source": "TestAllocate",
      "target": "TestAllocate.test_sends_email_on_out_of_stock_error",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 98,
      "metadata": {}
    },
    {
      "source": "TestChangeBatchQuantity",
      "target": "TestChangeBatchQuantity.test_changes_available_quantity",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 114,
      "metadata": {}
    },
    {
      "source": "TestChangeBatchQuantity",
      "target": "TestChangeBatchQuantity.test_reallocates_if_necessary",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 123,
      "metadata": {}
    },
    {
      "source": "test_rolls_back_on_error",
      "target": "MyException",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 67,
      "metadata": {}
    },
    {
      "source": "AbstractNotifications",
      "target": "AbstractNotifications.send",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 9,
      "metadata": {}
    },
    {
      "source": "EmailNotifications",
      "target": "EmailNotifications.__init__",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 18,
      "metadata": {}
    },
    {
      "source": "EmailNotifications",
      "target": "EmailNotifications.send",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 22,
      "metadata": {}
    },
    {
      "source": "AbstractRepository",
      "target": "AbstractRepository.__init__",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 8,
      "metadata": {}
    },
    {
      "source": "AbstractRepository",
      "target": "AbstractRepository.add",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 11,
      "metadata": {}
    },
    {
      "source": "AbstractRepository",
      "target": "AbstractRepository.get",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 15,
      "metadata": {}
    },
    {
      "source": "AbstractRepository",
      "target": "AbstractRepository.get_by_batchref",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 21,
      "metadata": {}
    },
    {
      "source": "AbstractRepository",
      "target": "AbstractRepository._add",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 28,
      "metadata": {}
    },
    {
      "source": "AbstractRepository",
      "target": "AbstractRepository._get",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 32,
      "metadata": {}
    },
    {
      "source": "AbstractRepository",
      "target": "AbstractRepository._get_by_batchref",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 36,
      "metadata": {}
    },
    {
      "source": "SqlAlchemyRepository",
      "target": "SqlAlchemyRepository.__init__",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 41,
      "metadata": {}
    },
    {
      "source": "SqlAlchemyRepository",
      "target": "SqlAlchemyRepository._add",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 45,
      "metadata": {}
    },
    {
      "source": "SqlAlchemyRepository",
      "target": "SqlAlchemyRepository._get",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 48,
      "metadata": {}
    },
    {
      "source": "SqlAlchemyRepository",
      "target": "SqlAlchemyRepository._get_by_batchref",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 51,
      "metadata": {}
    },
    {
      "source": "MessageBus",
      "target": "MessageBus.__init__",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 16,
      "metadata": {}
    },
    {
      "source": "MessageBus",
      "target": "MessageBus.handle",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 26,
      "metadata": {}
    },
    {
      "source": "MessageBus",
      "target": "MessageBus.handle_event",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 37,
      "metadata": {}
    },
    {
      "source": "MessageBus",
      "target": "MessageBus.handle_command",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 47,
      "metadata": {}
    },
    {
      "source": "AbstractUnitOfWork",
      "target": "AbstractUnitOfWork.__enter__",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 16,
      "metadata": {}
    },
    {
      "source": "AbstractUnitOfWork",
      "target": "AbstractUnitOfWork.__exit__",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 19,
      "metadata": {}
    },
    {
      "source": "AbstractUnitOfWork",
      "target": "AbstractUnitOfWork.commit",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 22,
      "metadata": {}
    },
    {
      "source": "AbstractUnitOfWork",
      "target": "AbstractUnitOfWork.collect_new_events",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 25,
      "metadata": {}
    },
    {
      "source": "AbstractUnitOfWork",
      "target": "AbstractUnitOfWork._commit",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 31,
      "metadata": {}
    },
    {
      "source": "AbstractUnitOfWork",
      "target": "AbstractUnitOfWork.rollback",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 35,
      "metadata": {}
    },
    {
      "source": "SqlAlchemyUnitOfWork",
      "target": "SqlAlchemyUnitOfWork.__init__",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 48,
      "metadata": {}
    },
    {
      "source": "SqlAlchemyUnitOfWork",
      "target": "SqlAlchemyUnitOfWork.__enter__",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 51,
      "metadata": {}
    },
    {
      "source": "SqlAlchemyUnitOfWork",
      "target": "SqlAlchemyUnitOfWork.__exit__",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 56,
      "metadata": {}
    },
    {
      "source": "SqlAlchemyUnitOfWork",
      "target": "SqlAlchemyUnitOfWork._commit",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 60,
      "metadata": {}
    },
    {
      "source": "SqlAlchemyUnitOfWork",
      "target": "SqlAlchemyUnitOfWork.rollback",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 63,
      "metadata": {}
    },
    {
      "source": "Product",
      "target": "Product.__init__",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 9,
      "metadata": {}
    },
    {
      "source": "Product",
      "target": "Product.allocate",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 15,
      "metadata": {}
    },
    {
      "source": "Product",
      "target": "Product.change_batch_quantity",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 33,
      "metadata": {}
    },
    {
      "source": "Batch",
      "target": "Batch.__init__",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 49,
      "metadata": {}
    },
    {
      "source": "Batch",
      "target": "Batch.__repr__",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 56,
      "metadata": {}
    },
    {
      "source": "Batch",
      "target": "Batch.__eq__",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 59,
      "metadata": {}
    },
    {
      "source": "Batch",
      "target": "Batch.__hash__",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 64,
      "metadata": {}
    },
    {
      "source": "Batch",
      "target": "Batch.__gt__",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 67,
      "metadata": {}
    },
    {
      "source": "Batch",
      "target": "Batch.allocate",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 74,
      "metadata": {}
    },
    {
      "source": "Batch",
      "target": "Batch.deallocate_one",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 78,
      "metadata": {}
    },
    {
      "source": "Batch",
      "target": "Batch.allocated_quantity",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 82,
      "metadata": {}
    },
    {
      "source": "Batch",
      "target": "Batch.available_quantity",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 86,
      "metadata": {}
    },
    {
      "source": "Batch",
      "target": "Batch.can_allocate",
      "edge_type": "contains",
      "weight": 1.0,
      "confidence": 1.0,
      "file_path": "",
      "line": 89,
      "metadata": {}
    },
    {
      "source": "mappers",
      "target": "start_mappers",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 33,
      "metadata": {}
    },
    {
      "source": "wait_for_webapp_to_come_up",
      "target": "get",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 45,
      "metadata": {}
    },
    {
      "source": "wait_for_webapp_to_come_up",
      "target": "get_api_url",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 45,
      "metadata": {}
    },
    {
      "source": "wait_for_redis_to_come_up",
      "target": "get_redis_host_and_port",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 50,
      "metadata": {}
    },
    {
      "source": "postgres_db",
      "target": "get_postgres_uri",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 56,
      "metadata": {}
    },
    {
      "source": "postgres_db",
      "target": "wait_for_postgres_to_come_up",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 56,
      "metadata": {}
    },
    {
      "source": "postgres_session",
      "target": "postgres_session_factory",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 69,
      "metadata": {}
    },
    {
      "source": "restart_api",
      "target": "wait_for_webapp_to_come_up",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 74,
      "metadata": {}
    },
    {
      "source": "restart_redis_pubsub",
      "target": "wait_for_redis_to_come_up",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 81,
      "metadata": {}
    },
    {
      "source": "random_sku",
      "target": "random_suffix",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 8,
      "metadata": {}
    },
    {
      "source": "random_batchref",
      "target": "random_suffix",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 12,
      "metadata": {}
    },
    {
      "source": "random_orderid",
      "target": "random_suffix",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 16,
      "metadata": {}
    },
    {
      "source": "FakeRepository._add",
      "target": "add",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 19,
      "metadata": {}
    },
    {
      "source": "FakeUnitOfWork.__init__",
      "target": "FakeRepository",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 33,
      "metadata": {}
    },
    {
      "source": "bootstrap_test_app",
      "target": "bootstrap",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 52,
      "metadata": {}
    },
    {
      "source": "bootstrap_test_app",
      "target": "FakeUnitOfWork",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 52,
      "metadata": {}
    },
    {
      "source": "bootstrap_test_app",
      "target": "FakeNotifications",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 52,
      "metadata": {}
    },
    {
      "source": "TestAddBatch.test_for_new_product",
      "target": "bootstrap_test_app",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 62,
      "metadata": {}
    },
    {
      "source": "TestAddBatch.test_for_new_product",
      "target": "handle",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 62,
      "metadata": {}
    },
    {
      "source": "TestAddBatch.test_for_new_product",
      "target": "CreateBatch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 62,
      "metadata": {}
    },
    {
      "source": "TestAddBatch.test_for_new_product",
      "target": "get",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 62,
      "metadata": {}
    },
    {
      "source": "TestAddBatch.test_for_existing_product",
      "target": "bootstrap_test_app",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 68,
      "metadata": {}
    },
    {
      "source": "TestAddBatch.test_for_existing_product",
      "target": "handle",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 68,
      "metadata": {}
    },
    {
      "source": "TestAddBatch.test_for_existing_product",
      "target": "CreateBatch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 68,
      "metadata": {}
    },
    {
      "source": "TestAddBatch.test_for_existing_product",
      "target": "handle",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 68,
      "metadata": {}
    },
    {
      "source": "TestAddBatch.test_for_existing_product",
      "target": "CreateBatch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 68,
      "metadata": {}
    },
    {
      "source": "TestAddBatch.test_for_existing_product",
      "target": "get",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 68,
      "metadata": {}
    },
    {
      "source": "TestAllocate.test_allocates",
      "target": "bootstrap_test_app",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 78,
      "metadata": {}
    },
    {
      "source": "TestAllocate.test_allocates",
      "target": "handle",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 78,
      "metadata": {}
    },
    {
      "source": "TestAllocate.test_allocates",
      "target": "CreateBatch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 78,
      "metadata": {}
    },
    {
      "source": "TestAllocate.test_allocates",
      "target": "handle",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 78,
      "metadata": {}
    },
    {
      "source": "TestAllocate.test_allocates",
      "target": "Allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 78,
      "metadata": {}
    },
    {
      "source": "TestAllocate.test_allocates",
      "target": "get",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 78,
      "metadata": {}
    },
    {
      "source": "TestAllocate.test_errors_for_invalid_sku",
      "target": "bootstrap_test_app",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 85,
      "metadata": {}
    },
    {
      "source": "TestAllocate.test_errors_for_invalid_sku",
      "target": "handle",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 85,
      "metadata": {}
    },
    {
      "source": "TestAllocate.test_errors_for_invalid_sku",
      "target": "CreateBatch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 85,
      "metadata": {}
    },
    {
      "source": "TestAllocate.test_errors_for_invalid_sku",
      "target": "handle",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 85,
      "metadata": {}
    },
    {
      "source": "TestAllocate.test_errors_for_invalid_sku",
      "target": "Allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 85,
      "metadata": {}
    },
    {
      "source": "TestAllocate.test_commits",
      "target": "bootstrap_test_app",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 92,
      "metadata": {}
    },
    {
      "source": "TestAllocate.test_commits",
      "target": "handle",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 92,
      "metadata": {}
    },
    {
      "source": "TestAllocate.test_commits",
      "target": "CreateBatch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 92,
      "metadata": {}
    },
    {
      "source": "TestAllocate.test_commits",
      "target": "handle",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 92,
      "metadata": {}
    },
    {
      "source": "TestAllocate.test_commits",
      "target": "Allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 92,
      "metadata": {}
    },
    {
      "source": "TestAllocate.test_sends_email_on_out_of_stock_error",
      "target": "FakeNotifications",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 98,
      "metadata": {}
    },
    {
      "source": "TestAllocate.test_sends_email_on_out_of_stock_error",
      "target": "bootstrap",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 98,
      "metadata": {}
    },
    {
      "source": "TestAllocate.test_sends_email_on_out_of_stock_error",
      "target": "FakeUnitOfWork",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 98,
      "metadata": {}
    },
    {
      "source": "TestAllocate.test_sends_email_on_out_of_stock_error",
      "target": "handle",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 98,
      "metadata": {}
    },
    {
      "source": "TestAllocate.test_sends_email_on_out_of_stock_error",
      "target": "CreateBatch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 98,
      "metadata": {}
    },
    {
      "source": "TestAllocate.test_sends_email_on_out_of_stock_error",
      "target": "handle",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 98,
      "metadata": {}
    },
    {
      "source": "TestAllocate.test_sends_email_on_out_of_stock_error",
      "target": "Allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 98,
      "metadata": {}
    },
    {
      "source": "TestChangeBatchQuantity.test_changes_available_quantity",
      "target": "bootstrap_test_app",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 114,
      "metadata": {}
    },
    {
      "source": "TestChangeBatchQuantity.test_changes_available_quantity",
      "target": "handle",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 114,
      "metadata": {}
    },
    {
      "source": "TestChangeBatchQuantity.test_changes_available_quantity",
      "target": "CreateBatch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 114,
      "metadata": {}
    },
    {
      "source": "TestChangeBatchQuantity.test_changes_available_quantity",
      "target": "get",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 114,
      "metadata": {}
    },
    {
      "source": "TestChangeBatchQuantity.test_changes_available_quantity",
      "target": "handle",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 114,
      "metadata": {}
    },
    {
      "source": "TestChangeBatchQuantity.test_changes_available_quantity",
      "target": "ChangeBatchQuantity",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 114,
      "metadata": {}
    },
    {
      "source": "TestChangeBatchQuantity.test_reallocates_if_necessary",
      "target": "bootstrap_test_app",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 123,
      "metadata": {}
    },
    {
      "source": "TestChangeBatchQuantity.test_reallocates_if_necessary",
      "target": "CreateBatch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 123,
      "metadata": {}
    },
    {
      "source": "TestChangeBatchQuantity.test_reallocates_if_necessary",
      "target": "CreateBatch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 123,
      "metadata": {}
    },
    {
      "source": "TestChangeBatchQuantity.test_reallocates_if_necessary",
      "target": "Allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 123,
      "metadata": {}
    },
    {
      "source": "TestChangeBatchQuantity.test_reallocates_if_necessary",
      "target": "Allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 123,
      "metadata": {}
    },
    {
      "source": "TestChangeBatchQuantity.test_reallocates_if_necessary",
      "target": "handle",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 123,
      "metadata": {}
    },
    {
      "source": "TestChangeBatchQuantity.test_reallocates_if_necessary",
      "target": "get",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 123,
      "metadata": {}
    },
    {
      "source": "TestChangeBatchQuantity.test_reallocates_if_necessary",
      "target": "handle",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 123,
      "metadata": {}
    },
    {
      "source": "TestChangeBatchQuantity.test_reallocates_if_necessary",
      "target": "ChangeBatchQuantity",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 123,
      "metadata": {}
    },
    {
      "source": "test_prefers_warehouse_batches_to_shipments",
      "target": "Batch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 11,
      "metadata": {}
    },
    {
      "source": "test_prefers_warehouse_batches_to_shipments",
      "target": "Batch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 11,
      "metadata": {}
    },
    {
      "source": "test_prefers_warehouse_batches_to_shipments",
      "target": "Product",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 11,
      "metadata": {}
    },
    {
      "source": "test_prefers_warehouse_batches_to_shipments",
      "target": "OrderLine",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 11,
      "metadata": {}
    },
    {
      "source": "test_prefers_warehouse_batches_to_shipments",
      "target": "allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 11,
      "metadata": {}
    },
    {
      "source": "test_prefers_earlier_batches",
      "target": "Batch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 23,
      "metadata": {}
    },
    {
      "source": "test_prefers_earlier_batches",
      "target": "Batch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 23,
      "metadata": {}
    },
    {
      "source": "test_prefers_earlier_batches",
      "target": "Batch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 23,
      "metadata": {}
    },
    {
      "source": "test_prefers_earlier_batches",
      "target": "Product",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 23,
      "metadata": {}
    },
    {
      "source": "test_prefers_earlier_batches",
      "target": "OrderLine",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 23,
      "metadata": {}
    },
    {
      "source": "test_prefers_earlier_batches",
      "target": "allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 23,
      "metadata": {}
    },
    {
      "source": "test_returns_allocated_batch_ref",
      "target": "Batch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 37,
      "metadata": {}
    },
    {
      "source": "test_returns_allocated_batch_ref",
      "target": "Batch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 37,
      "metadata": {}
    },
    {
      "source": "test_returns_allocated_batch_ref",
      "target": "OrderLine",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 37,
      "metadata": {}
    },
    {
      "source": "test_returns_allocated_batch_ref",
      "target": "Product",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 37,
      "metadata": {}
    },
    {
      "source": "test_returns_allocated_batch_ref",
      "target": "allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 37,
      "metadata": {}
    },
    {
      "source": "test_outputs_allocated_event",
      "target": "Batch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 46,
      "metadata": {}
    },
    {
      "source": "test_outputs_allocated_event",
      "target": "OrderLine",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 46,
      "metadata": {}
    },
    {
      "source": "test_outputs_allocated_event",
      "target": "Product",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 46,
      "metadata": {}
    },
    {
      "source": "test_outputs_allocated_event",
      "target": "allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 46,
      "metadata": {}
    },
    {
      "source": "test_outputs_allocated_event",
      "target": "Allocated",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 46,
      "metadata": {}
    },
    {
      "source": "test_records_out_of_stock_event_if_cannot_allocate",
      "target": "Batch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 57,
      "metadata": {}
    },
    {
      "source": "test_records_out_of_stock_event_if_cannot_allocate",
      "target": "Product",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 57,
      "metadata": {}
    },
    {
      "source": "test_records_out_of_stock_event_if_cannot_allocate",
      "target": "allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 57,
      "metadata": {}
    },
    {
      "source": "test_records_out_of_stock_event_if_cannot_allocate",
      "target": "OrderLine",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 57,
      "metadata": {}
    },
    {
      "source": "test_records_out_of_stock_event_if_cannot_allocate",
      "target": "allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 57,
      "metadata": {}
    },
    {
      "source": "test_records_out_of_stock_event_if_cannot_allocate",
      "target": "OrderLine",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 57,
      "metadata": {}
    },
    {
      "source": "test_records_out_of_stock_event_if_cannot_allocate",
      "target": "OutOfStock",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 57,
      "metadata": {}
    },
    {
      "source": "test_increments_version_number",
      "target": "OrderLine",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 67,
      "metadata": {}
    },
    {
      "source": "test_increments_version_number",
      "target": "Product",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 67,
      "metadata": {}
    },
    {
      "source": "test_increments_version_number",
      "target": "Batch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 67,
      "metadata": {}
    },
    {
      "source": "test_increments_version_number",
      "target": "allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 67,
      "metadata": {}
    },
    {
      "source": "test_allocating_to_a_batch_reduces_the_available_quantity",
      "target": "Batch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 5,
      "metadata": {}
    },
    {
      "source": "test_allocating_to_a_batch_reduces_the_available_quantity",
      "target": "OrderLine",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 5,
      "metadata": {}
    },
    {
      "source": "test_allocating_to_a_batch_reduces_the_available_quantity",
      "target": "allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 5,
      "metadata": {}
    },
    {
      "source": "make_batch_and_line",
      "target": "Batch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 14,
      "metadata": {}
    },
    {
      "source": "make_batch_and_line",
      "target": "OrderLine",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 14,
      "metadata": {}
    },
    {
      "source": "test_can_allocate_if_available_greater_than_required",
      "target": "make_batch_and_line",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 21,
      "metadata": {}
    },
    {
      "source": "test_can_allocate_if_available_greater_than_required",
      "target": "can_allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 21,
      "metadata": {}
    },
    {
      "source": "test_cannot_allocate_if_available_smaller_than_required",
      "target": "make_batch_and_line",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 26,
      "metadata": {}
    },
    {
      "source": "test_cannot_allocate_if_available_smaller_than_required",
      "target": "can_allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 26,
      "metadata": {}
    },
    {
      "source": "test_can_allocate_if_available_equal_to_required",
      "target": "make_batch_and_line",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 31,
      "metadata": {}
    },
    {
      "source": "test_can_allocate_if_available_equal_to_required",
      "target": "can_allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 31,
      "metadata": {}
    },
    {
      "source": "test_cannot_allocate_if_skus_do_not_match",
      "target": "Batch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 36,
      "metadata": {}
    },
    {
      "source": "test_cannot_allocate_if_skus_do_not_match",
      "target": "OrderLine",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 36,
      "metadata": {}
    },
    {
      "source": "test_cannot_allocate_if_skus_do_not_match",
      "target": "can_allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 36,
      "metadata": {}
    },
    {
      "source": "test_allocation_is_idempotent",
      "target": "make_batch_and_line",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 42,
      "metadata": {}
    },
    {
      "source": "test_allocation_is_idempotent",
      "target": "allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 42,
      "metadata": {}
    },
    {
      "source": "test_allocation_is_idempotent",
      "target": "allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 42,
      "metadata": {}
    },
    {
      "source": "test_get_by_batchref",
      "target": "sqlite_session_factory",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 8,
      "metadata": {}
    },
    {
      "source": "test_get_by_batchref",
      "target": "SqlAlchemyRepository",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 8,
      "metadata": {}
    },
    {
      "source": "test_get_by_batchref",
      "target": "Batch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 8,
      "metadata": {}
    },
    {
      "source": "test_get_by_batchref",
      "target": "Batch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 8,
      "metadata": {}
    },
    {
      "source": "test_get_by_batchref",
      "target": "Batch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 8,
      "metadata": {}
    },
    {
      "source": "test_get_by_batchref",
      "target": "Product",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 8,
      "metadata": {}
    },
    {
      "source": "test_get_by_batchref",
      "target": "Product",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 8,
      "metadata": {}
    },
    {
      "source": "test_get_by_batchref",
      "target": "add",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 8,
      "metadata": {}
    },
    {
      "source": "test_get_by_batchref",
      "target": "add",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 8,
      "metadata": {}
    },
    {
      "source": "test_get_by_batchref",
      "target": "get_by_batchref",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 8,
      "metadata": {}
    },
    {
      "source": "test_get_by_batchref",
      "target": "get_by_batchref",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 8,
      "metadata": {}
    },
    {
      "source": "bus",
      "target": "bootstrap",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 13,
      "metadata": {}
    },
    {
      "source": "bus",
      "target": "SqlAlchemyUnitOfWork",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 13,
      "metadata": {}
    },
    {
      "source": "bus",
      "target": "EmailNotifications",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 13,
      "metadata": {}
    },
    {
      "source": "get_email_from_mailhog",
      "target": "get_email_host_and_port",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 24,
      "metadata": {}
    },
    {
      "source": "get_email_from_mailhog",
      "target": "get",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 24,
      "metadata": {}
    },
    {
      "source": "test_out_of_stock_email",
      "target": "random_sku",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 30,
      "metadata": {}
    },
    {
      "source": "test_out_of_stock_email",
      "target": "handle",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 30,
      "metadata": {}
    },
    {
      "source": "test_out_of_stock_email",
      "target": "CreateBatch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 30,
      "metadata": {}
    },
    {
      "source": "test_out_of_stock_email",
      "target": "handle",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 30,
      "metadata": {}
    },
    {
      "source": "test_out_of_stock_email",
      "target": "Allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 30,
      "metadata": {}
    },
    {
      "source": "test_out_of_stock_email",
      "target": "get_email_from_mailhog",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 30,
      "metadata": {}
    },
    {
      "source": "sqlite_bus",
      "target": "bootstrap",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 14,
      "metadata": {}
    },
    {
      "source": "sqlite_bus",
      "target": "SqlAlchemyUnitOfWork",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 14,
      "metadata": {}
    },
    {
      "source": "test_allocations_view",
      "target": "handle",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 25,
      "metadata": {}
    },
    {
      "source": "test_allocations_view",
      "target": "CreateBatch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 25,
      "metadata": {}
    },
    {
      "source": "test_allocations_view",
      "target": "handle",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 25,
      "metadata": {}
    },
    {
      "source": "test_allocations_view",
      "target": "CreateBatch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 25,
      "metadata": {}
    },
    {
      "source": "test_allocations_view",
      "target": "handle",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 25,
      "metadata": {}
    },
    {
      "source": "test_allocations_view",
      "target": "Allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 25,
      "metadata": {}
    },
    {
      "source": "test_allocations_view",
      "target": "handle",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 25,
      "metadata": {}
    },
    {
      "source": "test_allocations_view",
      "target": "Allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 25,
      "metadata": {}
    },
    {
      "source": "test_allocations_view",
      "target": "handle",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 25,
      "metadata": {}
    },
    {
      "source": "test_allocations_view",
      "target": "CreateBatch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 25,
      "metadata": {}
    },
    {
      "source": "test_allocations_view",
      "target": "handle",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 25,
      "metadata": {}
    },
    {
      "source": "test_allocations_view",
      "target": "Allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 25,
      "metadata": {}
    },
    {
      "source": "test_allocations_view",
      "target": "handle",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 25,
      "metadata": {}
    },
    {
      "source": "test_allocations_view",
      "target": "Allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 25,
      "metadata": {}
    },
    {
      "source": "test_allocations_view",
      "target": "allocations",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 25,
      "metadata": {}
    },
    {
      "source": "test_deallocation",
      "target": "handle",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 41,
      "metadata": {}
    },
    {
      "source": "test_deallocation",
      "target": "CreateBatch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 41,
      "metadata": {}
    },
    {
      "source": "test_deallocation",
      "target": "handle",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 41,
      "metadata": {}
    },
    {
      "source": "test_deallocation",
      "target": "CreateBatch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 41,
      "metadata": {}
    },
    {
      "source": "test_deallocation",
      "target": "handle",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 41,
      "metadata": {}
    },
    {
      "source": "test_deallocation",
      "target": "Allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 41,
      "metadata": {}
    },
    {
      "source": "test_deallocation",
      "target": "handle",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 41,
      "metadata": {}
    },
    {
      "source": "test_deallocation",
      "target": "ChangeBatchQuantity",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 41,
      "metadata": {}
    },
    {
      "source": "test_deallocation",
      "target": "allocations",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 41,
      "metadata": {}
    },
    {
      "source": "test_uow_can_retrieve_a_batch_and_allocate_to_it",
      "target": "sqlite_session_factory",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 40,
      "metadata": {}
    },
    {
      "source": "test_uow_can_retrieve_a_batch_and_allocate_to_it",
      "target": "insert_batch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 40,
      "metadata": {}
    },
    {
      "source": "test_uow_can_retrieve_a_batch_and_allocate_to_it",
      "target": "commit",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 40,
      "metadata": {}
    },
    {
      "source": "test_uow_can_retrieve_a_batch_and_allocate_to_it",
      "target": "SqlAlchemyUnitOfWork",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 40,
      "metadata": {}
    },
    {
      "source": "test_uow_can_retrieve_a_batch_and_allocate_to_it",
      "target": "get",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 40,
      "metadata": {}
    },
    {
      "source": "test_uow_can_retrieve_a_batch_and_allocate_to_it",
      "target": "OrderLine",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 40,
      "metadata": {}
    },
    {
      "source": "test_uow_can_retrieve_a_batch_and_allocate_to_it",
      "target": "allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 40,
      "metadata": {}
    },
    {
      "source": "test_uow_can_retrieve_a_batch_and_allocate_to_it",
      "target": "commit",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 40,
      "metadata": {}
    },
    {
      "source": "test_uow_can_retrieve_a_batch_and_allocate_to_it",
      "target": "get_allocated_batch_ref",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 40,
      "metadata": {}
    },
    {
      "source": "test_rolls_back_uncommitted_work_by_default",
      "target": "SqlAlchemyUnitOfWork",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 56,
      "metadata": {}
    },
    {
      "source": "test_rolls_back_uncommitted_work_by_default",
      "target": "insert_batch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 56,
      "metadata": {}
    },
    {
      "source": "test_rolls_back_uncommitted_work_by_default",
      "target": "sqlite_session_factory",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 56,
      "metadata": {}
    },
    {
      "source": "test_rolls_back_on_error",
      "target": "MyException",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 66,
      "metadata": {}
    },
    {
      "source": "test_rolls_back_on_error",
      "target": "SqlAlchemyUnitOfWork",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 66,
      "metadata": {}
    },
    {
      "source": "test_rolls_back_on_error",
      "target": "insert_batch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 66,
      "metadata": {}
    },
    {
      "source": "test_rolls_back_on_error",
      "target": "MyException",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 66,
      "metadata": {}
    },
    {
      "source": "test_rolls_back_on_error",
      "target": "sqlite_session_factory",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 66,
      "metadata": {}
    },
    {
      "source": "try_to_allocate",
      "target": "OrderLine",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 81,
      "metadata": {}
    },
    {
      "source": "try_to_allocate",
      "target": "SqlAlchemyUnitOfWork",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 81,
      "metadata": {}
    },
    {
      "source": "try_to_allocate",
      "target": "get",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 81,
      "metadata": {}
    },
    {
      "source": "try_to_allocate",
      "target": "allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 81,
      "metadata": {}
    },
    {
      "source": "try_to_allocate",
      "target": "commit",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 81,
      "metadata": {}
    },
    {
      "source": "test_concurrent_updates_to_version_are_not_allowed",
      "target": "random_sku",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 94,
      "metadata": {}
    },
    {
      "source": "test_concurrent_updates_to_version_are_not_allowed",
      "target": "random_batchref",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 94,
      "metadata": {}
    },
    {
      "source": "test_concurrent_updates_to_version_are_not_allowed",
      "target": "postgres_session_factory",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 94,
      "metadata": {}
    },
    {
      "source": "test_concurrent_updates_to_version_are_not_allowed",
      "target": "insert_batch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 94,
      "metadata": {}
    },
    {
      "source": "test_concurrent_updates_to_version_are_not_allowed",
      "target": "commit",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 94,
      "metadata": {}
    },
    {
      "source": "test_concurrent_updates_to_version_are_not_allowed",
      "target": "random_orderid",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 94,
      "metadata": {}
    },
    {
      "source": "test_concurrent_updates_to_version_are_not_allowed",
      "target": "random_orderid",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 94,
      "metadata": {}
    },
    {
      "source": "test_concurrent_updates_to_version_are_not_allowed",
      "target": "try_to_allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 94,
      "metadata": {}
    },
    {
      "source": "test_concurrent_updates_to_version_are_not_allowed",
      "target": "try_to_allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 94,
      "metadata": {}
    },
    {
      "source": "test_concurrent_updates_to_version_are_not_allowed",
      "target": "SqlAlchemyUnitOfWork",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 94,
      "metadata": {}
    },
    {
      "source": "publish_message",
      "target": "publish",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 17,
      "metadata": {}
    },
    {
      "source": "test_happy_path_returns_202_and_batch_is_allocated",
      "target": "random_orderid",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 8,
      "metadata": {}
    },
    {
      "source": "test_happy_path_returns_202_and_batch_is_allocated",
      "target": "random_sku",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 8,
      "metadata": {}
    },
    {
      "source": "test_happy_path_returns_202_and_batch_is_allocated",
      "target": "random_sku",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 8,
      "metadata": {}
    },
    {
      "source": "test_happy_path_returns_202_and_batch_is_allocated",
      "target": "random_batchref",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 8,
      "metadata": {}
    },
    {
      "source": "test_happy_path_returns_202_and_batch_is_allocated",
      "target": "random_batchref",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 8,
      "metadata": {}
    },
    {
      "source": "test_happy_path_returns_202_and_batch_is_allocated",
      "target": "random_batchref",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 8,
      "metadata": {}
    },
    {
      "source": "test_happy_path_returns_202_and_batch_is_allocated",
      "target": "post_to_add_batch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 8,
      "metadata": {}
    },
    {
      "source": "test_happy_path_returns_202_and_batch_is_allocated",
      "target": "post_to_add_batch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 8,
      "metadata": {}
    },
    {
      "source": "test_happy_path_returns_202_and_batch_is_allocated",
      "target": "post_to_add_batch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 8,
      "metadata": {}
    },
    {
      "source": "test_happy_path_returns_202_and_batch_is_allocated",
      "target": "post_to_allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 8,
      "metadata": {}
    },
    {
      "source": "test_happy_path_returns_202_and_batch_is_allocated",
      "target": "get_allocation",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 8,
      "metadata": {}
    },
    {
      "source": "test_unhappy_path_returns_400_and_error_message",
      "target": "random_sku",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 30,
      "metadata": {}
    },
    {
      "source": "test_unhappy_path_returns_400_and_error_message",
      "target": "random_orderid",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 30,
      "metadata": {}
    },
    {
      "source": "test_unhappy_path_returns_400_and_error_message",
      "target": "post_to_allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 30,
      "metadata": {}
    },
    {
      "source": "test_unhappy_path_returns_400_and_error_message",
      "target": "get_allocation",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 30,
      "metadata": {}
    },
    {
      "source": "test_change_batch_quantity_leading_to_reallocation",
      "target": "random_orderid",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 11,
      "metadata": {}
    },
    {
      "source": "test_change_batch_quantity_leading_to_reallocation",
      "target": "random_sku",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 11,
      "metadata": {}
    },
    {
      "source": "test_change_batch_quantity_leading_to_reallocation",
      "target": "random_batchref",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 11,
      "metadata": {}
    },
    {
      "source": "test_change_batch_quantity_leading_to_reallocation",
      "target": "random_batchref",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 11,
      "metadata": {}
    },
    {
      "source": "test_change_batch_quantity_leading_to_reallocation",
      "target": "post_to_add_batch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 11,
      "metadata": {}
    },
    {
      "source": "test_change_batch_quantity_leading_to_reallocation",
      "target": "post_to_add_batch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 11,
      "metadata": {}
    },
    {
      "source": "test_change_batch_quantity_leading_to_reallocation",
      "target": "post_to_allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 11,
      "metadata": {}
    },
    {
      "source": "test_change_batch_quantity_leading_to_reallocation",
      "target": "get_allocation",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 11,
      "metadata": {}
    },
    {
      "source": "test_change_batch_quantity_leading_to_reallocation",
      "target": "subscribe_to",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 11,
      "metadata": {}
    },
    {
      "source": "test_change_batch_quantity_leading_to_reallocation",
      "target": "publish_message",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 11,
      "metadata": {}
    },
    {
      "source": "post_to_add_batch",
      "target": "get_api_url",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 5,
      "metadata": {}
    },
    {
      "source": "post_to_allocate",
      "target": "get_api_url",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 13,
      "metadata": {}
    },
    {
      "source": "get_allocation",
      "target": "get_api_url",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 28,
      "metadata": {}
    },
    {
      "source": "get_allocation",
      "target": "get",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 28,
      "metadata": {}
    },
    {
      "source": "bootstrap",
      "target": "SqlAlchemyUnitOfWork",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 11,
      "metadata": {}
    },
    {
      "source": "bootstrap",
      "target": "EmailNotifications",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 11,
      "metadata": {}
    },
    {
      "source": "bootstrap",
      "target": "start_mappers",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 11,
      "metadata": {}
    },
    {
      "source": "bootstrap",
      "target": "inject_dependencies",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 11,
      "metadata": {}
    },
    {
      "source": "bootstrap",
      "target": "inject_dependencies",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 11,
      "metadata": {}
    },
    {
      "source": "bootstrap",
      "target": "MessageBus",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 11,
      "metadata": {}
    },
    {
      "source": "get_postgres_uri",
      "target": "get",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 4,
      "metadata": {}
    },
    {
      "source": "get_postgres_uri",
      "target": "get",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 4,
      "metadata": {}
    },
    {
      "source": "get_api_url",
      "target": "get",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 12,
      "metadata": {}
    },
    {
      "source": "get_redis_host_and_port",
      "target": "get",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 18,
      "metadata": {}
    },
    {
      "source": "get_email_host_and_port",
      "target": "get",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 24,
      "metadata": {}
    },
    {
      "source": "AbstractRepository.add",
      "target": "_add",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 11,
      "metadata": {}
    },
    {
      "source": "AbstractRepository.get",
      "target": "_get",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 15,
      "metadata": {}
    },
    {
      "source": "AbstractRepository.get",
      "target": "add",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 15,
      "metadata": {}
    },
    {
      "source": "AbstractRepository.get_by_batchref",
      "target": "_get_by_batchref",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 21,
      "metadata": {}
    },
    {
      "source": "AbstractRepository.get_by_batchref",
      "target": "add",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 21,
      "metadata": {}
    },
    {
      "source": "SqlAlchemyRepository._add",
      "target": "add",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 45,
      "metadata": {}
    },
    {
      "source": "add_batch",
      "target": "get",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 17,
      "metadata": {}
    },
    {
      "source": "add_batch",
      "target": "Product",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 17,
      "metadata": {}
    },
    {
      "source": "add_batch",
      "target": "add",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 17,
      "metadata": {}
    },
    {
      "source": "add_batch",
      "target": "Batch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 17,
      "metadata": {}
    },
    {
      "source": "add_batch",
      "target": "commit",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 17,
      "metadata": {}
    },
    {
      "source": "allocate",
      "target": "OrderLine",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 30,
      "metadata": {}
    },
    {
      "source": "allocate",
      "target": "get",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 30,
      "metadata": {}
    },
    {
      "source": "allocate",
      "target": "InvalidSku",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 30,
      "metadata": {}
    },
    {
      "source": "allocate",
      "target": "commit",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 30,
      "metadata": {}
    },
    {
      "source": "reallocate",
      "target": "allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 43,
      "metadata": {}
    },
    {
      "source": "reallocate",
      "target": "Allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 43,
      "metadata": {}
    },
    {
      "source": "change_batch_quantity",
      "target": "get_by_batchref",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 50,
      "metadata": {}
    },
    {
      "source": "change_batch_quantity",
      "target": "commit",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 50,
      "metadata": {}
    },
    {
      "source": "send_out_of_stock_notification",
      "target": "send",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 63,
      "metadata": {}
    },
    {
      "source": "publish_allocated_event",
      "target": "publish",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 73,
      "metadata": {}
    },
    {
      "source": "add_allocation_to_read_model",
      "target": "commit",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 80,
      "metadata": {}
    },
    {
      "source": "remove_allocation_from_read_model",
      "target": "commit",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 95,
      "metadata": {}
    },
    {
      "source": "MessageBus.handle",
      "target": "handle_event",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 26,
      "metadata": {}
    },
    {
      "source": "MessageBus.handle",
      "target": "handle_command",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 26,
      "metadata": {}
    },
    {
      "source": "MessageBus.handle_event",
      "target": "collect_new_events",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 37,
      "metadata": {}
    },
    {
      "source": "MessageBus.handle_command",
      "target": "collect_new_events",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 47,
      "metadata": {}
    },
    {
      "source": "AbstractUnitOfWork.__exit__",
      "target": "rollback",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 19,
      "metadata": {}
    },
    {
      "source": "AbstractUnitOfWork.commit",
      "target": "_commit",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 22,
      "metadata": {}
    },
    {
      "source": "SqlAlchemyUnitOfWork.__enter__",
      "target": "SqlAlchemyRepository",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 51,
      "metadata": {}
    },
    {
      "source": "SqlAlchemyUnitOfWork._commit",
      "target": "commit",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 60,
      "metadata": {}
    },
    {
      "source": "main",
      "target": "bootstrap",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 13,
      "metadata": {}
    },
    {
      "source": "main",
      "target": "handle_change_batch_quantity",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 13,
      "metadata": {}
    },
    {
      "source": "handle_change_batch_quantity",
      "target": "ChangeBatchQuantity",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 23,
      "metadata": {}
    },
    {
      "source": "handle_change_batch_quantity",
      "target": "handle",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 23,
      "metadata": {}
    },
    {
      "source": "add_batch",
      "target": "CreateBatch",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 12,
      "metadata": {}
    },
    {
      "source": "add_batch",
      "target": "handle",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 12,
      "metadata": {}
    },
    {
      "source": "allocate_endpoint",
      "target": "Allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 24,
      "metadata": {}
    },
    {
      "source": "allocate_endpoint",
      "target": "handle",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 24,
      "metadata": {}
    },
    {
      "source": "allocations_view_endpoint",
      "target": "allocations",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 37,
      "metadata": {}
    },
    {
      "source": "Product.allocate",
      "target": "can_allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 15,
      "metadata": {}
    },
    {
      "source": "Product.allocate",
      "target": "Allocated",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 15,
      "metadata": {}
    },
    {
      "source": "Product.allocate",
      "target": "OutOfStock",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 15,
      "metadata": {}
    },
    {
      "source": "Product.change_batch_quantity",
      "target": "deallocate_one",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 33,
      "metadata": {}
    },
    {
      "source": "Product.change_batch_quantity",
      "target": "Deallocated",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 33,
      "metadata": {}
    },
    {
      "source": "Batch.allocate",
      "target": "can_allocate",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 74,
      "metadata": {}
    },
    {
      "source": "Batch.allocate",
      "target": "add",
      "edge_type": "calls",
      "weight": 1.0,
      "confidence": 0.7,
      "file_path": "",
      "line": 74,
      "metadata": {}
    }
  ],
  "stats": {
    "total_files": 37,
    "total_lines": 1512,
    "total_nodes": 159,
    "total_edges": 342,
    "languages": [
      "python"
    ],
    "coverage_percentage": 100.0,
    "unknown_percentage": 0.0
  },
  "classification": {
    "by_role": {
      "Configuration": 13,
      "Test": 30,
      "Utility": 21,
      "Query": 22,
      "Repository": 3,
      "ApplicationService": 12,
      "Internal": 3,
      "Command": 17,
      "Observer": 3,
      "Factory": 1,
      "Specification": 7,
      "Fixture": 2,
      "UseCase": 1,
      "Adapter": 3,
      "Exception": 1,
      "DTO": 4,
      "EventHandler": 4,
      "Lifecycle": 4,
      "Service": 1,
      "Controller": 3,
      "DomainEvent": 4
    },
    "by_kind": {
      "function": 74,
      "class": 26,
      "method": 59
    },
    "by_layer": {},
    "by_confidence": {
      "high": 40,
      "medium": 119,
      "low": 0
    }
  },
  "auto_discovery": {
    "enabled": true,
    "patterns_applied": 46,
    "particles_reclassified": 54,
    "top_patterns": [
      [
        "underscore_func",
        10
      ],
      [
        "camelCase",
        8
      ],
      [
        "action_verb",
        7
      ],
      [
        "noun_entity",
        4
      ],
      [
        "_private",
        3
      ],
      [
        "filter",
        2
      ],
      [
        "fixture/example",
        2
      ],
      [
        "prefix:add_",
        2
      ],
      [
        "endpoint",
        2
      ],
      [
        "url",
        1
      ],
      [
        "short_name",
        1
      ],
      [
        "error",
        1
      ],
      [
        "aggregator",
        1
      ],
      [
        "database",
        1
      ],
      [
        "entry_point",
        1
      ]
    ],
    "suggested_new_patterns": []
  },
  "dependencies": {
    "internal": [],
    "external": [],
    "stdlib": [],
    "analysis_status": "not_applied"
  },
  "antimatter": {
    "god_classes": [],
    "long_methods": [],
    "high_coupling": [],
    "analysis_status": "not_applied"
  },
  "architecture": {
    "detected_patterns": [],
    "layer_violations": [],
    "analysis_status": "not_applied",
    "graph_inference": {
      "total_inferred": 0,
      "rules_applied": 0,
      "details": [],
      "parent_inherited": 0
    }
  },
  "llm_enrichment": {
    "enabled": false,
    "model": "none",
    "particles_enhanced": 0,
    "analysis_status": "not_applied"
  },
  "warnings": [],
  "recommendations": []
}