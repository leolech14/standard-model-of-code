<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spectrometer - System Architecture Visualization</title>
  <!-- Robust Script Loading -->
  <script>
    function loadScript(src) {
      return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = src;
        script.onload = resolve;
        script.onerror = reject;
        document.head.appendChild(script);
      });
    }

    async function initVis() {
      try {
        await loadScript('assets/vis-network.min.js');
        console.log('Loaded vis-network from local assets');
      } catch (e1) {
        console.warn('Local asset failed, trying CDN...');
        try {
          await loadScript('https://unpkg.com/vis-network/standalone/umd/vis-network.min.js');
          console.log('Loaded vis-network from CDN');
        } catch (e2) {
          document.body.innerHTML = '<h1 style="color:red;padding:20px">Failed to load Visualization Library</h1><p>Please ensure assets/vis-network.min.js exists or you have internet access.</p>';
        }
      }
    }

    // Start loading immediately
    window.visPromise = initVis();
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #0a0a0f;
      --bg-secondary: #12121a;
      --bg-card: rgba(255, 255, 255, 0.03);
      --border: rgba(255, 255, 255, 0.08);
      --text-primary: #ffffff;
      --text-secondary: #8b8b9e;
      --accent-cyan: #00d4ff;
      --accent-purple: #a855f7;
      --accent-green: #22c55e;
      --accent-red: #ef4444;
      --accent-yellow: #eab308;
      --accent-orange: #f97316;
      --accent-pink: #ec4899;
      --glow-cyan: 0 0 30px rgba(0, 212, 255, 0.3);
      --glow-purple: 0 0 30px rgba(168, 85, 247, 0.3);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: var(--bg-primary);
      min-height: 100vh;
      color: var(--text-primary);
      overflow: hidden;
    }

    /* Main Layout */
    .app {
      display: grid;
      grid-template-columns: 320px 1fr 320px;
      grid-template-rows: 60px 1fr;
      height: 100vh;
    }

    /* Header */
    .header {
      grid-column: 1 / -1;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 24px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-icon {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }

    .logo-text {
      font-weight: 700;
      font-size: 1.25rem;
      background: linear-gradient(90deg, var(--accent-cyan), var(--accent-purple));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .header-controls {
      display: flex;
      gap: 12px;
    }

    .btn {
      padding: 8px 16px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--bg-card);
      color: var(--text-primary);
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .btn:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: var(--accent-cyan);
    }

    .btn.active {
      background: var(--accent-cyan);
      color: #000;
      border-color: var(--accent-cyan);
    }

    /* Left Sidebar */
    .sidebar-left {
      background: var(--bg-secondary);
      border-right: 1px solid var(--border);
      padding: 20px;
      overflow-y: auto;
    }

    /* Search */
    .search-box {
      position: relative;
      margin-bottom: 20px;
    }

    .search-box input {
      width: 100%;
      padding: 12px 16px 12px 40px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 0.875rem;
      outline: none;
      transition: all 0.2s;
    }

    .search-box input:focus {
      border-color: var(--accent-cyan);
      box-shadow: var(--glow-cyan);
    }

    .search-box::before {
      content: 'üîç';
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 14px;
    }

    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 20px;
    }

    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
    }

    .stat-value {
      font-size: 1.75rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .stat-label {
      font-size: 0.75rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-top: 4px;
    }

    /* Layer Filters */
    .section-title {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-secondary);
      margin-bottom: 12px;
      margin-top: 20px;
    }

    .filter-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .filter-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .filter-item:hover {
      background: rgba(255, 255, 255, 0.08);
    }

    .filter-item.active {
      border-color: var(--accent-cyan);
    }

    .filter-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }

    .filter-label {
      flex: 1;
      font-size: 0.875rem;
    }

    .filter-count {
      font-size: 0.75rem;
      color: var(--text-secondary);
      background: var(--bg-primary);
      padding: 2px 8px;
      border-radius: 10px;
    }

    /* Graph Container */
    .graph-container {
      position: relative;
      background: var(--bg-primary);
      background-image:
        radial-gradient(circle at 20% 80%, rgba(0, 212, 255, 0.05) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(168, 85, 247, 0.05) 0%, transparent 50%);
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    #graph {
      position: absolute;
      top: 0;
      left: 0;
      width: 100% !important;
      height: 100% !important;
      outline: none;
    }

    /* Layout Controls */
    .layout-controls {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 8px;
      background: var(--bg-secondary);
      padding: 8px;
      border-radius: 12px;
      border: 1px solid var(--border);
      z-index: 10;
    }

    .layout-btn {
      padding: 10px 16px;
      border-radius: 8px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .layout-btn:hover {
      color: var(--text-primary);
      background: var(--bg-card);
    }

    .layout-btn.active {
      background: var(--accent-purple);
      color: white;
    }

    /* Right Sidebar - Node Details */
    .sidebar-right {
      background: var(--bg-secondary);
      border-left: 1px solid var(--border);
      padding: 20px;
      overflow-y: auto;
    }

    .node-detail-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--border);
    }

    .node-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }

    .node-title {
      font-size: 1.1rem;
      font-weight: 600;
    }

    .node-subtitle {
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    /* Dimension Cards */
    .dimension-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 20px;
    }

    .dimension-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px;
    }

    .dimension-label {
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }

    .dimension-value {
      font-size: 0.9rem;
      font-weight: 500;
    }

    /* Connections List */
    .connection-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .connection-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .connection-item:hover {
      background: rgba(255, 255, 255, 0.08);
      border-color: var(--accent-cyan);
    }

    .connection-arrow {
      color: var(--accent-cyan);
    }

    .connection-type {
      font-size: 0.7rem;
      color: var(--text-secondary);
      background: var(--bg-primary);
      padding: 2px 6px;
      border-radius: 4px;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--text-secondary);
    }

    .empty-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    /* Animations */
    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.5;
      }
    }

    .loading {
      animation: pulse 1.5s infinite;
    }
  </style>
</head>

<body>
  <div id="debug-console"
    style="position:fixed;bottom:0;left:0;width:100%;height:150px;background:rgba(0,0,0,0.85);color:#0f0;font-family:monospace;font-size:12px;overflow-y:auto;z-index:9999;padding:10px;pointer-events:none;display:none;">
    <div style="border-bottom:1px solid #333;margin-bottom:5px">Debug Console (Auto-shows on error)</div>
  </div>
  <script>
    function logToScreen(msg, type = 'info') {
      const consoleDiv = document.getElementById('debug-console');
      if (!consoleDiv) return;

      const line = document.createElement('div');
      line.style.color = type === 'error' ? '#ff5555' : type === 'warning' ? '#ffb86c' : '#50fa7b';
      line.style.marginBottom = '2px';
      line.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
      consoleDiv.appendChild(line);
      consoleDiv.scrollTop = consoleDiv.scrollHeight;

      if (type === 'error' || type === 'warning') {
        consoleDiv.style.display = 'block';
        consoleDiv.style.pointerEvents = 'auto';
      }
    }

    // Capture global crashes
    window.onerror = function (msg, url, line, col, error) {
      if (msg.includes('ResizeObserver loop')) return false; // Ignore benign browser error
      logToScreen(`Global Error: ${msg} at line ${line}:${col}`, 'error');
      return false;
    };

    // Capture unhandled rejections
    window.onunhandledrejection = function (event) {
      logToScreen(`Unhandled Rejection: ${event.reason}`, 'error');
    };
  </script>
  <div class="app">
    <!-- Header -->
    <header class="header">
      <div class="logo">
        <div class="logo-icon">üî¨</div>
        <span class="logo-text">Spectrometer Pro</span>
      </div>
      <div class="header-controls">
        <button class="btn" onclick="fitGraph()">‚ä° Fit</button>
        <button class="btn" onclick="togglePhysics()">‚ö° Physics</button>
        <button class="btn" onclick="exportJSON()">üíæ Export</button>
      </div>
    </header>

    <!-- Left Sidebar -->
    <aside class="sidebar-left">
      <div class="search-box">
        <input type="text" id="search" placeholder="Search particles..." oninput="searchNodes(this.value)">
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="stat-nodes">0</div>
          <div class="stat-label">Particles</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="stat-edges">0</div>
          <div class="stat-label">Edges</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="stat-layers">0</div>
          <div class="stat-label">Layers</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="stat-density">0%</div>
          <div class="stat-label">Density</div>
        </div>
      </div>

      <div class="section-title">Filter by Layer</div>
      <div class="filter-list" id="layer-filters"></div>

      <div class="section-title">Filter by Role</div>
      <div class="filter-list" id="role-filters"></div>
    </aside>

    <!-- Main Graph -->
    <main class="graph-container">
      <div id="graph"></div>
      <div class="layout-controls">
        <button class="layout-btn active" onclick="setLayout('force')">üåê Force</button>
        <button class="layout-btn" onclick="setLayout('hierarchical')">üìä Hierarchical</button>
        <button class="layout-btn" onclick="setLayout('radial')">üéØ Radial</button>
        <button class="layout-btn" onclick="setLayout('grid')">‚äû Grid</button>
      </div>
    </main>

    <!-- Right Sidebar -->
    <aside class="sidebar-right">
      <div id="node-details">
        <div class="empty-state">
          <div class="empty-icon">üëÜ</div>
          <p>Click a node to see details</p>
        </div>
      </div>
    </aside>
  </div>

  <script>
    // ==========================================
    // SPECTROMETER DATA MODEL
    // ==========================================

    const layerColors = {
      'presentation': { bg: '#00d4ff', border: '#00a8cc', icon: 'üåê' },
      'application': { bg: '#a855f7', border: '#7c3aed', icon: 'üì±' },
      'domain': { bg: '#ec4899', border: '#db2777', icon: 'üíé' },
      'infrastructure': { bg: '#22c55e', border: '#16a34a', icon: 'üîß' },
      'testing': { bg: '#eab308', border: '#ca8a04', icon: 'üß™' },
      'unknown': { bg: '#6b7280', border: '#4b5563', icon: '‚ùì' },
    };

    const roleIcons = {
      'Orchestrator': 'üéº',
      'Worker': '‚öôÔ∏è',
      'Data': 'üì¶',
    };

        // ==========================================
        // DATA INJECTION ZONE
        // ==========================================
        // The generator will inject data between these markers.
        // DO NOT MODIFY THE MARKERS manually.

        /* <!-- DATA_INJECTION_START --> */
    const particles = [
      {
        "id": "in_memory_sqlite_db",
        "label": "in_memory_sqlite_db",
        "name": "in_memory_sqlite_db",
        "kind": "function",
        "role": "Configuration",
        "role_icon": "\u26a1",
        "role_confidence": 99.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py",
        "start_line": 21,
        "end_line": 24,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [
          "pytest.fixture"
        ],
        "docstring": "",
        "signature": "def in_memory_sqlite_db():",
        "body_source": "def in_memory_sqlite_db():\n    engine = create_engine(\"sqlite:///:memory:\")\n    metadata.create_all(engine)\n    return engine",
        "complexity": 0,
        "lines_of_code": 3,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 3,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Deferred",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "sqlite_session_factory",
        "label": "sqlite_session_factory",
        "name": "sqlite_session_factory",
        "kind": "function",
        "role": "Configuration",
        "role_icon": "\u26a1",
        "role_confidence": 99.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py",
        "start_line": 28,
        "end_line": 29,
        "params": [
          {
            "name": "in_memory_sqlite_db"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [
          "pytest.fixture"
        ],
        "docstring": "",
        "signature": "def sqlite_session_factory(in_memory_sqlite_db):",
        "body_source": "def sqlite_session_factory(in_memory_sqlite_db):\n    yield sessionmaker(bind=in_memory_sqlite_db)",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Deferred",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "mappers",
        "label": "mappers",
        "name": "mappers",
        "kind": "function",
        "role": "Configuration",
        "role_icon": "\u26a1",
        "role_confidence": 99.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py",
        "start_line": 33,
        "end_line": 36,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [
          "pytest.fixture"
        ],
        "docstring": "",
        "signature": "def mappers():",
        "body_source": "def mappers():\n    start_mappers()\n    yield\n    clear_mappers()",
        "complexity": 0,
        "lines_of_code": 3,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 3,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Deferred",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "wait_for_postgres_to_come_up",
        "label": "wait_for_postgres_to_come_up",
        "name": "wait_for_postgres_to_come_up",
        "kind": "function",
        "role": "Test",
        "role_icon": "\ud83e\uddea",
        "role_confidence": 80.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py",
        "start_line": 40,
        "end_line": 41,
        "params": [
          {
            "name": "engine"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [
          "retry"
        ],
        "docstring": "",
        "signature": "def wait_for_postgres_to_come_up(engine):",
        "body_source": "def wait_for_postgres_to_come_up(engine):\n    return engine.connect()",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "wait_for_webapp_to_come_up",
        "label": "wait_for_webapp_to_come_up",
        "name": "wait_for_webapp_to_come_up",
        "kind": "function",
        "role": "Test",
        "role_icon": "\ud83e\uddea",
        "role_confidence": 80.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py",
        "start_line": 45,
        "end_line": 46,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [
          "retry"
        ],
        "docstring": "",
        "signature": "def wait_for_webapp_to_come_up():",
        "body_source": "def wait_for_webapp_to_come_up():\n    return requests.get(config.get_api_url())",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "wait_for_redis_to_come_up",
        "label": "wait_for_redis_to_come_up",
        "name": "wait_for_redis_to_come_up",
        "kind": "function",
        "role": "Test",
        "role_icon": "\ud83e\uddea",
        "role_confidence": 80.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py",
        "start_line": 50,
        "end_line": 52,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [
          "retry"
        ],
        "docstring": "",
        "signature": "def wait_for_redis_to_come_up():",
        "body_source": "def wait_for_redis_to_come_up():\n    r = redis.Redis(**config.get_redis_host_and_port())\n    return r.ping()",
        "complexity": 0,
        "lines_of_code": 2,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 2,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "postgres_db",
        "label": "postgres_db",
        "name": "postgres_db",
        "kind": "function",
        "role": "Configuration",
        "role_icon": "\u26a1",
        "role_confidence": 99.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py",
        "start_line": 56,
        "end_line": 60,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [
          "pytest.fixture"
        ],
        "docstring": "",
        "signature": "def postgres_db():",
        "body_source": "def postgres_db():\n    engine = create_engine(config.get_postgres_uri(), isolation_level=\"SERIALIZABLE\")\n    wait_for_postgres_to_come_up(engine)\n    metadata.create_all(engine)\n    return engine",
        "complexity": 0,
        "lines_of_code": 4,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 4,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Deferred",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "postgres_session_factory",
        "label": "postgres_session_factory",
        "name": "postgres_session_factory",
        "kind": "function",
        "role": "Configuration",
        "role_icon": "\u26a1",
        "role_confidence": 99.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py",
        "start_line": 64,
        "end_line": 65,
        "params": [
          {
            "name": "postgres_db"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [
          "pytest.fixture"
        ],
        "docstring": "",
        "signature": "def postgres_session_factory(postgres_db):",
        "body_source": "def postgres_session_factory(postgres_db):\n    yield sessionmaker(bind=postgres_db)",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Deferred",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "postgres_session",
        "label": "postgres_session",
        "name": "postgres_session",
        "kind": "function",
        "role": "Configuration",
        "role_icon": "\u26a1",
        "role_confidence": 99.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py",
        "start_line": 69,
        "end_line": 70,
        "params": [
          {
            "name": "postgres_session_factory"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [
          "pytest.fixture"
        ],
        "docstring": "",
        "signature": "def postgres_session(postgres_session_factory):",
        "body_source": "def postgres_session(postgres_session_factory):\n    return postgres_session_factory()",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Deferred",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "restart_api",
        "label": "restart_api",
        "name": "restart_api",
        "kind": "function",
        "role": "Configuration",
        "role_icon": "\u26a1",
        "role_confidence": 99.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py",
        "start_line": 74,
        "end_line": 77,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [
          "pytest.fixture"
        ],
        "docstring": "",
        "signature": "def restart_api():",
        "body_source": "def restart_api():\n    (Path(__file__).parent / \"../src/allocation/entrypoints/flask_app.py\").touch()\n    time.sleep(0.5)\n    wait_for_webapp_to_come_up()",
        "complexity": 0,
        "lines_of_code": 3,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 3,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Deferred",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "restart_redis_pubsub",
        "label": "restart_redis_pubsub",
        "name": "restart_redis_pubsub",
        "kind": "function",
        "role": "Configuration",
        "role_icon": "\u26a1",
        "role_confidence": 99.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/conftest.py",
        "start_line": 81,
        "end_line": 89,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [
          "pytest.fixture"
        ],
        "docstring": "",
        "signature": "def restart_redis_pubsub():",
        "body_source": "def restart_redis_pubsub():\n    wait_for_redis_to_come_up()\n    if not shutil.which(\"docker-compose\"):\n        print(\"skipping restart, assumes running in container\")\n        return\n    subprocess.run(\n        [\"docker-compose\", \"restart\", \"-t\", \"0\", \"redis_pubsub\"],\n        check=True,\n    )",
        "complexity": 0,
        "lines_of_code": 8,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 8,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Deferred",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "random_suffix",
        "label": "random_suffix",
        "name": "random_suffix",
        "kind": "function",
        "role": "Utility",
        "role_icon": "\u26a1",
        "role_confidence": 60.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/random_refs.py",
        "start_line": 4,
        "end_line": 5,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def random_suffix():",
        "body_source": "def random_suffix():\n    return uuid.uuid4().hex[:6]",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "random_sku",
        "label": "random_sku",
        "name": "random_sku",
        "kind": "function",
        "role": "Utility",
        "role_icon": "\u26a1",
        "role_confidence": 60.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/random_refs.py",
        "start_line": 8,
        "end_line": 9,
        "params": [
          {
            "name": "name",
            "default": "''"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def random_sku(name=\"\"):",
        "body_source": "def random_sku(name=\"\"):\n    return f\"sku-{name}-{random_suffix()}\"",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "random_batchref",
        "label": "random_batchref",
        "name": "random_batchref",
        "kind": "function",
        "role": "Query",
        "role_icon": "\ud83d\udce5",
        "role_confidence": 70.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/random_refs.py",
        "start_line": 12,
        "end_line": 13,
        "params": [
          {
            "name": "name",
            "default": "''"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def random_batchref(name=\"\"):",
        "body_source": "def random_batchref(name=\"\"):\n    return f\"batch-{name}-{random_suffix()}\"",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Pure"
      },
      {
        "id": "random_orderid",
        "label": "random_orderid",
        "name": "random_orderid",
        "kind": "function",
        "role": "Query",
        "role_icon": "\ud83d\udce5",
        "role_confidence": 75.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/random_refs.py",
        "start_line": 16,
        "end_line": 17,
        "params": [
          {
            "name": "name",
            "default": "''"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def random_orderid(name=\"\"):",
        "body_source": "def random_orderid(name=\"\"):\n    return f\"order-{name}-{random_suffix()}\"",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Pure"
      },
      {
        "id": "FakeRepository",
        "label": "FakeRepository",
        "name": "FakeRepository",
        "kind": "class",
        "role": "Repository",
        "role_icon": "\ud83d\udcbe",
        "role_confidence": 99.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
        "start_line": 14,
        "end_line": 14,
        "params": [],
        "return_type": "",
        "base_classes": [
          "AbstractRepository"
        ],
        "decorators": [],
        "docstring": "",
        "signature": "class FakeRepository(repository.AbstractRepository):",
        "body_source": "",
        "complexity": 0,
        "lines_of_code": 0,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateful",
        "activation": "Direct",
        "lifetime": "Singleton",
        "effect": "Side-Effect"
      },
      {
        "id": "FakeRepository.__init__",
        "label": "FakeRepository.__init__",
        "name": "FakeRepository.__init__",
        "kind": "method",
        "role": "ApplicationService",
        "role_icon": "\u26a1",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
        "start_line": 15,
        "end_line": 17,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "products"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def __init__(self, products):",
        "body_source": "    def __init__(self, products):\n        super().__init__()\n        self._products = set(products)",
        "complexity": 0,
        "lines_of_code": 2,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 2,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "FakeRepository._add",
        "label": "FakeRepository._add",
        "name": "FakeRepository._add",
        "kind": "method",
        "role": "Internal",
        "role_icon": "\u26a1",
        "role_confidence": 70.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
        "start_line": 19,
        "end_line": 20,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "product"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def _add(self, product):",
        "body_source": "    def _add(self, product):\n        self._products.add(product)",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "FakeRepository._get",
        "label": "FakeRepository._get",
        "name": "FakeRepository._get",
        "kind": "method",
        "role": "Query",
        "role_icon": "\ud83d\udce5",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
        "start_line": 22,
        "end_line": 23,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "sku"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def _get(self, sku):",
        "body_source": "    def _get(self, sku):\n        return next((p for p in self._products if p.sku == sku), None)",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Pure"
      },
      {
        "id": "FakeRepository._get_by_batchref",
        "label": "FakeRepository._get_by_batchref",
        "name": "FakeRepository._get_by_batchref",
        "kind": "method",
        "role": "Query",
        "role_icon": "\ud83d\udce5",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
        "start_line": 25,
        "end_line": 29,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "batchref"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def _get_by_batchref(self, batchref):",
        "body_source": "    def _get_by_batchref(self, batchref):\n        return next(\n            (p for p in self._products for b in p.batches if b.reference == batchref),\n            None,\n        )",
        "complexity": 0,
        "lines_of_code": 4,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 4,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Pure"
      },
      {
        "id": "FakeUnitOfWork",
        "label": "FakeUnitOfWork",
        "name": "FakeUnitOfWork",
        "kind": "class",
        "role": "Test",
        "role_icon": "\ud83e\uddea",
        "role_confidence": 80.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
        "start_line": 32,
        "end_line": 32,
        "params": [],
        "return_type": "",
        "base_classes": [
          "AbstractUnitOfWork"
        ],
        "decorators": [],
        "docstring": "",
        "signature": "class FakeUnitOfWork(unit_of_work.AbstractUnitOfWork):",
        "body_source": "",
        "complexity": 0,
        "lines_of_code": 0,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateful",
        "activation": "Direct",
        "lifetime": "Singleton",
        "effect": "Side-Effect"
      },
      {
        "id": "FakeUnitOfWork.__init__",
        "label": "FakeUnitOfWork.__init__",
        "name": "FakeUnitOfWork.__init__",
        "kind": "method",
        "role": "ApplicationService",
        "role_icon": "\u26a1",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
        "start_line": 33,
        "end_line": 35,
        "params": [
          {
            "name": "self"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def __init__(self):",
        "body_source": "    def __init__(self):\n        self.products = FakeRepository([])\n        self.committed = False",
        "complexity": 0,
        "lines_of_code": 2,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 2,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "FakeUnitOfWork._commit",
        "label": "FakeUnitOfWork._commit",
        "name": "FakeUnitOfWork._commit",
        "kind": "method",
        "role": "Command",
        "role_icon": "\ud83d\udce4",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
        "start_line": 37,
        "end_line": 38,
        "params": [
          {
            "name": "self"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def _commit(self):",
        "body_source": "    def _commit(self):\n        self.committed = True",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "FakeUnitOfWork.rollback",
        "label": "FakeUnitOfWork.rollback",
        "name": "FakeUnitOfWork.rollback",
        "kind": "method",
        "role": "Utility",
        "role_icon": "\u26a1",
        "role_confidence": 60.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
        "start_line": 40,
        "end_line": 41,
        "params": [
          {
            "name": "self"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def rollback(self):",
        "body_source": "    def rollback(self):\n        pass",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "FakeNotifications",
        "label": "FakeNotifications",
        "name": "FakeNotifications",
        "kind": "class",
        "role": "Test",
        "role_icon": "\ud83e\uddea",
        "role_confidence": 80.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
        "start_line": 44,
        "end_line": 44,
        "params": [],
        "return_type": "",
        "base_classes": [
          "AbstractNotifications"
        ],
        "decorators": [],
        "docstring": "",
        "signature": "class FakeNotifications(notifications.AbstractNotifications):",
        "body_source": "",
        "complexity": 0,
        "lines_of_code": 0,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateful",
        "activation": "Direct",
        "lifetime": "Singleton",
        "effect": "Side-Effect"
      },
      {
        "id": "FakeNotifications.__init__",
        "label": "FakeNotifications.__init__",
        "name": "FakeNotifications.__init__",
        "kind": "method",
        "role": "ApplicationService",
        "role_icon": "\u26a1",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
        "start_line": 45,
        "end_line": 46,
        "params": [
          {
            "name": "self"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def __init__(self):",
        "body_source": "    def __init__(self):\n        self.sent = defaultdict(list)  # type: Dict[str, List[str]]",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "FakeNotifications.send",
        "label": "FakeNotifications.send",
        "name": "FakeNotifications.send",
        "kind": "method",
        "role": "Command",
        "role_icon": "\ud83d\udce4",
        "role_confidence": 75.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
        "start_line": 48,
        "end_line": 49,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "destination"
          },
          {
            "name": "message"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def send(self, destination, message):",
        "body_source": "    def send(self, destination, message):\n        self.sent[destination].append(message)",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "bootstrap_test_app",
        "label": "bootstrap_test_app",
        "name": "bootstrap_test_app",
        "kind": "function",
        "role": "ApplicationService",
        "role_icon": "\u26a1",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
        "start_line": 52,
        "end_line": 58,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def bootstrap_test_app():",
        "body_source": "def bootstrap_test_app():\n    return bootstrap.bootstrap(\n        start_orm=False,\n        uow=FakeUnitOfWork(),\n        notifications=FakeNotifications(),\n        publish=lambda *args: None,\n    )",
        "complexity": 0,
        "lines_of_code": 6,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 6,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "TestAddBatch",
        "label": "TestAddBatch",
        "name": "TestAddBatch",
        "kind": "class",
        "role": "Test",
        "role_icon": "\ud83e\uddea",
        "role_confidence": 80.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
        "start_line": 61,
        "end_line": 61,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "class TestAddBatch:",
        "body_source": "",
        "complexity": 0,
        "lines_of_code": 0,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateful",
        "activation": "Direct",
        "lifetime": "Singleton",
        "effect": "Side-Effect"
      },
      {
        "id": "TestAddBatch.test_for_new_product",
        "label": "TestAddBatch.test_for_new_product",
        "name": "TestAddBatch.test_for_new_product",
        "kind": "method",
        "role": "Test",
        "role_icon": "\ud83e\uddea",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
        "start_line": 62,
        "end_line": 66,
        "params": [
          {
            "name": "self"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def test_for_new_product(self):",
        "body_source": "    def test_for_new_product(self):\n        bus = bootstrap_test_app()\n        bus.handle(commands.CreateBatch(\"b1\", \"CRUNCHY-ARMCHAIR\", 100, None))\n        assert bus.uow.products.get(\"CRUNCHY-ARMCHAIR\") is not None\n        assert bus.uow.committed",
        "complexity": 0,
        "lines_of_code": 4,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 4,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "TestAddBatch.test_for_existing_product",
        "label": "TestAddBatch.test_for_existing_product",
        "name": "TestAddBatch.test_for_existing_product",
        "kind": "method",
        "role": "Test",
        "role_icon": "\ud83e\uddea",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
        "start_line": 68,
        "end_line": 74,
        "params": [
          {
            "name": "self"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def test_for_existing_product(self):",
        "body_source": "    def test_for_existing_product(self):\n        bus = bootstrap_test_app()\n        bus.handle(commands.CreateBatch(\"b1\", \"GARISH-RUG\", 100, None))\n        bus.handle(commands.CreateBatch(\"b2\", \"GARISH-RUG\", 99, None))\n        assert \"b2\" in [\n            b.reference for b in bus.uow.products.get(\"GARISH-RUG\").batches\n        ]",
        "complexity": 0,
        "lines_of_code": 6,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 6,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "TestAllocate",
        "label": "TestAllocate",
        "name": "TestAllocate",
        "kind": "class",
        "role": "Test",
        "role_icon": "\ud83e\uddea",
        "role_confidence": 80.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
        "start_line": 77,
        "end_line": 77,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "class TestAllocate:",
        "body_source": "",
        "complexity": 0,
        "lines_of_code": 0,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateful",
        "activation": "Direct",
        "lifetime": "Singleton",
        "effect": "Side-Effect"
      },
      {
        "id": "TestAllocate.test_allocates",
        "label": "TestAllocate.test_allocates",
        "name": "TestAllocate.test_allocates",
        "kind": "method",
        "role": "Test",
        "role_icon": "\ud83e\uddea",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
        "start_line": 78,
        "end_line": 83,
        "params": [
          {
            "name": "self"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def test_allocates(self):",
        "body_source": "    def test_allocates(self):\n        bus = bootstrap_test_app()\n        bus.handle(commands.CreateBatch(\"batch1\", \"COMPLICATED-LAMP\", 100, None))\n        bus.handle(commands.Allocate(\"o1\", \"COMPLICATED-LAMP\", 10))\n        [batch] = bus.uow.products.get(\"COMPLICATED-LAMP\").batches\n        assert batch.available_quantity == 90",
        "complexity": 0,
        "lines_of_code": 5,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 5,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "TestAllocate.test_errors_for_invalid_sku",
        "label": "TestAllocate.test_errors_for_invalid_sku",
        "name": "TestAllocate.test_errors_for_invalid_sku",
        "kind": "method",
        "role": "Test",
        "role_icon": "\ud83e\uddea",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
        "start_line": 85,
        "end_line": 90,
        "params": [
          {
            "name": "self"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def test_errors_for_invalid_sku(self):",
        "body_source": "    def test_errors_for_invalid_sku(self):\n        bus = bootstrap_test_app()\n        bus.handle(commands.CreateBatch(\"b1\", \"AREALSKU\", 100, None))\n\n        with pytest.raises(handlers.InvalidSku, match=\"Invalid sku NONEXISTENTSKU\"):\n            bus.handle(commands.Allocate(\"o1\", \"NONEXISTENTSKU\", 10))",
        "complexity": 0,
        "lines_of_code": 5,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 5,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "TestAllocate.test_commits",
        "label": "TestAllocate.test_commits",
        "name": "TestAllocate.test_commits",
        "kind": "method",
        "role": "Test",
        "role_icon": "\ud83e\uddea",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
        "start_line": 92,
        "end_line": 96,
        "params": [
          {
            "name": "self"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def test_commits(self):",
        "body_source": "    def test_commits(self):\n        bus = bootstrap_test_app()\n        bus.handle(commands.CreateBatch(\"b1\", \"OMINOUS-MIRROR\", 100, None))\n        bus.handle(commands.Allocate(\"o1\", \"OMINOUS-MIRROR\", 10))\n        assert bus.uow.committed",
        "complexity": 0,
        "lines_of_code": 4,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 4,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "TestAllocate.test_sends_email_on_out_of_stock_error",
        "label": "TestAllocate.test_sends_email_on_out_of_",
        "name": "TestAllocate.test_sends_email_on_out_of_stock_error",
        "kind": "method",
        "role": "Observer",
        "role_icon": "\u26a1",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
        "start_line": 98,
        "end_line": 110,
        "params": [
          {
            "name": "self"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def test_sends_email_on_out_of_stock_error(self):",
        "body_source": "    def test_sends_email_on_out_of_stock_error(self):\n        fake_notifs = FakeNotifications()\n        bus = bootstrap.bootstrap(\n            start_orm=False,\n            uow=FakeUnitOfWork(),\n            notifications=fake_notifs,\n            publish=lambda *args: None,\n        )\n        bus.handle(commands.CreateBatch(\"b1\", \"POPULAR-CURTAINS\", 9, None))\n        bus.handle(commands.Allocate(\"o1\", \"POPULAR-CURTAINS\", 10))\n        assert fake_notifs.sent[\"stock@made.com\"] == [\n            f\"Out of stock for POPULAR-CURTAINS\",\n        ]",
        "complexity": 0,
        "lines_of_code": 12,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 12,
        "is_hotspot": true,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "TestChangeBatchQuantity",
        "label": "TestChangeBatchQuantity",
        "name": "TestChangeBatchQuantity",
        "kind": "class",
        "role": "Test",
        "role_icon": "\ud83e\uddea",
        "role_confidence": 80.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
        "start_line": 113,
        "end_line": 113,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "class TestChangeBatchQuantity:",
        "body_source": "",
        "complexity": 0,
        "lines_of_code": 0,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateful",
        "activation": "Direct",
        "lifetime": "Singleton",
        "effect": "Side-Effect"
      },
      {
        "id": "TestChangeBatchQuantity.test_changes_available_quantity",
        "label": "TestChangeBatchQuantity.test_changes_ava",
        "name": "TestChangeBatchQuantity.test_changes_available_quantity",
        "kind": "method",
        "role": "Test",
        "role_icon": "\ud83e\uddea",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
        "start_line": 114,
        "end_line": 121,
        "params": [
          {
            "name": "self"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def test_changes_available_quantity(self):",
        "body_source": "    def test_changes_available_quantity(self):\n        bus = bootstrap_test_app()\n        bus.handle(commands.CreateBatch(\"batch1\", \"ADORABLE-SETTEE\", 100, None))\n        [batch] = bus.uow.products.get(sku=\"ADORABLE-SETTEE\").batches\n        assert batch.available_quantity == 100\n\n        bus.handle(commands.ChangeBatchQuantity(\"batch1\", 50))\n        assert batch.available_quantity == 50",
        "complexity": 0,
        "lines_of_code": 7,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 7,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "TestChangeBatchQuantity.test_reallocates_if_necessary",
        "label": "TestChangeBatchQuantity.test_reallocates",
        "name": "TestChangeBatchQuantity.test_reallocates_if_necessary",
        "kind": "method",
        "role": "Test",
        "role_icon": "\ud83e\uddea",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_handlers.py",
        "start_line": 123,
        "end_line": 142,
        "params": [
          {
            "name": "self"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def test_reallocates_if_necessary(self):",
        "body_source": "    def test_reallocates_if_necessary(self):\n        bus = bootstrap_test_app()\n        history = [\n            commands.CreateBatch(\"batch1\", \"INDIFFERENT-TABLE\", 50, None),\n            commands.CreateBatch(\"batch2\", \"INDIFFERENT-TABLE\", 50, date.today()),\n            commands.Allocate(\"order1\", \"INDIFFERENT-TABLE\", 20),\n            commands.Allocate(\"order2\", \"INDIFFERENT-TABLE\", 20),\n        ]\n        for msg in history:\n            bus.handle(msg)\n        [batch1, batch2] = bus.uow.products.get(sku=\"INDIFFERENT-TABLE\").batches\n        assert batch1.available_quantity == 10\n        assert batch2.available_quantity == 50\n\n        bus.handle(commands.ChangeBatchQuantity(\"batch1\", 25))\n\n        # order1 or order2 will be deallocated, so we'll have 25 - 20\n        assert batch1.available_quantity == 5\n        # and 20 will be reallocated to the next batch\n        assert batch2.available_quantity == 30",
        "complexity": 0,
        "lines_of_code": 19,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 19,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "test_prefers_warehouse_batches_to_shipments",
        "label": "test_prefers_warehouse_batches_to_shipme",
        "name": "test_prefers_warehouse_batches_to_shipments",
        "kind": "function",
        "role": "Test",
        "role_icon": "\ud83e\uddea",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_product.py",
        "start_line": 11,
        "end_line": 20,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def test_prefers_warehouse_batches_to_shipments():",
        "body_source": "def test_prefers_warehouse_batches_to_shipments():\n    in_stock_batch = Batch(\"in-stock-batch\", \"RETRO-CLOCK\", 100, eta=None)\n    shipment_batch = Batch(\"shipment-batch\", \"RETRO-CLOCK\", 100, eta=tomorrow)\n    product = Product(sku=\"RETRO-CLOCK\", batches=[in_stock_batch, shipment_batch])\n    line = OrderLine(\"oref\", \"RETRO-CLOCK\", 10)\n\n    product.allocate(line)\n\n    assert in_stock_batch.available_quantity == 90\n    assert shipment_batch.available_quantity == 100",
        "complexity": 0,
        "lines_of_code": 9,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 9,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "test_prefers_earlier_batches",
        "label": "test_prefers_earlier_batches",
        "name": "test_prefers_earlier_batches",
        "kind": "function",
        "role": "Test",
        "role_icon": "\ud83e\uddea",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_product.py",
        "start_line": 23,
        "end_line": 34,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def test_prefers_earlier_batches():",
        "body_source": "def test_prefers_earlier_batches():\n    earliest = Batch(\"speedy-batch\", \"MINIMALIST-SPOON\", 100, eta=today)\n    medium = Batch(\"normal-batch\", \"MINIMALIST-SPOON\", 100, eta=tomorrow)\n    latest = Batch(\"slow-batch\", \"MINIMALIST-SPOON\", 100, eta=later)\n    product = Product(sku=\"MINIMALIST-SPOON\", batches=[medium, earliest, latest])\n    line = OrderLine(\"order1\", \"MINIMALIST-SPOON\", 10)\n\n    product.allocate(line)\n\n    assert earliest.available_quantity == 90\n    assert medium.available_quantity == 100\n    assert latest.available_quantity == 100",
        "complexity": 0,
        "lines_of_code": 11,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 11,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "test_returns_allocated_batch_ref",
        "label": "test_returns_allocated_batch_ref",
        "name": "test_returns_allocated_batch_ref",
        "kind": "function",
        "role": "Test",
        "role_icon": "\ud83e\uddea",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_product.py",
        "start_line": 37,
        "end_line": 43,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def test_returns_allocated_batch_ref():",
        "body_source": "def test_returns_allocated_batch_ref():\n    in_stock_batch = Batch(\"in-stock-batch-ref\", \"HIGHBROW-POSTER\", 100, eta=None)\n    shipment_batch = Batch(\"shipment-batch-ref\", \"HIGHBROW-POSTER\", 100, eta=tomorrow)\n    line = OrderLine(\"oref\", \"HIGHBROW-POSTER\", 10)\n    product = Product(sku=\"HIGHBROW-POSTER\", batches=[in_stock_batch, shipment_batch])\n    allocation = product.allocate(line)\n    assert allocation == in_stock_batch.reference",
        "complexity": 0,
        "lines_of_code": 6,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 6,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "test_outputs_allocated_event",
        "label": "test_outputs_allocated_event",
        "name": "test_outputs_allocated_event",
        "kind": "function",
        "role": "Test",
        "role_icon": "\ud83e\uddea",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_product.py",
        "start_line": 46,
        "end_line": 54,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def test_outputs_allocated_event():",
        "body_source": "def test_outputs_allocated_event():\n    batch = Batch(\"batchref\", \"RETRO-LAMPSHADE\", 100, eta=None)\n    line = OrderLine(\"oref\", \"RETRO-LAMPSHADE\", 10)\n    product = Product(sku=\"RETRO-LAMPSHADE\", batches=[batch])\n    product.allocate(line)\n    expected = events.Allocated(\n        orderid=\"oref\", sku=\"RETRO-LAMPSHADE\", qty=10, batchref=batch.reference\n    )\n    assert product.events[-1] == expected",
        "complexity": 0,
        "lines_of_code": 8,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 8,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "test_records_out_of_stock_event_if_cannot_allocate",
        "label": "test_records_out_of_stock_event_if_canno",
        "name": "test_records_out_of_stock_event_if_cannot_allocate",
        "kind": "function",
        "role": "Test",
        "role_icon": "\ud83e\uddea",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_product.py",
        "start_line": 57,
        "end_line": 64,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def test_records_out_of_stock_event_if_cannot_allocate():",
        "body_source": "def test_records_out_of_stock_event_if_cannot_allocate():\n    batch = Batch(\"batch1\", \"SMALL-FORK\", 10, eta=today)\n    product = Product(sku=\"SMALL-FORK\", batches=[batch])\n    product.allocate(OrderLine(\"order1\", \"SMALL-FORK\", 10))\n\n    allocation = product.allocate(OrderLine(\"order2\", \"SMALL-FORK\", 1))\n    assert product.events[-1] == events.OutOfStock(sku=\"SMALL-FORK\")\n    assert allocation is None",
        "complexity": 0,
        "lines_of_code": 7,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 7,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "test_increments_version_number",
        "label": "test_increments_version_number",
        "name": "test_increments_version_number",
        "kind": "function",
        "role": "Test",
        "role_icon": "\ud83e\uddea",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_product.py",
        "start_line": 67,
        "end_line": 74,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def test_increments_version_number():",
        "body_source": "def test_increments_version_number():\n    line = OrderLine(\"oref\", \"SCANDI-PEN\", 10)\n    product = Product(\n        sku=\"SCANDI-PEN\", batches=[Batch(\"b1\", \"SCANDI-PEN\", 100, eta=None)]\n    )\n    product.version_number = 7\n    product.allocate(line)\n    assert product.version_number == 8",
        "complexity": 0,
        "lines_of_code": 7,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 7,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "test_allocating_to_a_batch_reduces_the_available_quantity",
        "label": "test_allocating_to_a_batch_reduces_the_a",
        "name": "test_allocating_to_a_batch_reduces_the_available_quantity",
        "kind": "function",
        "role": "Test",
        "role_icon": "\ud83e\uddea",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_batches.py",
        "start_line": 5,
        "end_line": 11,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def test_allocating_to_a_batch_reduces_the_available_quantity():",
        "body_source": "def test_allocating_to_a_batch_reduces_the_available_quantity():\n    batch = Batch(\"batch-001\", \"SMALL-TABLE\", qty=20, eta=date.today())\n    line = OrderLine(\"order-ref\", \"SMALL-TABLE\", 2)\n\n    batch.allocate(line)\n\n    assert batch.available_quantity == 18",
        "complexity": 0,
        "lines_of_code": 6,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 6,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "make_batch_and_line",
        "label": "make_batch_and_line",
        "name": "make_batch_and_line",
        "kind": "function",
        "role": "Factory",
        "role_icon": "\ud83c\udfed",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_batches.py",
        "start_line": 14,
        "end_line": 18,
        "params": [
          {
            "name": "sku"
          },
          {
            "name": "batch_qty"
          },
          {
            "name": "line_qty"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def make_batch_and_line(sku, batch_qty, line_qty):",
        "body_source": "def make_batch_and_line(sku, batch_qty, line_qty):\n    return (\n        Batch(\"batch-001\", sku, batch_qty, eta=date.today()),\n        OrderLine(\"order-123\", sku, line_qty),\n    )",
        "complexity": 0,
        "lines_of_code": 4,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 4,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "test_can_allocate_if_available_greater_than_required",
        "label": "test_can_allocate_if_available_greater_t",
        "name": "test_can_allocate_if_available_greater_than_required",
        "kind": "function",
        "role": "Specification",
        "role_icon": "\u26a1",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_batches.py",
        "start_line": 21,
        "end_line": 23,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def test_can_allocate_if_available_greater_than_required():",
        "body_source": "def test_can_allocate_if_available_greater_than_required():\n    large_batch, small_line = make_batch_and_line(\"ELEGANT-LAMP\", 20, 2)\n    assert large_batch.can_allocate(small_line)",
        "complexity": 0,
        "lines_of_code": 2,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 2,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "test_cannot_allocate_if_available_smaller_than_required",
        "label": "test_cannot_allocate_if_available_smalle",
        "name": "test_cannot_allocate_if_available_smaller_than_required",
        "kind": "function",
        "role": "Test",
        "role_icon": "\ud83e\uddea",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_batches.py",
        "start_line": 26,
        "end_line": 28,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def test_cannot_allocate_if_available_smaller_than_required():",
        "body_source": "def test_cannot_allocate_if_available_smaller_than_required():\n    small_batch, large_line = make_batch_and_line(\"ELEGANT-LAMP\", 2, 20)\n    assert small_batch.can_allocate(large_line) is False",
        "complexity": 0,
        "lines_of_code": 2,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 2,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "test_can_allocate_if_available_equal_to_required",
        "label": "test_can_allocate_if_available_equal_to_",
        "name": "test_can_allocate_if_available_equal_to_required",
        "kind": "function",
        "role": "Specification",
        "role_icon": "\u26a1",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_batches.py",
        "start_line": 31,
        "end_line": 33,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def test_can_allocate_if_available_equal_to_required():",
        "body_source": "def test_can_allocate_if_available_equal_to_required():\n    batch, line = make_batch_and_line(\"ELEGANT-LAMP\", 2, 2)\n    assert batch.can_allocate(line)",
        "complexity": 0,
        "lines_of_code": 2,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 2,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "test_cannot_allocate_if_skus_do_not_match",
        "label": "test_cannot_allocate_if_skus_do_not_matc",
        "name": "test_cannot_allocate_if_skus_do_not_match",
        "kind": "function",
        "role": "Test",
        "role_icon": "\ud83e\uddea",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_batches.py",
        "start_line": 36,
        "end_line": 39,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def test_cannot_allocate_if_skus_do_not_match():",
        "body_source": "def test_cannot_allocate_if_skus_do_not_match():\n    batch = Batch(\"batch-001\", \"UNCOMFORTABLE-CHAIR\", 100, eta=None)\n    different_sku_line = OrderLine(\"order-123\", \"EXPENSIVE-TOASTER\", 10)\n    assert batch.can_allocate(different_sku_line) is False",
        "complexity": 0,
        "lines_of_code": 3,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 3,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "test_allocation_is_idempotent",
        "label": "test_allocation_is_idempotent",
        "name": "test_allocation_is_idempotent",
        "kind": "function",
        "role": "Specification",
        "role_icon": "\u26a1",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/unit/test_batches.py",
        "start_line": 42,
        "end_line": 46,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def test_allocation_is_idempotent():",
        "body_source": "def test_allocation_is_idempotent():\n    batch, line = make_batch_and_line(\"ANGULAR-DESK\", 20, 2)\n    batch.allocate(line)\n    batch.allocate(line)\n    assert batch.available_quantity == 18",
        "complexity": 0,
        "lines_of_code": 4,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 4,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "test_get_by_batchref",
        "label": "test_get_by_batchref",
        "name": "test_get_by_batchref",
        "kind": "function",
        "role": "Query",
        "role_icon": "\ud83d\udce5",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_repository.py",
        "start_line": 8,
        "end_line": 19,
        "params": [
          {
            "name": "sqlite_session_factory"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def test_get_by_batchref(sqlite_session_factory):",
        "body_source": "def test_get_by_batchref(sqlite_session_factory):\n    session = sqlite_session_factory()\n    repo = repository.SqlAlchemyRepository(session)\n    b1 = model.Batch(ref=\"b1\", sku=\"sku1\", qty=100, eta=None)\n    b2 = model.Batch(ref=\"b2\", sku=\"sku1\", qty=100, eta=None)\n    b3 = model.Batch(ref=\"b3\", sku=\"sku2\", qty=100, eta=None)\n    p1 = model.Product(sku=\"sku1\", batches=[b1, b2])\n    p2 = model.Product(sku=\"sku2\", batches=[b3])\n    repo.add(p1)\n    repo.add(p2)\n    assert repo.get_by_batchref(\"b2\") == p1\n    assert repo.get_by_batchref(\"b3\") == p2",
        "complexity": 0,
        "lines_of_code": 11,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 11,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Pure"
      },
      {
        "id": "bus",
        "label": "bus",
        "name": "bus",
        "kind": "function",
        "role": "Configuration",
        "role_icon": "\u26a1",
        "role_confidence": 90.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_email.py",
        "start_line": 13,
        "end_line": 21,
        "params": [
          {
            "name": "sqlite_session_factory"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [
          "pytest.fixture"
        ],
        "docstring": "",
        "signature": "def bus(sqlite_session_factory):",
        "body_source": "def bus(sqlite_session_factory):\n    bus = bootstrap.bootstrap(\n        start_orm=True,\n        uow=unit_of_work.SqlAlchemyUnitOfWork(sqlite_session_factory),\n        notifications=notifications.EmailNotifications(),\n        publish=lambda *args: None,\n    )\n    yield bus\n    clear_mappers()",
        "complexity": 0,
        "lines_of_code": 8,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 8,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Deferred",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "get_email_from_mailhog",
        "label": "get_email_from_mailhog",
        "name": "get_email_from_mailhog",
        "kind": "function",
        "role": "Query",
        "role_icon": "\ud83d\udce5",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_email.py",
        "start_line": 24,
        "end_line": 27,
        "params": [
          {
            "name": "sku"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def get_email_from_mailhog(sku):",
        "body_source": "def get_email_from_mailhog(sku):\n    host, port = map(config.get_email_host_and_port().get, [\"host\", \"http_port\"])\n    all_emails = requests.get(f\"http://{host}:{port}/api/v2/messages\").json()\n    return next(m for m in all_emails[\"items\"] if sku in str(m))",
        "complexity": 0,
        "lines_of_code": 3,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 3,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Pure"
      },
      {
        "id": "test_out_of_stock_email",
        "label": "test_out_of_stock_email",
        "name": "test_out_of_stock_email",
        "kind": "function",
        "role": "Test",
        "role_icon": "\ud83e\uddea",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_email.py",
        "start_line": 30,
        "end_line": 37,
        "params": [
          {
            "name": "bus"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def test_out_of_stock_email(bus):",
        "body_source": "def test_out_of_stock_email(bus):\n    sku = random_sku()\n    bus.handle(commands.CreateBatch(\"batch1\", sku, 9, None))\n    bus.handle(commands.Allocate(\"order1\", sku, 10))\n    email = get_email_from_mailhog(sku)\n    assert email[\"Raw\"][\"From\"] == \"allocations@example.com\"\n    assert email[\"Raw\"][\"To\"] == [\"stock@made.com\"]\n    assert f\"Out of stock for {sku}\" in email[\"Raw\"][\"Data\"]",
        "complexity": 0,
        "lines_of_code": 7,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 7,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "sqlite_bus",
        "label": "sqlite_bus",
        "name": "sqlite_bus",
        "kind": "function",
        "role": "Configuration",
        "role_icon": "\u26a1",
        "role_confidence": 90.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_views.py",
        "start_line": 14,
        "end_line": 22,
        "params": [
          {
            "name": "sqlite_session_factory"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [
          "pytest.fixture"
        ],
        "docstring": "",
        "signature": "def sqlite_bus(sqlite_session_factory):",
        "body_source": "def sqlite_bus(sqlite_session_factory):\n    bus = bootstrap.bootstrap(\n        start_orm=True,\n        uow=unit_of_work.SqlAlchemyUnitOfWork(sqlite_session_factory),\n        notifications=mock.Mock(),\n        publish=lambda *args: None,\n    )\n    yield bus\n    clear_mappers()",
        "complexity": 0,
        "lines_of_code": 8,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 8,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Deferred",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "test_allocations_view",
        "label": "test_allocations_view",
        "name": "test_allocations_view",
        "kind": "function",
        "role": "Test",
        "role_icon": "\ud83e\uddea",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_views.py",
        "start_line": 25,
        "end_line": 38,
        "params": [
          {
            "name": "sqlite_bus"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def test_allocations_view(sqlite_bus):",
        "body_source": "def test_allocations_view(sqlite_bus):\n    sqlite_bus.handle(commands.CreateBatch(\"sku1batch\", \"sku1\", 50, None))\n    sqlite_bus.handle(commands.CreateBatch(\"sku2batch\", \"sku2\", 50, today))\n    sqlite_bus.handle(commands.Allocate(\"order1\", \"sku1\", 20))\n    sqlite_bus.handle(commands.Allocate(\"order1\", \"sku2\", 20))\n    # add a spurious batch and order to make sure we're getting the right ones\n    sqlite_bus.handle(commands.CreateBatch(\"sku1batch-later\", \"sku1\", 50, today))\n    sqlite_bus.handle(commands.Allocate(\"otherorder\", \"sku1\", 30))\n    sqlite_bus.handle(commands.Allocate(\"otherorder\", \"sku2\", 10))\n\n    assert views.allocations(\"order1\", sqlite_bus.uow) == [\n        {\"sku\": \"sku1\", \"batchref\": \"sku1batch\"},\n        {\"sku\": \"sku2\", \"batchref\": \"sku2batch\"},\n    ]",
        "complexity": 0,
        "lines_of_code": 13,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 13,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "test_deallocation",
        "label": "test_deallocation",
        "name": "test_deallocation",
        "kind": "function",
        "role": "Test",
        "role_icon": "\ud83e\uddea",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_views.py",
        "start_line": 41,
        "end_line": 49,
        "params": [
          {
            "name": "sqlite_bus"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def test_deallocation(sqlite_bus):",
        "body_source": "def test_deallocation(sqlite_bus):\n    sqlite_bus.handle(commands.CreateBatch(\"b1\", \"sku1\", 50, None))\n    sqlite_bus.handle(commands.CreateBatch(\"b2\", \"sku1\", 50, today))\n    sqlite_bus.handle(commands.Allocate(\"o1\", \"sku1\", 40))\n    sqlite_bus.handle(commands.ChangeBatchQuantity(\"b1\", 10))\n\n    assert views.allocations(\"o1\", sqlite_bus.uow) == [\n        {\"sku\": \"sku1\", \"batchref\": \"b2\"},\n    ]",
        "complexity": 0,
        "lines_of_code": 8,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 8,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "insert_batch",
        "label": "insert_batch",
        "name": "insert_batch",
        "kind": "function",
        "role": "Utility",
        "role_icon": "\u26a1",
        "role_confidence": 60.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_uow.py",
        "start_line": 15,
        "end_line": 24,
        "params": [
          {
            "name": "session"
          },
          {
            "name": "ref"
          },
          {
            "name": "sku"
          },
          {
            "name": "qty"
          },
          {
            "name": "eta"
          },
          {
            "name": "product_version",
            "default": "1"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def insert_batch(session, ref, sku, qty, eta, product_version=1):",
        "body_source": "def insert_batch(session, ref, sku, qty, eta, product_version=1):\n    session.execute(\n        \"INSERT INTO products (sku, version_number) VALUES (:sku, :version)\",\n        dict(sku=sku, version=product_version),\n    )\n    session.execute(\n        \"INSERT INTO batches (reference, sku, _purchased_quantity, eta)\"\n        \" VALUES (:ref, :sku, :qty, :eta)\",\n        dict(ref=ref, sku=sku, qty=qty, eta=eta),\n    )",
        "complexity": 0,
        "lines_of_code": 9,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 9,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "get_allocated_batch_ref",
        "label": "get_allocated_batch_ref",
        "name": "get_allocated_batch_ref",
        "kind": "function",
        "role": "Query",
        "role_icon": "\ud83d\udce5",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_uow.py",
        "start_line": 27,
        "end_line": 37,
        "params": [
          {
            "name": "session"
          },
          {
            "name": "orderid"
          },
          {
            "name": "sku"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def get_allocated_batch_ref(session, orderid, sku):",
        "body_source": "def get_allocated_batch_ref(session, orderid, sku):\n    [[orderlineid]] = session.execute(\n        \"SELECT id FROM order_lines WHERE orderid=:orderid AND sku=:sku\",\n        dict(orderid=orderid, sku=sku),\n    )\n    [[batchref]] = session.execute(\n        \"SELECT b.reference FROM allocations JOIN batches AS b ON batch_id = b.id\"\n        \" WHERE orderline_id=:orderlineid\",\n        dict(orderlineid=orderlineid),\n    )\n    return batchref",
        "complexity": 0,
        "lines_of_code": 10,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 10,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Pure"
      },
      {
        "id": "test_uow_can_retrieve_a_batch_and_allocate_to_it",
        "label": "test_uow_can_retrieve_a_batch_and_alloca",
        "name": "test_uow_can_retrieve_a_batch_and_allocate_to_it",
        "kind": "function",
        "role": "Specification",
        "role_icon": "\u26a1",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_uow.py",
        "start_line": 40,
        "end_line": 53,
        "params": [
          {
            "name": "sqlite_session_factory"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def test_uow_can_retrieve_a_batch_and_allocate_to_it(sqlite_session_factory):",
        "body_source": "def test_uow_can_retrieve_a_batch_and_allocate_to_it(sqlite_session_factory):\n    session = sqlite_session_factory()\n    insert_batch(session, \"batch1\", \"HIPSTER-WORKBENCH\", 100, None)\n    session.commit()\n\n    uow = unit_of_work.SqlAlchemyUnitOfWork(sqlite_session_factory)\n    with uow:\n        product = uow.products.get(sku=\"HIPSTER-WORKBENCH\")\n        line = model.OrderLine(\"o1\", \"HIPSTER-WORKBENCH\", 10)\n        product.allocate(line)\n        uow.commit()\n\n    batchref = get_allocated_batch_ref(session, \"o1\", \"HIPSTER-WORKBENCH\")\n    assert batchref == \"batch1\"",
        "complexity": 0,
        "lines_of_code": 13,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 13,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "test_rolls_back_uncommitted_work_by_default",
        "label": "test_rolls_back_uncommitted_work_by_defa",
        "name": "test_rolls_back_uncommitted_work_by_default",
        "kind": "function",
        "role": "Test",
        "role_icon": "\ud83e\uddea",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_uow.py",
        "start_line": 56,
        "end_line": 63,
        "params": [
          {
            "name": "sqlite_session_factory"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def test_rolls_back_uncommitted_work_by_default(sqlite_session_factory):",
        "body_source": "def test_rolls_back_uncommitted_work_by_default(sqlite_session_factory):\n    uow = unit_of_work.SqlAlchemyUnitOfWork(sqlite_session_factory)\n    with uow:\n        insert_batch(uow.session, \"batch1\", \"MEDIUM-PLINTH\", 100, None)\n\n    new_session = sqlite_session_factory()\n    rows = list(new_session.execute('SELECT * FROM \"batches\"'))\n    assert rows == []",
        "complexity": 0,
        "lines_of_code": 7,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 7,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "test_rolls_back_on_error",
        "label": "test_rolls_back_on_error",
        "name": "test_rolls_back_on_error",
        "kind": "function",
        "role": "Observer",
        "role_icon": "\u26a1",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_uow.py",
        "start_line": 66,
        "end_line": 78,
        "params": [
          {
            "name": "sqlite_session_factory"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def test_rolls_back_on_error(sqlite_session_factory):",
        "body_source": "def test_rolls_back_on_error(sqlite_session_factory):\n    class MyException(Exception):\n        pass\n\n    uow = unit_of_work.SqlAlchemyUnitOfWork(sqlite_session_factory)\n    with pytest.raises(MyException):\n        with uow:\n            insert_batch(uow.session, \"batch1\", \"LARGE-FORK\", 100, None)\n            raise MyException()\n\n    new_session = sqlite_session_factory()\n    rows = list(new_session.execute('SELECT * FROM \"batches\"'))\n    assert rows == []",
        "complexity": 0,
        "lines_of_code": 12,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 12,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "MyException",
        "label": "MyException",
        "name": "MyException",
        "kind": "class",
        "role": "Test",
        "role_icon": "\ud83e\uddea",
        "role_confidence": 80.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_uow.py",
        "start_line": 67,
        "end_line": 67,
        "params": [],
        "return_type": "",
        "base_classes": [
          "Exception"
        ],
        "decorators": [],
        "docstring": "",
        "signature": "class MyException(Exception):",
        "body_source": "",
        "complexity": 0,
        "lines_of_code": 0,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateful",
        "activation": "Direct",
        "lifetime": "Singleton",
        "effect": "Side-Effect"
      },
      {
        "id": "try_to_allocate",
        "label": "try_to_allocate",
        "name": "try_to_allocate",
        "kind": "function",
        "role": "Utility",
        "role_icon": "\u26a1",
        "role_confidence": 60.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_uow.py",
        "start_line": 81,
        "end_line": 91,
        "params": [
          {
            "name": "orderid"
          },
          {
            "name": "sku"
          },
          {
            "name": "exceptions"
          },
          {
            "name": "session_factory"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def try_to_allocate(orderid, sku, exceptions, session_factory):",
        "body_source": "def try_to_allocate(orderid, sku, exceptions, session_factory):\n    line = model.OrderLine(orderid, sku, 10)\n    try:\n        with unit_of_work.SqlAlchemyUnitOfWork(session_factory) as uow:\n            product = uow.products.get(sku=sku)\n            product.allocate(line)\n            time.sleep(0.2)\n            uow.commit()\n    except Exception as e:  # pylint: disable=broad-except\n        print(traceback.format_exc())\n        exceptions.append(e)",
        "complexity": 0,
        "lines_of_code": 10,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 10,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "test_concurrent_updates_to_version_are_not_allowed",
        "label": "test_concurrent_updates_to_version_are_n",
        "name": "test_concurrent_updates_to_version_are_not_allowed",
        "kind": "function",
        "role": "Test",
        "role_icon": "\ud83e\uddea",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/integration/test_uow.py",
        "start_line": 94,
        "end_line": 132,
        "params": [
          {
            "name": "postgres_session_factory"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def test_concurrent_updates_to_version_are_not_allowed(postgres_session_factory):",
        "body_source": "def test_concurrent_updates_to_version_are_not_allowed(postgres_session_factory):\n    sku, batch = random_sku(), random_batchref()\n    session = postgres_session_factory()\n    insert_batch(session, batch, sku, 100, eta=None, product_version=1)\n    session.commit()\n\n    order1, order2 = random_orderid(1), random_orderid(2)\n    exceptions = []  # type: List[Exception]\n    try_to_allocate_order1 = lambda: try_to_allocate(\n        order1, sku, exceptions, postgres_session_factory\n    )\n    try_to_allocate_order2 = lambda: try_to_allocate(\n        order2, sku, exceptions, postgres_session_factory\n    )\n    thread1 = threading.Thread(target=try_to_allocate_order1)\n    thread2 = threading.Thread(target=try_to_allocate_order2)\n    thread1.start()\n    thread2.start()\n    thread1.join()\n    thread2.join()\n\n    [[version]] = session.execute(\n        \"SELECT version_number FROM products WHERE sku=:sku\",\n        dict(sku=sku),\n    )\n    assert version == 2\n    [exception] = exceptions\n    assert \"could not serialize access due to concurrent update\" in str(exception)\n\n    orders = session.execute(\n        \"SELECT orderid FROM allocations\"\n        \" JOIN batches ON allocations.batch_id = batches.id\"\n        \" JOIN order_lines ON allocations.orderline_id = order_lines.id\"\n        \" WHERE order_lines.sku=:sku\",\n        dict(sku=sku),\n    )\n    assert orders.rowcount == 1\n    with unit_of_work.SqlAlchemyUnitOfWork(postgres_session_factory) as uow:\n        uow.session.execute(\"select 1\")",
        "complexity": 0,
        "lines_of_code": 38,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 38,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "subscribe_to",
        "label": "subscribe_to",
        "name": "subscribe_to",
        "kind": "function",
        "role": "Observer",
        "role_icon": "\u26a1",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/e2e/redis_client.py",
        "start_line": 9,
        "end_line": 14,
        "params": [
          {
            "name": "channel"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def subscribe_to(channel):",
        "body_source": "def subscribe_to(channel):\n    pubsub = r.pubsub()\n    pubsub.subscribe(channel)\n    confirmation = pubsub.get_message(timeout=3)\n    assert confirmation[\"type\"] == \"subscribe\"\n    return pubsub",
        "complexity": 0,
        "lines_of_code": 5,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 5,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "publish_message",
        "label": "publish_message",
        "name": "publish_message",
        "kind": "function",
        "role": "Command",
        "role_icon": "\ud83d\udce4",
        "role_confidence": 75.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/e2e/redis_client.py",
        "start_line": 17,
        "end_line": 18,
        "params": [
          {
            "name": "channel"
          },
          {
            "name": "message"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def publish_message(channel, message):",
        "body_source": "def publish_message(channel, message):\n    r.publish(channel, json.dumps(message))",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "test_happy_path_returns_202_and_batch_is_allocated",
        "label": "test_happy_path_returns_202_and_batch_is",
        "name": "test_happy_path_returns_202_and_batch_is_allocated",
        "kind": "function",
        "role": "Configuration",
        "role_icon": "\u26a1",
        "role_confidence": 90.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/e2e/test_api.py",
        "start_line": 8,
        "end_line": 25,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [
          "pytest.mark.usefixtures",
          "pytest.mark.usefixtures"
        ],
        "docstring": "",
        "signature": "def test_happy_path_returns_202_and_batch_is_allocated():",
        "body_source": "def test_happy_path_returns_202_and_batch_is_allocated():\n    orderid = random_orderid()\n    sku, othersku = random_sku(), random_sku(\"other\")\n    earlybatch = random_batchref(1)\n    laterbatch = random_batchref(2)\n    otherbatch = random_batchref(3)\n    api_client.post_to_add_batch(laterbatch, sku, 100, \"2011-01-02\")\n    api_client.post_to_add_batch(earlybatch, sku, 100, \"2011-01-01\")\n    api_client.post_to_add_batch(otherbatch, othersku, 100, None)\n\n    r = api_client.post_to_allocate(orderid, sku, qty=3)\n    assert r.status_code == 202\n\n    r = api_client.get_allocation(orderid)\n    assert r.ok\n    assert r.json() == [\n        {\"sku\": sku, \"batchref\": earlybatch},\n    ]",
        "complexity": 0,
        "lines_of_code": 17,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 17,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Deferred",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "test_unhappy_path_returns_400_and_error_message",
        "label": "test_unhappy_path_returns_400_and_error_",
        "name": "test_unhappy_path_returns_400_and_error_message",
        "kind": "function",
        "role": "Configuration",
        "role_icon": "\u26a1",
        "role_confidence": 90.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/e2e/test_api.py",
        "start_line": 30,
        "end_line": 39,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [
          "pytest.mark.usefixtures",
          "pytest.mark.usefixtures"
        ],
        "docstring": "",
        "signature": "def test_unhappy_path_returns_400_and_error_message():",
        "body_source": "def test_unhappy_path_returns_400_and_error_message():\n    unknown_sku, orderid = random_sku(), random_orderid()\n    r = api_client.post_to_allocate(\n        orderid, unknown_sku, qty=20, expect_success=False\n    )\n    assert r.status_code == 400\n    assert r.json()[\"message\"] == f\"Invalid sku {unknown_sku}\"\n\n    r = api_client.get_allocation(orderid)\n    assert r.status_code == 404",
        "complexity": 0,
        "lines_of_code": 9,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 9,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Deferred",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "test_change_batch_quantity_leading_to_reallocation",
        "label": "test_change_batch_quantity_leading_to_re",
        "name": "test_change_batch_quantity_leading_to_reallocation",
        "kind": "function",
        "role": "Configuration",
        "role_icon": "\u26a1",
        "role_confidence": 90.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/e2e/test_external_events.py",
        "start_line": 11,
        "end_line": 40,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [
          "pytest.mark.usefixtures",
          "pytest.mark.usefixtures",
          "pytest.mark.usefixtures"
        ],
        "docstring": "",
        "signature": "def test_change_batch_quantity_leading_to_reallocation():",
        "body_source": "def test_change_batch_quantity_leading_to_reallocation():\n    # start with two batches and an order allocated to one of them\n    orderid, sku = random_orderid(), random_sku()\n    earlier_batch, later_batch = random_batchref(\"old\"), random_batchref(\"newer\")\n    api_client.post_to_add_batch(earlier_batch, sku, qty=10, eta=\"2011-01-01\")\n    api_client.post_to_add_batch(later_batch, sku, qty=10, eta=\"2011-01-02\")\n    r = api_client.post_to_allocate(orderid, sku, 10)\n    assert r.ok\n    response = api_client.get_allocation(orderid)\n    assert response.json()[0][\"batchref\"] == earlier_batch\n\n    subscription = redis_client.subscribe_to(\"line_allocated\")\n\n    # change quantity on allocated batch so it's less than our order\n    redis_client.publish_message(\n        \"change_batch_quantity\",\n        {\"batchref\": earlier_batch, \"qty\": 5},\n    )\n\n    # wait until we see a message saying the order has been reallocated\n    messages = []\n    for attempt in Retrying(stop=stop_after_delay(3), reraise=True):\n        with attempt:\n            message = subscription.get_message(timeout=1)\n            if message:\n                messages.append(message)\n                print(messages)\n            data = json.loads(messages[-1][\"data\"])\n            assert data[\"orderid\"] == orderid\n            assert data[\"batchref\"] == later_batch",
        "complexity": 0,
        "lines_of_code": 29,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 29,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Deferred",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "post_to_add_batch",
        "label": "post_to_add_batch",
        "name": "post_to_add_batch",
        "kind": "function",
        "role": "Fixture",
        "role_icon": "\u26a1",
        "role_confidence": 70.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/e2e/api_client.py",
        "start_line": 5,
        "end_line": 10,
        "params": [
          {
            "name": "ref"
          },
          {
            "name": "sku"
          },
          {
            "name": "qty"
          },
          {
            "name": "eta"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def post_to_add_batch(ref, sku, qty, eta):",
        "body_source": "def post_to_add_batch(ref, sku, qty, eta):\n    url = config.get_api_url()\n    r = requests.post(\n        f\"{url}/add_batch\", json={\"ref\": ref, \"sku\": sku, \"qty\": qty, \"eta\": eta}\n    )\n    assert r.status_code == 201",
        "complexity": 0,
        "lines_of_code": 5,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 5,
        "is_hotspot": true,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "post_to_allocate",
        "label": "post_to_allocate",
        "name": "post_to_allocate",
        "kind": "function",
        "role": "Fixture",
        "role_icon": "\u26a1",
        "role_confidence": 70.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/e2e/api_client.py",
        "start_line": 13,
        "end_line": 25,
        "params": [
          {
            "name": "orderid"
          },
          {
            "name": "sku"
          },
          {
            "name": "qty"
          },
          {
            "name": "expect_success",
            "default": "True"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def post_to_allocate(orderid, sku, qty, expect_success=True):",
        "body_source": "def post_to_allocate(orderid, sku, qty, expect_success=True):\n    url = config.get_api_url()\n    r = requests.post(\n        f\"{url}/allocate\",\n        json={\n            \"orderid\": orderid,\n            \"sku\": sku,\n            \"qty\": qty,\n        },\n    )\n    if expect_success:\n        assert r.status_code == 202\n    return r",
        "complexity": 0,
        "lines_of_code": 12,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 12,
        "is_hotspot": true,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "get_allocation",
        "label": "get_allocation",
        "name": "get_allocation",
        "kind": "function",
        "role": "Query",
        "role_icon": "\ud83d\udce5",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/tests/e2e/api_client.py",
        "start_line": 28,
        "end_line": 30,
        "params": [
          {
            "name": "orderid"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def get_allocation(orderid):",
        "body_source": "def get_allocation(orderid):\n    url = config.get_api_url()\n    return requests.get(f\"{url}/allocations/{orderid}\")",
        "complexity": 0,
        "lines_of_code": 2,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 2,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Pure"
      },
      {
        "id": "bootstrap",
        "label": "bootstrap",
        "name": "bootstrap",
        "kind": "function",
        "role": "ApplicationService",
        "role_icon": "\u26a1",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/bootstrap.py",
        "start_line": 11,
        "end_line": 41,
        "params": [
          {
            "name": "start_orm",
            "type": "bool",
            "default": "True"
          },
          {
            "name": "uow",
            "type": "unit_of_work.AbstractUnitOfWork",
            "default": "unit_of_work.SqlAlchemyUnitOfWork()"
          },
          {
            "name": "notifications",
            "type": "AbstractNotifications",
            "default": "None"
          },
          {
            "name": "publish",
            "type": "Callable",
            "default": "redis_eventpublisher.publish"
          }
        ],
        "return_type": "messagebus.MessageBus",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def bootstrap(",
        "body_source": "def bootstrap(\n    start_orm: bool = True,\n    uow: unit_of_work.AbstractUnitOfWork = unit_of_work.SqlAlchemyUnitOfWork(),\n    notifications: AbstractNotifications = None,\n    publish: Callable = redis_eventpublisher.publish,\n) -> messagebus.MessageBus:\n\n    if notifications is None:\n        notifications = EmailNotifications()\n\n    if start_orm:\n        orm.start_mappers()\n\n    dependencies = {\"uow\": uow, \"notifications\": notifications, \"publish\": publish}\n    injected_event_handlers = {\n        event_type: [\n            inject_dependencies(handler, dependencies)\n            for handler in event_handlers\n        ]\n        for event_type, event_handlers in handlers.EVENT_HANDLERS.items()\n    }\n    injected_command_handlers = {\n        command_type: inject_dependencies(handler, dependencies)\n        for command_type, handler in handlers.COMMAND_HANDLERS.items()\n    }\n\n    return messagebus.MessageBus(\n        uow=uow,\n        event_handlers=injected_event_handlers,\n        command_handlers=injected_command_handlers,\n    )",
        "complexity": 0,
        "lines_of_code": 30,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 30,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "inject_dependencies",
        "label": "inject_dependencies",
        "name": "inject_dependencies",
        "kind": "function",
        "role": "Utility",
        "role_icon": "\u26a1",
        "role_confidence": 60.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/bootstrap.py",
        "start_line": 44,
        "end_line": 51,
        "params": [
          {
            "name": "handler"
          },
          {
            "name": "dependencies"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def inject_dependencies(handler, dependencies):",
        "body_source": "def inject_dependencies(handler, dependencies):\n    params = inspect.signature(handler).parameters\n    deps = {\n        name: dependency\n        for name, dependency in dependencies.items()\n        if name in params\n    }\n    return lambda message: handler(message, **deps)",
        "complexity": 0,
        "lines_of_code": 7,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 7,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "get_postgres_uri",
        "label": "get_postgres_uri",
        "name": "get_postgres_uri",
        "kind": "function",
        "role": "Query",
        "role_icon": "\ud83d\udce5",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/config.py",
        "start_line": 4,
        "end_line": 9,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def get_postgres_uri():",
        "body_source": "def get_postgres_uri():\n    host = os.environ.get(\"DB_HOST\", \"localhost\")\n    port = 54321 if host == \"localhost\" else 5432\n    password = os.environ.get(\"DB_PASSWORD\", \"abc123\")\n    user, db_name = \"allocation\", \"allocation\"\n    return f\"postgresql://{user}:{password}@{host}:{port}/{db_name}\"",
        "complexity": 0,
        "lines_of_code": 5,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 5,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Pure"
      },
      {
        "id": "get_api_url",
        "label": "get_api_url",
        "name": "get_api_url",
        "kind": "function",
        "role": "Query",
        "role_icon": "\ud83d\udce5",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/config.py",
        "start_line": 12,
        "end_line": 15,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def get_api_url():",
        "body_source": "def get_api_url():\n    host = os.environ.get(\"API_HOST\", \"localhost\")\n    port = 5005 if host == \"localhost\" else 80\n    return f\"http://{host}:{port}\"",
        "complexity": 0,
        "lines_of_code": 3,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 3,
        "is_hotspot": true,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Pure"
      },
      {
        "id": "get_redis_host_and_port",
        "label": "get_redis_host_and_port",
        "name": "get_redis_host_and_port",
        "kind": "function",
        "role": "Query",
        "role_icon": "\ud83d\udce5",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/config.py",
        "start_line": 18,
        "end_line": 21,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def get_redis_host_and_port():",
        "body_source": "def get_redis_host_and_port():\n    host = os.environ.get(\"REDIS_HOST\", \"localhost\")\n    port = 63791 if host == \"localhost\" else 6379\n    return dict(host=host, port=port)",
        "complexity": 0,
        "lines_of_code": 3,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 3,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Pure"
      },
      {
        "id": "get_email_host_and_port",
        "label": "get_email_host_and_port",
        "name": "get_email_host_and_port",
        "kind": "function",
        "role": "Query",
        "role_icon": "\ud83d\udce5",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/config.py",
        "start_line": 24,
        "end_line": 28,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def get_email_host_and_port():",
        "body_source": "def get_email_host_and_port():\n    host = os.environ.get(\"EMAIL_HOST\", \"localhost\")\n    port = 11025 if host == \"localhost\" else 1025\n    http_port = 18025 if host == \"localhost\" else 8025\n    return dict(host=host, port=port, http_port=http_port)",
        "complexity": 0,
        "lines_of_code": 4,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 4,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Pure"
      },
      {
        "id": "allocations",
        "label": "allocations",
        "name": "allocations",
        "kind": "function",
        "role": "Utility",
        "role_icon": "\u26a1",
        "role_confidence": 60.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/views.py",
        "start_line": 4,
        "end_line": 12,
        "params": [
          {
            "name": "orderid",
            "type": "str"
          },
          {
            "name": "uow",
            "type": "unit_of_work.SqlAlchemyUnitOfWork"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def allocations(orderid: str, uow: unit_of_work.SqlAlchemyUnitOfWork):",
        "body_source": "def allocations(orderid: str, uow: unit_of_work.SqlAlchemyUnitOfWork):\n    with uow:\n        results = uow.session.execute(\n            \"\"\"\n            SELECT sku, batchref FROM allocations_view WHERE orderid = :orderid\n            \"\"\",\n            dict(orderid=orderid),\n        )\n    return [dict(r) for r in results]",
        "complexity": 0,
        "lines_of_code": 8,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 8,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "start_mappers",
        "label": "start_mappers",
        "name": "start_mappers",
        "kind": "function",
        "role": "UseCase",
        "role_icon": "\ud83c\udfaf",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/orm.py",
        "start_line": 63,
        "end_line": 81,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def start_mappers():",
        "body_source": "def start_mappers():\n    logger.info(\"Starting mappers\")\n    lines_mapper = mapper(model.OrderLine, order_lines)\n    batches_mapper = mapper(\n        model.Batch,\n        batches,\n        properties={\n            \"_allocations\": relationship(\n                lines_mapper,\n                secondary=allocations,\n                collection_class=set,\n            )\n        },\n    )\n    mapper(\n        model.Product,\n        products,\n        properties={\"batches\": relationship(batches_mapper)},\n    )",
        "complexity": 0,
        "lines_of_code": 18,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 18,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "receive_load",
        "label": "receive_load",
        "name": "receive_load",
        "kind": "function",
        "role": "Query",
        "role_icon": "\ud83d\udce5",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/orm.py",
        "start_line": 85,
        "end_line": 86,
        "params": [
          {
            "name": "product"
          },
          {
            "name": "_"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [
          "event.listens_for"
        ],
        "docstring": "",
        "signature": "def receive_load(product, _):",
        "body_source": "def receive_load(product, _):\n    product.events = []",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Pure"
      },
      {
        "id": "AbstractNotifications",
        "label": "AbstractNotifications",
        "name": "AbstractNotifications",
        "kind": "class",
        "role": "Adapter",
        "role_icon": "\u26a1",
        "role_confidence": 75.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/notifications.py",
        "start_line": 7,
        "end_line": 7,
        "params": [],
        "return_type": "",
        "base_classes": [
          "ABC"
        ],
        "decorators": [],
        "docstring": "",
        "signature": "class AbstractNotifications(abc.ABC):",
        "body_source": "",
        "complexity": 0,
        "lines_of_code": 0,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateful",
        "activation": "Direct",
        "lifetime": "Singleton",
        "effect": "Side-Effect"
      },
      {
        "id": "AbstractNotifications.send",
        "label": "AbstractNotifications.send",
        "name": "AbstractNotifications.send",
        "kind": "method",
        "role": "Command",
        "role_icon": "\ud83d\udce4",
        "role_confidence": 75.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/notifications.py",
        "start_line": 9,
        "end_line": 10,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "destination"
          },
          {
            "name": "message"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [
          "abc.abstractmethod"
        ],
        "docstring": "",
        "signature": "def send(self, destination, message):",
        "body_source": "    def send(self, destination, message):\n        raise NotImplementedError",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "EmailNotifications",
        "label": "EmailNotifications",
        "name": "EmailNotifications",
        "kind": "class",
        "role": "Adapter",
        "role_icon": "\u26a1",
        "role_confidence": 75.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/notifications.py",
        "start_line": 17,
        "end_line": 17,
        "params": [],
        "return_type": "",
        "base_classes": [
          "AbstractNotifications"
        ],
        "decorators": [],
        "docstring": "",
        "signature": "class EmailNotifications(AbstractNotifications):",
        "body_source": "",
        "complexity": 0,
        "lines_of_code": 0,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateful",
        "activation": "Direct",
        "lifetime": "Singleton",
        "effect": "Side-Effect"
      },
      {
        "id": "EmailNotifications.__init__",
        "label": "EmailNotifications.__init__",
        "name": "EmailNotifications.__init__",
        "kind": "method",
        "role": "ApplicationService",
        "role_icon": "\u26a1",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/notifications.py",
        "start_line": 18,
        "end_line": 20,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "smtp_host",
            "default": "DEFAULT_HOST"
          },
          {
            "name": "port",
            "default": "DEFAULT_PORT"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def __init__(self, smtp_host=DEFAULT_HOST, port=DEFAULT_PORT):",
        "body_source": "    def __init__(self, smtp_host=DEFAULT_HOST, port=DEFAULT_PORT):\n        self.server = smtplib.SMTP(smtp_host, port=port)\n        self.server.noop()",
        "complexity": 0,
        "lines_of_code": 2,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 2,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "EmailNotifications.send",
        "label": "EmailNotifications.send",
        "name": "EmailNotifications.send",
        "kind": "method",
        "role": "Command",
        "role_icon": "\ud83d\udce4",
        "role_confidence": 75.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/notifications.py",
        "start_line": 22,
        "end_line": 28,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "destination"
          },
          {
            "name": "message"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def send(self, destination, message):",
        "body_source": "    def send(self, destination, message):\n        msg = f\"Subject: allocation service notification\\n{message}\"\n        self.server.sendmail(\n            from_addr=\"allocations@example.com\",\n            to_addrs=[destination],\n            msg=msg,\n        )",
        "complexity": 0,
        "lines_of_code": 6,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 6,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "AbstractRepository",
        "label": "AbstractRepository",
        "name": "AbstractRepository",
        "kind": "class",
        "role": "Adapter",
        "role_icon": "\u26a1",
        "role_confidence": 75.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py",
        "start_line": 7,
        "end_line": 7,
        "params": [],
        "return_type": "",
        "base_classes": [
          "ABC"
        ],
        "decorators": [],
        "docstring": "",
        "signature": "class AbstractRepository(abc.ABC):",
        "body_source": "",
        "complexity": 0,
        "lines_of_code": 0,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateful",
        "activation": "Direct",
        "lifetime": "Singleton",
        "effect": "Side-Effect"
      },
      {
        "id": "AbstractRepository.__init__",
        "label": "AbstractRepository.__init__",
        "name": "AbstractRepository.__init__",
        "kind": "method",
        "role": "ApplicationService",
        "role_icon": "\u26a1",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py",
        "start_line": 8,
        "end_line": 9,
        "params": [
          {
            "name": "self"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def __init__(self):",
        "body_source": "    def __init__(self):\n        self.seen = set()  # type: Set[model.Product]",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "AbstractRepository.add",
        "label": "AbstractRepository.add",
        "name": "AbstractRepository.add",
        "kind": "method",
        "role": "Utility",
        "role_icon": "\u26a1",
        "role_confidence": 60.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py",
        "start_line": 11,
        "end_line": 13,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "product",
            "type": "model.Product"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def add(self, product: model.Product):",
        "body_source": "    def add(self, product: model.Product):\n        self._add(product)\n        self.seen.add(product)",
        "complexity": 0,
        "lines_of_code": 2,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 2,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "AbstractRepository.get",
        "label": "AbstractRepository.get",
        "name": "AbstractRepository.get",
        "kind": "method",
        "role": "Query",
        "role_icon": "\ud83d\udce5",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py",
        "start_line": 15,
        "end_line": 19,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "sku"
          }
        ],
        "return_type": "model.Product",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def get(self, sku) -> model.Product:",
        "body_source": "    def get(self, sku) -> model.Product:\n        product = self._get(sku)\n        if product:\n            self.seen.add(product)\n        return product",
        "complexity": 0,
        "lines_of_code": 4,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 4,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Pure"
      },
      {
        "id": "AbstractRepository.get_by_batchref",
        "label": "AbstractRepository.get_by_batchref",
        "name": "AbstractRepository.get_by_batchref",
        "kind": "method",
        "role": "Query",
        "role_icon": "\ud83d\udce5",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py",
        "start_line": 21,
        "end_line": 25,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "batchref"
          }
        ],
        "return_type": "model.Product",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def get_by_batchref(self, batchref) -> model.Product:",
        "body_source": "    def get_by_batchref(self, batchref) -> model.Product:\n        product = self._get_by_batchref(batchref)\n        if product:\n            self.seen.add(product)\n        return product",
        "complexity": 0,
        "lines_of_code": 4,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 4,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Pure"
      },
      {
        "id": "AbstractRepository._add",
        "label": "AbstractRepository._add",
        "name": "AbstractRepository._add",
        "kind": "method",
        "role": "Internal",
        "role_icon": "\u26a1",
        "role_confidence": 70.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py",
        "start_line": 28,
        "end_line": 29,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "product",
            "type": "model.Product"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [
          "abc.abstractmethod"
        ],
        "docstring": "",
        "signature": "def _add(self, product: model.Product):",
        "body_source": "    def _add(self, product: model.Product):\n        raise NotImplementedError",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "AbstractRepository._get",
        "label": "AbstractRepository._get",
        "name": "AbstractRepository._get",
        "kind": "method",
        "role": "Query",
        "role_icon": "\ud83d\udce5",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py",
        "start_line": 32,
        "end_line": 33,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "sku"
          }
        ],
        "return_type": "model.Product",
        "base_classes": [],
        "decorators": [
          "abc.abstractmethod"
        ],
        "docstring": "",
        "signature": "def _get(self, sku) -> model.Product:",
        "body_source": "    def _get(self, sku) -> model.Product:\n        raise NotImplementedError",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Pure"
      },
      {
        "id": "AbstractRepository._get_by_batchref",
        "label": "AbstractRepository._get_by_batchref",
        "name": "AbstractRepository._get_by_batchref",
        "kind": "method",
        "role": "Query",
        "role_icon": "\ud83d\udce5",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py",
        "start_line": 36,
        "end_line": 37,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "batchref"
          }
        ],
        "return_type": "model.Product",
        "base_classes": [],
        "decorators": [
          "abc.abstractmethod"
        ],
        "docstring": "",
        "signature": "def _get_by_batchref(self, batchref) -> model.Product:",
        "body_source": "    def _get_by_batchref(self, batchref) -> model.Product:\n        raise NotImplementedError",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Pure"
      },
      {
        "id": "SqlAlchemyRepository",
        "label": "SqlAlchemyRepository",
        "name": "SqlAlchemyRepository",
        "kind": "class",
        "role": "Repository",
        "role_icon": "\ud83d\udcbe",
        "role_confidence": 99.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py",
        "start_line": 40,
        "end_line": 40,
        "params": [],
        "return_type": "",
        "base_classes": [
          "AbstractRepository"
        ],
        "decorators": [],
        "docstring": "",
        "signature": "class SqlAlchemyRepository(AbstractRepository):",
        "body_source": "",
        "complexity": 0,
        "lines_of_code": 0,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateful",
        "activation": "Direct",
        "lifetime": "Singleton",
        "effect": "Side-Effect"
      },
      {
        "id": "SqlAlchemyRepository.__init__",
        "label": "SqlAlchemyRepository.__init__",
        "name": "SqlAlchemyRepository.__init__",
        "kind": "method",
        "role": "ApplicationService",
        "role_icon": "\u26a1",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py",
        "start_line": 41,
        "end_line": 43,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "session"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def __init__(self, session):",
        "body_source": "    def __init__(self, session):\n        super().__init__()\n        self.session = session",
        "complexity": 0,
        "lines_of_code": 2,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 2,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "SqlAlchemyRepository._add",
        "label": "SqlAlchemyRepository._add",
        "name": "SqlAlchemyRepository._add",
        "kind": "method",
        "role": "Internal",
        "role_icon": "\u26a1",
        "role_confidence": 70.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py",
        "start_line": 45,
        "end_line": 46,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "product"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def _add(self, product):",
        "body_source": "    def _add(self, product):\n        self.session.add(product)",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "SqlAlchemyRepository._get",
        "label": "SqlAlchemyRepository._get",
        "name": "SqlAlchemyRepository._get",
        "kind": "method",
        "role": "Query",
        "role_icon": "\ud83d\udce5",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py",
        "start_line": 48,
        "end_line": 49,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "sku"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def _get(self, sku):",
        "body_source": "    def _get(self, sku):\n        return self.session.query(model.Product).filter_by(sku=sku).first()",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Pure"
      },
      {
        "id": "SqlAlchemyRepository._get_by_batchref",
        "label": "SqlAlchemyRepository._get_by_batchref",
        "name": "SqlAlchemyRepository._get_by_batchref",
        "kind": "method",
        "role": "Query",
        "role_icon": "\ud83d\udce5",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/repository.py",
        "start_line": 51,
        "end_line": 59,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "batchref"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def _get_by_batchref(self, batchref):",
        "body_source": "    def _get_by_batchref(self, batchref):\n        return (\n            self.session.query(model.Product)\n            .join(model.Batch)\n            .filter(\n                orm.batches.c.reference == batchref,\n            )\n            .first()\n        )",
        "complexity": 0,
        "lines_of_code": 8,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 8,
        "is_hotspot": true,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Pure"
      },
      {
        "id": "publish",
        "label": "publish",
        "name": "publish",
        "kind": "function",
        "role": "Command",
        "role_icon": "\ud83d\udce4",
        "role_confidence": 75.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/adapters/redis_eventpublisher.py",
        "start_line": 14,
        "end_line": 16,
        "params": [
          {
            "name": "channel"
          },
          {
            "name": "event",
            "type": "events.Event"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def publish(channel, event: events.Event):",
        "body_source": "def publish(channel, event: events.Event):\n    logging.info(\"publishing: channel=%s, event=%s\", channel, event)\n    r.publish(channel, json.dumps(asdict(event)))",
        "complexity": 0,
        "lines_of_code": 2,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 2,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "InvalidSku",
        "label": "InvalidSku",
        "name": "InvalidSku",
        "kind": "class",
        "role": "Exception",
        "role_icon": "\u26a1",
        "role_confidence": 75.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/handlers.py",
        "start_line": 13,
        "end_line": 13,
        "params": [],
        "return_type": "",
        "base_classes": [
          "Exception"
        ],
        "decorators": [],
        "docstring": "",
        "signature": "class InvalidSku(Exception):",
        "body_source": "",
        "complexity": 0,
        "lines_of_code": 0,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateful",
        "activation": "Direct",
        "lifetime": "Singleton",
        "effect": "Side-Effect"
      },
      {
        "id": "add_batch",
        "label": "add_batch",
        "name": "add_batch",
        "kind": "function",
        "role": "Command",
        "role_icon": "\ud83d\udce4",
        "role_confidence": 85.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/handlers.py",
        "start_line": 17,
        "end_line": 27,
        "params": [
          {
            "name": "cmd",
            "type": "commands.CreateBatch"
          },
          {
            "name": "uow",
            "type": "unit_of_work.AbstractUnitOfWork"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def add_batch(",
        "body_source": "def add_batch(\n    cmd: commands.CreateBatch,\n    uow: unit_of_work.AbstractUnitOfWork,\n):\n    with uow:\n        product = uow.products.get(sku=cmd.sku)\n        if product is None:\n            product = model.Product(cmd.sku, batches=[])\n            uow.products.add(product)\n        product.batches.append(model.Batch(cmd.ref, cmd.sku, cmd.qty, cmd.eta))\n        uow.commit()",
        "complexity": 0,
        "lines_of_code": 10,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 10,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "allocate",
        "label": "allocate",
        "name": "allocate",
        "kind": "function",
        "role": "Utility",
        "role_icon": "\u26a1",
        "role_confidence": 60.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/handlers.py",
        "start_line": 30,
        "end_line": 40,
        "params": [
          {
            "name": "cmd",
            "type": "commands.Allocate"
          },
          {
            "name": "uow",
            "type": "unit_of_work.AbstractUnitOfWork"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def allocate(",
        "body_source": "def allocate(\n    cmd: commands.Allocate,\n    uow: unit_of_work.AbstractUnitOfWork,\n):\n    line = OrderLine(cmd.orderid, cmd.sku, cmd.qty)\n    with uow:\n        product = uow.products.get(sku=line.sku)\n        if product is None:\n            raise InvalidSku(f\"Invalid sku {line.sku}\")\n        product.allocate(line)\n        uow.commit()",
        "complexity": 0,
        "lines_of_code": 10,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 10,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "reallocate",
        "label": "reallocate",
        "name": "reallocate",
        "kind": "function",
        "role": "Utility",
        "role_icon": "\u26a1",
        "role_confidence": 60.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/handlers.py",
        "start_line": 43,
        "end_line": 47,
        "params": [
          {
            "name": "event",
            "type": "events.Deallocated"
          },
          {
            "name": "uow",
            "type": "unit_of_work.AbstractUnitOfWork"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def reallocate(",
        "body_source": "def reallocate(\n    event: events.Deallocated,\n    uow: unit_of_work.AbstractUnitOfWork,\n):\n    allocate(commands.Allocate(**asdict(event)), uow=uow)",
        "complexity": 0,
        "lines_of_code": 4,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 4,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "change_batch_quantity",
        "label": "change_batch_quantity",
        "name": "change_batch_quantity",
        "kind": "function",
        "role": "Utility",
        "role_icon": "\u26a1",
        "role_confidence": 60.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/handlers.py",
        "start_line": 50,
        "end_line": 57,
        "params": [
          {
            "name": "cmd",
            "type": "commands.ChangeBatchQuantity"
          },
          {
            "name": "uow",
            "type": "unit_of_work.AbstractUnitOfWork"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def change_batch_quantity(",
        "body_source": "def change_batch_quantity(\n    cmd: commands.ChangeBatchQuantity,\n    uow: unit_of_work.AbstractUnitOfWork,\n):\n    with uow:\n        product = uow.products.get_by_batchref(batchref=cmd.ref)\n        product.change_batch_quantity(ref=cmd.ref, qty=cmd.qty)\n        uow.commit()",
        "complexity": 0,
        "lines_of_code": 7,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 7,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "send_out_of_stock_notification",
        "label": "send_out_of_stock_notification",
        "name": "send_out_of_stock_notification",
        "kind": "function",
        "role": "Command",
        "role_icon": "\ud83d\udce4",
        "role_confidence": 75.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/handlers.py",
        "start_line": 63,
        "end_line": 70,
        "params": [
          {
            "name": "event",
            "type": "events.OutOfStock"
          },
          {
            "name": "notifications",
            "type": "notifications.AbstractNotifications"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def send_out_of_stock_notification(",
        "body_source": "def send_out_of_stock_notification(\n    event: events.OutOfStock,\n    notifications: notifications.AbstractNotifications,\n):\n    notifications.send(\n        \"stock@made.com\",\n        f\"Out of stock for {event.sku}\",\n    )",
        "complexity": 0,
        "lines_of_code": 7,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 7,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "publish_allocated_event",
        "label": "publish_allocated_event",
        "name": "publish_allocated_event",
        "kind": "function",
        "role": "Command",
        "role_icon": "\ud83d\udce4",
        "role_confidence": 75.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/handlers.py",
        "start_line": 73,
        "end_line": 77,
        "params": [
          {
            "name": "event",
            "type": "events.Allocated"
          },
          {
            "name": "publish",
            "type": "Callable"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def publish_allocated_event(",
        "body_source": "def publish_allocated_event(\n    event: events.Allocated,\n    publish: Callable,\n):\n    publish(\"line_allocated\", event)",
        "complexity": 0,
        "lines_of_code": 4,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 4,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "add_allocation_to_read_model",
        "label": "add_allocation_to_read_model",
        "name": "add_allocation_to_read_model",
        "kind": "function",
        "role": "Query",
        "role_icon": "\ud83d\udce5",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/handlers.py",
        "start_line": 80,
        "end_line": 92,
        "params": [
          {
            "name": "event",
            "type": "events.Allocated"
          },
          {
            "name": "uow",
            "type": "unit_of_work.SqlAlchemyUnitOfWork"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def add_allocation_to_read_model(",
        "body_source": "def add_allocation_to_read_model(\n    event: events.Allocated,\n    uow: unit_of_work.SqlAlchemyUnitOfWork,\n):\n    with uow:\n        uow.session.execute(\n            \"\"\"\n            INSERT INTO allocations_view (orderid, sku, batchref)\n            VALUES (:orderid, :sku, :batchref)\n            \"\"\",\n            dict(orderid=event.orderid, sku=event.sku, batchref=event.batchref),\n        )\n        uow.commit()",
        "complexity": 0,
        "lines_of_code": 12,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 12,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Pure"
      },
      {
        "id": "remove_allocation_from_read_model",
        "label": "remove_allocation_from_read_model",
        "name": "remove_allocation_from_read_model",
        "kind": "function",
        "role": "Query",
        "role_icon": "\ud83d\udce5",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/handlers.py",
        "start_line": 95,
        "end_line": 107,
        "params": [
          {
            "name": "event",
            "type": "events.Deallocated"
          },
          {
            "name": "uow",
            "type": "unit_of_work.SqlAlchemyUnitOfWork"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def remove_allocation_from_read_model(",
        "body_source": "def remove_allocation_from_read_model(\n    event: events.Deallocated,\n    uow: unit_of_work.SqlAlchemyUnitOfWork,\n):\n    with uow:\n        uow.session.execute(\n            \"\"\"\n            DELETE FROM allocations_view\n            WHERE orderid = :orderid AND sku = :sku\n            \"\"\",\n            dict(orderid=event.orderid, sku=event.sku),\n        )\n        uow.commit()",
        "complexity": 0,
        "lines_of_code": 12,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 12,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Pure"
      },
      {
        "id": "MessageBus",
        "label": "MessageBus",
        "name": "MessageBus",
        "kind": "class",
        "role": "DTO",
        "role_icon": "\u26a1",
        "role_confidence": 65.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/messagebus.py",
        "start_line": 15,
        "end_line": 15,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "class MessageBus:",
        "body_source": "",
        "complexity": 0,
        "lines_of_code": 0,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateful",
        "activation": "Direct",
        "lifetime": "Singleton",
        "effect": "Pure"
      },
      {
        "id": "MessageBus.__init__",
        "label": "MessageBus.__init__",
        "name": "MessageBus.__init__",
        "kind": "method",
        "role": "ApplicationService",
        "role_icon": "\u26a1",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/messagebus.py",
        "start_line": 16,
        "end_line": 24,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "uow",
            "type": "unit_of_work.AbstractUnitOfWork"
          },
          {
            "name": "event_handlers",
            "type": "Dict[Type[events.Event], List[Callable]]"
          },
          {
            "name": "command_handlers",
            "type": "Dict[Type[commands.Command], Callable]"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def __init__(",
        "body_source": "    def __init__(\n        self,\n        uow: unit_of_work.AbstractUnitOfWork,\n        event_handlers: Dict[Type[events.Event], List[Callable]],\n        command_handlers: Dict[Type[commands.Command], Callable],\n    ):\n        self.uow = uow\n        self.event_handlers = event_handlers\n        self.command_handlers = command_handlers",
        "complexity": 0,
        "lines_of_code": 8,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 8,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "MessageBus.handle",
        "label": "MessageBus.handle",
        "name": "MessageBus.handle",
        "kind": "method",
        "role": "EventHandler",
        "role_icon": "\u26a1",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/messagebus.py",
        "start_line": 26,
        "end_line": 35,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "message",
            "type": "Message"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def handle(self, message: Message):",
        "body_source": "    def handle(self, message: Message):\n        self.queue = [message]\n        while self.queue:\n            message = self.queue.pop(0)\n            if isinstance(message, events.Event):\n                self.handle_event(message)\n            elif isinstance(message, commands.Command):\n                self.handle_command(message)\n            else:\n                raise Exception(f\"{message} was not an Event or Command\")",
        "complexity": 0,
        "lines_of_code": 9,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 9,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "MessageBus.handle_event",
        "label": "MessageBus.handle_event",
        "name": "MessageBus.handle_event",
        "kind": "method",
        "role": "EventHandler",
        "role_icon": "\u26a1",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/messagebus.py",
        "start_line": 37,
        "end_line": 45,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "event",
            "type": "events.Event"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def handle_event(self, event: events.Event):",
        "body_source": "    def handle_event(self, event: events.Event):\n        for handler in self.event_handlers[type(event)]:\n            try:\n                logger.debug(\"handling event %s with handler %s\", event, handler)\n                handler(event)\n                self.queue.extend(self.uow.collect_new_events())\n            except Exception:\n                logger.exception(\"Exception handling event %s\", event)\n                continue",
        "complexity": 0,
        "lines_of_code": 8,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 8,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "MessageBus.handle_command",
        "label": "MessageBus.handle_command",
        "name": "MessageBus.handle_command",
        "kind": "method",
        "role": "EventHandler",
        "role_icon": "\u26a1",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/messagebus.py",
        "start_line": 47,
        "end_line": 55,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "command",
            "type": "commands.Command"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def handle_command(self, command: commands.Command):",
        "body_source": "    def handle_command(self, command: commands.Command):\n        logger.debug(\"handling command %s\", command)\n        try:\n            handler = self.command_handlers[type(command)]\n            handler(command)\n            self.queue.extend(self.uow.collect_new_events())\n        except Exception:\n            logger.exception(\"Exception handling command %s\", command)\n            raise",
        "complexity": 0,
        "lines_of_code": 8,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 8,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "AbstractUnitOfWork",
        "label": "AbstractUnitOfWork",
        "name": "AbstractUnitOfWork",
        "kind": "class",
        "role": "DTO",
        "role_icon": "\u26a1",
        "role_confidence": 65.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py",
        "start_line": 13,
        "end_line": 13,
        "params": [],
        "return_type": "",
        "base_classes": [
          "ABC"
        ],
        "decorators": [],
        "docstring": "",
        "signature": "class AbstractUnitOfWork(abc.ABC):",
        "body_source": "",
        "complexity": 0,
        "lines_of_code": 0,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateful",
        "activation": "Direct",
        "lifetime": "Singleton",
        "effect": "Pure"
      },
      {
        "id": "AbstractUnitOfWork.__enter__",
        "label": "AbstractUnitOfWork.__enter__",
        "name": "AbstractUnitOfWork.__enter__",
        "kind": "method",
        "role": "Lifecycle",
        "role_icon": "\u26a1",
        "role_confidence": 95.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py",
        "start_line": 16,
        "end_line": 17,
        "params": [
          {
            "name": "self"
          }
        ],
        "return_type": "AbstractUnitOfWork",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def __enter__(self) -> AbstractUnitOfWork:",
        "body_source": "    def __enter__(self) -> AbstractUnitOfWork:\n        return self",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "AbstractUnitOfWork.__exit__",
        "label": "AbstractUnitOfWork.__exit__",
        "name": "AbstractUnitOfWork.__exit__",
        "kind": "method",
        "role": "Lifecycle",
        "role_icon": "\u26a1",
        "role_confidence": 95.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py",
        "start_line": 19,
        "end_line": 20,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "*args"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def __exit__(self, *args):",
        "body_source": "    def __exit__(self, *args):\n        self.rollback()",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "AbstractUnitOfWork.commit",
        "label": "AbstractUnitOfWork.commit",
        "name": "AbstractUnitOfWork.commit",
        "kind": "method",
        "role": "Command",
        "role_icon": "\ud83d\udce4",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py",
        "start_line": 22,
        "end_line": 23,
        "params": [
          {
            "name": "self"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def commit(self):",
        "body_source": "    def commit(self):\n        self._commit()",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "AbstractUnitOfWork.collect_new_events",
        "label": "AbstractUnitOfWork.collect_new_events",
        "name": "AbstractUnitOfWork.collect_new_events",
        "kind": "method",
        "role": "Service",
        "role_icon": "\u2699\ufe0f",
        "role_confidence": 70.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py",
        "start_line": 25,
        "end_line": 28,
        "params": [
          {
            "name": "self"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def collect_new_events(self):",
        "body_source": "    def collect_new_events(self):\n        for product in self.products.seen:\n            while product.events:\n                yield product.events.pop(0)",
        "complexity": 0,
        "lines_of_code": 3,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 3,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "AbstractUnitOfWork._commit",
        "label": "AbstractUnitOfWork._commit",
        "name": "AbstractUnitOfWork._commit",
        "kind": "method",
        "role": "Command",
        "role_icon": "\ud83d\udce4",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py",
        "start_line": 31,
        "end_line": 32,
        "params": [
          {
            "name": "self"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [
          "abc.abstractmethod"
        ],
        "docstring": "",
        "signature": "def _commit(self):",
        "body_source": "    def _commit(self):\n        raise NotImplementedError",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "AbstractUnitOfWork.rollback",
        "label": "AbstractUnitOfWork.rollback",
        "name": "AbstractUnitOfWork.rollback",
        "kind": "method",
        "role": "Utility",
        "role_icon": "\u26a1",
        "role_confidence": 60.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py",
        "start_line": 35,
        "end_line": 36,
        "params": [
          {
            "name": "self"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [
          "abc.abstractmethod"
        ],
        "docstring": "",
        "signature": "def rollback(self):",
        "body_source": "    def rollback(self):\n        raise NotImplementedError",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "SqlAlchemyUnitOfWork",
        "label": "SqlAlchemyUnitOfWork",
        "name": "SqlAlchemyUnitOfWork",
        "kind": "class",
        "role": "Repository",
        "role_icon": "\ud83d\udcbe",
        "role_confidence": 75.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py",
        "start_line": 47,
        "end_line": 47,
        "params": [],
        "return_type": "",
        "base_classes": [
          "AbstractUnitOfWork"
        ],
        "decorators": [],
        "docstring": "",
        "signature": "class SqlAlchemyUnitOfWork(AbstractUnitOfWork):",
        "body_source": "",
        "complexity": 0,
        "lines_of_code": 0,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateful",
        "activation": "Direct",
        "lifetime": "Singleton",
        "effect": "Side-Effect"
      },
      {
        "id": "SqlAlchemyUnitOfWork.__init__",
        "label": "SqlAlchemyUnitOfWork.__init__",
        "name": "SqlAlchemyUnitOfWork.__init__",
        "kind": "method",
        "role": "ApplicationService",
        "role_icon": "\u26a1",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py",
        "start_line": 48,
        "end_line": 49,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "session_factory",
            "default": "DEFAULT_SESSION_FACTORY"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def __init__(self, session_factory=DEFAULT_SESSION_FACTORY):",
        "body_source": "    def __init__(self, session_factory=DEFAULT_SESSION_FACTORY):\n        self.session_factory = session_factory",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "SqlAlchemyUnitOfWork.__enter__",
        "label": "SqlAlchemyUnitOfWork.__enter__",
        "name": "SqlAlchemyUnitOfWork.__enter__",
        "kind": "method",
        "role": "Lifecycle",
        "role_icon": "\u26a1",
        "role_confidence": 95.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py",
        "start_line": 51,
        "end_line": 54,
        "params": [
          {
            "name": "self"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def __enter__(self):",
        "body_source": "    def __enter__(self):\n        self.session = self.session_factory()  # type: Session\n        self.products = repository.SqlAlchemyRepository(self.session)\n        return super().__enter__()",
        "complexity": 0,
        "lines_of_code": 3,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 3,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "SqlAlchemyUnitOfWork.__exit__",
        "label": "SqlAlchemyUnitOfWork.__exit__",
        "name": "SqlAlchemyUnitOfWork.__exit__",
        "kind": "method",
        "role": "Lifecycle",
        "role_icon": "\u26a1",
        "role_confidence": 95.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py",
        "start_line": 56,
        "end_line": 58,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "*args"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def __exit__(self, *args):",
        "body_source": "    def __exit__(self, *args):\n        super().__exit__(*args)\n        self.session.close()",
        "complexity": 0,
        "lines_of_code": 2,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 2,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "SqlAlchemyUnitOfWork._commit",
        "label": "SqlAlchemyUnitOfWork._commit",
        "name": "SqlAlchemyUnitOfWork._commit",
        "kind": "method",
        "role": "Command",
        "role_icon": "\ud83d\udce4",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py",
        "start_line": 60,
        "end_line": 61,
        "params": [
          {
            "name": "self"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def _commit(self):",
        "body_source": "    def _commit(self):\n        self.session.commit()",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "SqlAlchemyUnitOfWork.rollback",
        "label": "SqlAlchemyUnitOfWork.rollback",
        "name": "SqlAlchemyUnitOfWork.rollback",
        "kind": "method",
        "role": "Utility",
        "role_icon": "\u26a1",
        "role_confidence": 60.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/service_layer/unit_of_work.py",
        "start_line": 63,
        "end_line": 64,
        "params": [
          {
            "name": "self"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def rollback(self):",
        "body_source": "    def rollback(self):\n        self.session.rollback()",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "main",
        "label": "main",
        "name": "main",
        "kind": "function",
        "role": "Controller",
        "role_icon": "\ud83c\udfae",
        "role_confidence": 75.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/entrypoints/redis_eventconsumer.py",
        "start_line": 13,
        "end_line": 20,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def main():",
        "body_source": "def main():\n    logger.info(\"Redis pubsub starting\")\n    bus = bootstrap.bootstrap()\n    pubsub = r.pubsub(ignore_subscribe_messages=True)\n    pubsub.subscribe(\"change_batch_quantity\")\n\n    for m in pubsub.listen():\n        handle_change_batch_quantity(m, bus)",
        "complexity": 0,
        "lines_of_code": 7,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 7,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "handle_change_batch_quantity",
        "label": "handle_change_batch_quantity",
        "name": "handle_change_batch_quantity",
        "kind": "function",
        "role": "EventHandler",
        "role_icon": "\u26a1",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/entrypoints/redis_eventconsumer.py",
        "start_line": 23,
        "end_line": 27,
        "params": [
          {
            "name": "m"
          },
          {
            "name": "bus"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def handle_change_batch_quantity(m, bus):",
        "body_source": "def handle_change_batch_quantity(m, bus):\n    logger.info(\"handling %s\", m)\n    data = json.loads(m[\"data\"])\n    cmd = commands.ChangeBatchQuantity(ref=data[\"batchref\"], qty=data[\"qty\"])\n    bus.handle(cmd)",
        "complexity": 0,
        "lines_of_code": 4,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 4,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "allocate_endpoint",
        "label": "allocate_endpoint",
        "name": "allocate_endpoint",
        "kind": "function",
        "role": "Controller",
        "role_icon": "\ud83c\udfae",
        "role_confidence": 75.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/entrypoints/flask_app.py",
        "start_line": 24,
        "end_line": 33,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [
          "app.route"
        ],
        "docstring": "",
        "signature": "def allocate_endpoint():",
        "body_source": "def allocate_endpoint():\n    try:\n        cmd = commands.Allocate(\n            request.json[\"orderid\"], request.json[\"sku\"], request.json[\"qty\"]\n        )\n        bus.handle(cmd)\n    except InvalidSku as e:\n        return {\"message\": str(e)}, 400\n\n    return \"OK\", 202",
        "complexity": 0,
        "lines_of_code": 9,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 9,
        "is_hotspot": false,
        "boundary": "External",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "allocations_view_endpoint",
        "label": "allocations_view_endpoint",
        "name": "allocations_view_endpoint",
        "kind": "function",
        "role": "Controller",
        "role_icon": "\ud83c\udfae",
        "role_confidence": 75.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/entrypoints/flask_app.py",
        "start_line": 37,
        "end_line": 41,
        "params": [
          {
            "name": "orderid"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [
          "app.route"
        ],
        "docstring": "",
        "signature": "def allocations_view_endpoint(orderid):",
        "body_source": "def allocations_view_endpoint(orderid):\n    result = views.allocations(orderid, bus.uow)\n    if not result:\n        return \"not found\", 404\n    return jsonify(result), 200",
        "complexity": 0,
        "lines_of_code": 4,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 4,
        "is_hotspot": false,
        "boundary": "External",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "Event",
        "label": "Event",
        "name": "Event",
        "kind": "class",
        "role": "DomainEvent",
        "role_icon": "\u26a1",
        "role_confidence": 75.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/events.py",
        "start_line": 5,
        "end_line": 5,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "class Event:",
        "body_source": "",
        "complexity": 0,
        "lines_of_code": 0,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateful",
        "activation": "Direct",
        "lifetime": "Singleton",
        "effect": "Side-Effect"
      },
      {
        "id": "Allocated",
        "label": "Allocated",
        "name": "Allocated",
        "kind": "class",
        "role": "DomainEvent",
        "role_icon": "\u26a1",
        "role_confidence": 99.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/events.py",
        "start_line": 10,
        "end_line": 10,
        "params": [],
        "return_type": "",
        "base_classes": [
          "Event"
        ],
        "decorators": [
          "dataclass"
        ],
        "docstring": "",
        "signature": "class Allocated(Event):",
        "body_source": "",
        "complexity": 0,
        "lines_of_code": 0,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateful",
        "activation": "Direct",
        "lifetime": "Singleton",
        "effect": "Side-Effect"
      },
      {
        "id": "Deallocated",
        "label": "Deallocated",
        "name": "Deallocated",
        "kind": "class",
        "role": "DomainEvent",
        "role_icon": "\u26a1",
        "role_confidence": 99.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/events.py",
        "start_line": 18,
        "end_line": 18,
        "params": [],
        "return_type": "",
        "base_classes": [
          "Event"
        ],
        "decorators": [
          "dataclass"
        ],
        "docstring": "",
        "signature": "class Deallocated(Event):",
        "body_source": "",
        "complexity": 0,
        "lines_of_code": 0,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateful",
        "activation": "Direct",
        "lifetime": "Singleton",
        "effect": "Side-Effect"
      },
      {
        "id": "OutOfStock",
        "label": "OutOfStock",
        "name": "OutOfStock",
        "kind": "class",
        "role": "DomainEvent",
        "role_icon": "\u26a1",
        "role_confidence": 99.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/events.py",
        "start_line": 25,
        "end_line": 25,
        "params": [],
        "return_type": "",
        "base_classes": [
          "Event"
        ],
        "decorators": [
          "dataclass"
        ],
        "docstring": "",
        "signature": "class OutOfStock(Event):",
        "body_source": "",
        "complexity": 0,
        "lines_of_code": 0,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateful",
        "activation": "Direct",
        "lifetime": "Singleton",
        "effect": "Side-Effect"
      },
      {
        "id": "Product",
        "label": "Product",
        "name": "Product",
        "kind": "class",
        "role": "DTO",
        "role_icon": "\u26a1",
        "role_confidence": 65.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
        "start_line": 8,
        "end_line": 8,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "class Product:",
        "body_source": "",
        "complexity": 0,
        "lines_of_code": 0,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateful",
        "activation": "Direct",
        "lifetime": "Singleton",
        "effect": "Pure"
      },
      {
        "id": "Product.__init__",
        "label": "Product.__init__",
        "name": "Product.__init__",
        "kind": "method",
        "role": "ApplicationService",
        "role_icon": "\u26a1",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
        "start_line": 9,
        "end_line": 13,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "sku",
            "type": "str"
          },
          {
            "name": "batches",
            "type": "List[Batch]"
          },
          {
            "name": "version_number",
            "type": "int",
            "default": "0"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def __init__(self, sku: str, batches: List[Batch], version_number: int = 0):",
        "body_source": "    def __init__(self, sku: str, batches: List[Batch], version_number: int = 0):\n        self.sku = sku\n        self.batches = batches\n        self.version_number = version_number\n        self.events = []  # type: List[events.Event]",
        "complexity": 0,
        "lines_of_code": 4,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 4,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "Product.allocate",
        "label": "Product.allocate",
        "name": "Product.allocate",
        "kind": "method",
        "role": "Utility",
        "role_icon": "\u26a1",
        "role_confidence": 60.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
        "start_line": 15,
        "end_line": 31,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "line",
            "type": "OrderLine"
          }
        ],
        "return_type": "str",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def allocate(self, line: OrderLine) -> str:",
        "body_source": "    def allocate(self, line: OrderLine) -> str:\n        try:\n            batch = next(b for b in sorted(self.batches) if b.can_allocate(line))\n            batch.allocate(line)\n            self.version_number += 1\n            self.events.append(\n                events.Allocated(\n                    orderid=line.orderid,\n                    sku=line.sku,\n                    qty=line.qty,\n                    batchref=batch.reference,\n                )\n            )\n            return batch.reference\n        except StopIteration:\n            self.events.append(events.OutOfStock(line.sku))\n            return None",
        "complexity": 0,
        "lines_of_code": 16,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 16,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "Product.change_batch_quantity",
        "label": "Product.change_batch_quantity",
        "name": "Product.change_batch_quantity",
        "kind": "method",
        "role": "Utility",
        "role_icon": "\u26a1",
        "role_confidence": 60.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
        "start_line": 33,
        "end_line": 38,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "ref",
            "type": "str"
          },
          {
            "name": "qty",
            "type": "int"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def change_batch_quantity(self, ref: str, qty: int):",
        "body_source": "    def change_batch_quantity(self, ref: str, qty: int):\n        batch = next(b for b in self.batches if b.reference == ref)\n        batch._purchased_quantity = qty\n        while batch.available_quantity < 0:\n            line = batch.deallocate_one()\n            self.events.append(events.Deallocated(line.orderid, line.sku, line.qty))",
        "complexity": 0,
        "lines_of_code": 5,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 5,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "OrderLine",
        "label": "OrderLine",
        "name": "OrderLine",
        "kind": "class",
        "role": "Query",
        "role_icon": "\ud83d\udce5",
        "role_confidence": 75.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
        "start_line": 42,
        "end_line": 42,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [
          "dataclass"
        ],
        "docstring": "",
        "signature": "class OrderLine:",
        "body_source": "",
        "complexity": 0,
        "lines_of_code": 0,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateful",
        "activation": "Direct",
        "lifetime": "Singleton",
        "effect": "Pure"
      },
      {
        "id": "Batch",
        "label": "Batch",
        "name": "Batch",
        "kind": "class",
        "role": "DTO",
        "role_icon": "\u26a1",
        "role_confidence": 65.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
        "start_line": 48,
        "end_line": 48,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "class Batch:",
        "body_source": "",
        "complexity": 0,
        "lines_of_code": 0,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateful",
        "activation": "Direct",
        "lifetime": "Singleton",
        "effect": "Pure"
      },
      {
        "id": "Batch.__init__",
        "label": "Batch.__init__",
        "name": "Batch.__init__",
        "kind": "method",
        "role": "ApplicationService",
        "role_icon": "\u26a1",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
        "start_line": 49,
        "end_line": 54,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "ref",
            "type": "str"
          },
          {
            "name": "sku",
            "type": "str"
          },
          {
            "name": "qty",
            "type": "int"
          },
          {
            "name": "eta",
            "type": "Optional[date]"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def __init__(self, ref: str, sku: str, qty: int, eta: Optional[date]):",
        "body_source": "    def __init__(self, ref: str, sku: str, qty: int, eta: Optional[date]):\n        self.reference = ref\n        self.sku = sku\n        self.eta = eta\n        self._purchased_quantity = qty\n        self._allocations = set()  # type: Set[OrderLine]",
        "complexity": 0,
        "lines_of_code": 5,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 5,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "Batch.__repr__",
        "label": "Batch.__repr__",
        "name": "Batch.__repr__",
        "kind": "method",
        "role": "Utility",
        "role_icon": "\u26a1",
        "role_confidence": 95.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
        "start_line": 56,
        "end_line": 57,
        "params": [
          {
            "name": "self"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def __repr__(self):",
        "body_source": "    def __repr__(self):\n        return f\"<Batch {self.reference}>\"",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "Batch.__eq__",
        "label": "Batch.__eq__",
        "name": "Batch.__eq__",
        "kind": "method",
        "role": "Specification",
        "role_icon": "\u26a1",
        "role_confidence": 95.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
        "start_line": 59,
        "end_line": 62,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "other"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def __eq__(self, other):",
        "body_source": "    def __eq__(self, other):\n        if not isinstance(other, Batch):\n            return False\n        return other.reference == self.reference",
        "complexity": 0,
        "lines_of_code": 3,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 3,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "Batch.__hash__",
        "label": "Batch.__hash__",
        "name": "Batch.__hash__",
        "kind": "method",
        "role": "Utility",
        "role_icon": "\u26a1",
        "role_confidence": 95.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
        "start_line": 64,
        "end_line": 65,
        "params": [
          {
            "name": "self"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def __hash__(self):",
        "body_source": "    def __hash__(self):\n        return hash(self.reference)",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "Batch.__gt__",
        "label": "Batch.__gt__",
        "name": "Batch.__gt__",
        "kind": "method",
        "role": "Specification",
        "role_icon": "\u26a1",
        "role_confidence": 95.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
        "start_line": 67,
        "end_line": 72,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "other"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def __gt__(self, other):",
        "body_source": "    def __gt__(self, other):\n        if self.eta is None:\n            return False\n        if other.eta is None:\n            return True\n        return self.eta > other.eta",
        "complexity": 0,
        "lines_of_code": 5,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 5,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "Batch.allocate",
        "label": "Batch.allocate",
        "name": "Batch.allocate",
        "kind": "method",
        "role": "Utility",
        "role_icon": "\u26a1",
        "role_confidence": 60.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
        "start_line": 74,
        "end_line": 76,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "line",
            "type": "OrderLine"
          }
        ],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def allocate(self, line: OrderLine):",
        "body_source": "    def allocate(self, line: OrderLine):\n        if self.can_allocate(line):\n            self._allocations.add(line)",
        "complexity": 0,
        "lines_of_code": 2,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 2,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "Batch.deallocate_one",
        "label": "Batch.deallocate_one",
        "name": "Batch.deallocate_one",
        "kind": "method",
        "role": "Utility",
        "role_icon": "\u26a1",
        "role_confidence": 60.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
        "start_line": 78,
        "end_line": 79,
        "params": [
          {
            "name": "self"
          }
        ],
        "return_type": "OrderLine",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def deallocate_one(self) -> OrderLine:",
        "body_source": "    def deallocate_one(self) -> OrderLine:\n        return self._allocations.pop()",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "Batch.allocated_quantity",
        "label": "Batch.allocated_quantity",
        "name": "Batch.allocated_quantity",
        "kind": "method",
        "role": "Utility",
        "role_icon": "\u26a1",
        "role_confidence": 60.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
        "start_line": 82,
        "end_line": 83,
        "params": [
          {
            "name": "self"
          }
        ],
        "return_type": "int",
        "base_classes": [],
        "decorators": [
          "property"
        ],
        "docstring": "",
        "signature": "def allocated_quantity(self) -> int:",
        "body_source": "    def allocated_quantity(self) -> int:\n        return sum(line.qty for line in self._allocations)",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "Batch.available_quantity",
        "label": "Batch.available_quantity",
        "name": "Batch.available_quantity",
        "kind": "method",
        "role": "Utility",
        "role_icon": "\u26a1",
        "role_confidence": 60.0,
        "discovery_method": "auto_pattern",
        "discovery_icon": "\ud83d\udd0d",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
        "start_line": 86,
        "end_line": 87,
        "params": [
          {
            "name": "self"
          }
        ],
        "return_type": "int",
        "base_classes": [],
        "decorators": [
          "property"
        ],
        "docstring": "",
        "signature": "def available_quantity(self) -> int:",
        "body_source": "    def available_quantity(self) -> int:\n        return self._purchased_quantity - self.allocated_quantity",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "Batch.can_allocate",
        "label": "Batch.can_allocate",
        "name": "Batch.can_allocate",
        "kind": "method",
        "role": "Specification",
        "role_icon": "\u26a1",
        "role_confidence": 70.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/model.py",
        "start_line": 89,
        "end_line": 90,
        "params": [
          {
            "name": "self"
          },
          {
            "name": "line",
            "type": "OrderLine"
          }
        ],
        "return_type": "bool",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "def can_allocate(self, line: OrderLine) -> bool:",
        "body_source": "    def can_allocate(self, line: OrderLine) -> bool:\n        return self.sku == line.sku and self.available_quantity >= line.qty",
        "complexity": 0,
        "lines_of_code": 1,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateless",
        "activation": "Direct",
        "lifetime": "Transient",
        "effect": "Side-Effect"
      },
      {
        "id": "Command",
        "label": "Command",
        "name": "Command",
        "kind": "class",
        "role": "Command",
        "role_icon": "\ud83d\udce4",
        "role_confidence": 75.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/commands.py",
        "start_line": 7,
        "end_line": 7,
        "params": [],
        "return_type": "",
        "base_classes": [],
        "decorators": [],
        "docstring": "",
        "signature": "class Command:",
        "body_source": "",
        "complexity": 0,
        "lines_of_code": 0,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateful",
        "activation": "Direct",
        "lifetime": "Singleton",
        "effect": "Side-Effect"
      },
      {
        "id": "Allocate",
        "label": "Allocate",
        "name": "Allocate",
        "kind": "class",
        "role": "Command",
        "role_icon": "\ud83d\udce4",
        "role_confidence": 99.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/commands.py",
        "start_line": 12,
        "end_line": 12,
        "params": [],
        "return_type": "",
        "base_classes": [
          "Command"
        ],
        "decorators": [
          "dataclass"
        ],
        "docstring": "",
        "signature": "class Allocate(Command):",
        "body_source": "",
        "complexity": 0,
        "lines_of_code": 0,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateful",
        "activation": "Direct",
        "lifetime": "Singleton",
        "effect": "Side-Effect"
      },
      {
        "id": "CreateBatch",
        "label": "CreateBatch",
        "name": "CreateBatch",
        "kind": "class",
        "role": "Command",
        "role_icon": "\ud83d\udce4",
        "role_confidence": 99.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/commands.py",
        "start_line": 19,
        "end_line": 19,
        "params": [],
        "return_type": "",
        "base_classes": [
          "Command"
        ],
        "decorators": [
          "dataclass"
        ],
        "docstring": "",
        "signature": "class CreateBatch(Command):",
        "body_source": "",
        "complexity": 0,
        "lines_of_code": 0,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateful",
        "activation": "Direct",
        "lifetime": "Singleton",
        "effect": "Side-Effect"
      },
      {
        "id": "ChangeBatchQuantity",
        "label": "ChangeBatchQuantity",
        "name": "ChangeBatchQuantity",
        "kind": "class",
        "role": "Command",
        "role_icon": "\ud83d\udce4",
        "role_confidence": 99.0,
        "discovery_method": "pattern",
        "discovery_icon": "\ud83c\udfaf",
        "layer": "unknown",
        "layer_icon": "\u2753",
        "layer_color": "#6b7280",
        "file_path": "/Users/lech/PROJECTS_all/PROJECT_elements/standard-model-of-code/validation/benchmarks/repos/cosmicpython__code/src/allocation/domain/commands.py",
        "start_line": 27,
        "end_line": 27,
        "params": [],
        "return_type": "",
        "base_classes": [
          "Command"
        ],
        "decorators": [
          "dataclass"
        ],
        "docstring": "",
        "signature": "class ChangeBatchQuantity(Command):",
        "body_source": "",
        "complexity": 0,
        "lines_of_code": 0,
        "in_degree": 0,
        "out_degree": 0,
        "is_entry_point": true,
        "is_orphan": false,
        "time_type": "\u03c4_compute",
        "estimated_cost": 1,
        "is_hotspot": false,
        "boundary": "Internal",
        "state": "Stateful",
        "activation": "Direct",
        "lifetime": "Singleton",
        "effect": "Side-Effect"
      }
    ];
    const connections = [
      {
        "from": "FakeRepository",
        "to": "FakeRepository.__init__",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 15,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "FakeRepository",
        "to": "FakeRepository._add",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 19,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "FakeRepository",
        "to": "FakeRepository._get",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 22,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "FakeRepository",
        "to": "FakeRepository._get_by_batchref",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 25,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "FakeUnitOfWork",
        "to": "FakeUnitOfWork.__init__",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 33,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "FakeUnitOfWork",
        "to": "FakeUnitOfWork._commit",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 37,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "FakeUnitOfWork",
        "to": "FakeUnitOfWork.rollback",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 40,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "FakeNotifications",
        "to": "FakeNotifications.__init__",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 45,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "FakeNotifications",
        "to": "FakeNotifications.send",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 48,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "TestAddBatch",
        "to": "TestAddBatch.test_for_new_product",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 62,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "TestAddBatch",
        "to": "TestAddBatch.test_for_existing_product",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 68,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "TestAllocate",
        "to": "TestAllocate.test_allocates",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 78,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "TestAllocate",
        "to": "TestAllocate.test_errors_for_invalid_sku",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 85,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "TestAllocate",
        "to": "TestAllocate.test_commits",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 92,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "TestAllocate",
        "to": "TestAllocate.test_sends_email_on_out_of_stock_error",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 98,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "TestChangeBatchQuantity",
        "to": "TestChangeBatchQuantity.test_changes_available_quantity",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 114,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "TestChangeBatchQuantity",
        "to": "TestChangeBatchQuantity.test_reallocates_if_necessary",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 123,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "test_rolls_back_on_error",
        "to": "MyException",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 67,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "AbstractNotifications",
        "to": "AbstractNotifications.send",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 9,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "EmailNotifications",
        "to": "EmailNotifications.__init__",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 18,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "EmailNotifications",
        "to": "EmailNotifications.send",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 22,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "AbstractRepository",
        "to": "AbstractRepository.__init__",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 8,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "AbstractRepository",
        "to": "AbstractRepository.add",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 11,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "AbstractRepository",
        "to": "AbstractRepository.get",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 15,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "AbstractRepository",
        "to": "AbstractRepository.get_by_batchref",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 21,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "AbstractRepository",
        "to": "AbstractRepository._add",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 28,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "AbstractRepository",
        "to": "AbstractRepository._get",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 32,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "AbstractRepository",
        "to": "AbstractRepository._get_by_batchref",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 36,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "SqlAlchemyRepository",
        "to": "SqlAlchemyRepository.__init__",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 41,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "SqlAlchemyRepository",
        "to": "SqlAlchemyRepository._add",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 45,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "SqlAlchemyRepository",
        "to": "SqlAlchemyRepository._get",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 48,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "SqlAlchemyRepository",
        "to": "SqlAlchemyRepository._get_by_batchref",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 51,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "MessageBus",
        "to": "MessageBus.__init__",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 16,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "MessageBus",
        "to": "MessageBus.handle",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 26,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "MessageBus",
        "to": "MessageBus.handle_event",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 37,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "MessageBus",
        "to": "MessageBus.handle_command",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 47,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "AbstractUnitOfWork",
        "to": "AbstractUnitOfWork.__enter__",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 16,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "AbstractUnitOfWork",
        "to": "AbstractUnitOfWork.__exit__",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 19,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "AbstractUnitOfWork",
        "to": "AbstractUnitOfWork.commit",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 22,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "AbstractUnitOfWork",
        "to": "AbstractUnitOfWork.collect_new_events",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 25,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "AbstractUnitOfWork",
        "to": "AbstractUnitOfWork._commit",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 31,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "AbstractUnitOfWork",
        "to": "AbstractUnitOfWork.rollback",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 35,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "SqlAlchemyUnitOfWork",
        "to": "SqlAlchemyUnitOfWork.__init__",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 48,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "SqlAlchemyUnitOfWork",
        "to": "SqlAlchemyUnitOfWork.__enter__",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 51,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "SqlAlchemyUnitOfWork",
        "to": "SqlAlchemyUnitOfWork.__exit__",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 56,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "SqlAlchemyUnitOfWork",
        "to": "SqlAlchemyUnitOfWork._commit",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 60,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "SqlAlchemyUnitOfWork",
        "to": "SqlAlchemyUnitOfWork.rollback",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 63,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "Product",
        "to": "Product.__init__",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 9,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "Product",
        "to": "Product.allocate",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 15,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "Product",
        "to": "Product.change_batch_quantity",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 33,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "Batch",
        "to": "Batch.__init__",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 49,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "Batch",
        "to": "Batch.__repr__",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 56,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "Batch",
        "to": "Batch.__eq__",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 59,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "Batch",
        "to": "Batch.__hash__",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 64,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "Batch",
        "to": "Batch.__gt__",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 67,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "Batch",
        "to": "Batch.allocate",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 74,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "Batch",
        "to": "Batch.deallocate_one",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 78,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "Batch",
        "to": "Batch.allocated_quantity",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 82,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "Batch",
        "to": "Batch.available_quantity",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 86,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "Batch",
        "to": "Batch.can_allocate",
        "type": "CONTAINS",
        "weight": 1.0,
        "confidence": 1.0,
        "file_path": "",
        "line": 89,
        "color": "#666666",
        "dashes": false,
        "arrows": false,
        "metadata": {}
      },
      {
        "from": "mappers",
        "to": "start_mappers",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 33,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "wait_for_webapp_to_come_up",
        "to": "get",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 45,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "wait_for_webapp_to_come_up",
        "to": "get_api_url",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 45,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "wait_for_redis_to_come_up",
        "to": "get_redis_host_and_port",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 50,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "postgres_db",
        "to": "get_postgres_uri",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 56,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "postgres_db",
        "to": "wait_for_postgres_to_come_up",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 56,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "postgres_session",
        "to": "postgres_session_factory",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 69,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "restart_api",
        "to": "wait_for_webapp_to_come_up",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 74,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "restart_redis_pubsub",
        "to": "wait_for_redis_to_come_up",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 81,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "random_sku",
        "to": "random_suffix",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 8,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "random_batchref",
        "to": "random_suffix",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 12,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "random_orderid",
        "to": "random_suffix",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 16,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "FakeRepository._add",
        "to": "add",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 19,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "FakeUnitOfWork.__init__",
        "to": "FakeRepository",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 33,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "bootstrap_test_app",
        "to": "bootstrap",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 52,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "bootstrap_test_app",
        "to": "FakeUnitOfWork",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 52,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "bootstrap_test_app",
        "to": "FakeNotifications",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 52,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAddBatch.test_for_new_product",
        "to": "bootstrap_test_app",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 62,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAddBatch.test_for_new_product",
        "to": "handle",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 62,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAddBatch.test_for_new_product",
        "to": "CreateBatch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 62,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAddBatch.test_for_new_product",
        "to": "get",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 62,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAddBatch.test_for_existing_product",
        "to": "bootstrap_test_app",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 68,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAddBatch.test_for_existing_product",
        "to": "handle",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 68,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAddBatch.test_for_existing_product",
        "to": "CreateBatch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 68,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAddBatch.test_for_existing_product",
        "to": "handle",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 68,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAddBatch.test_for_existing_product",
        "to": "CreateBatch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 68,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAddBatch.test_for_existing_product",
        "to": "get",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 68,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAllocate.test_allocates",
        "to": "bootstrap_test_app",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 78,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAllocate.test_allocates",
        "to": "handle",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 78,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAllocate.test_allocates",
        "to": "CreateBatch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 78,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAllocate.test_allocates",
        "to": "handle",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 78,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAllocate.test_allocates",
        "to": "Allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 78,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAllocate.test_allocates",
        "to": "get",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 78,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAllocate.test_errors_for_invalid_sku",
        "to": "bootstrap_test_app",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 85,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAllocate.test_errors_for_invalid_sku",
        "to": "handle",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 85,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAllocate.test_errors_for_invalid_sku",
        "to": "CreateBatch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 85,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAllocate.test_errors_for_invalid_sku",
        "to": "handle",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 85,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAllocate.test_errors_for_invalid_sku",
        "to": "Allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 85,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAllocate.test_commits",
        "to": "bootstrap_test_app",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 92,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAllocate.test_commits",
        "to": "handle",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 92,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAllocate.test_commits",
        "to": "CreateBatch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 92,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAllocate.test_commits",
        "to": "handle",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 92,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAllocate.test_commits",
        "to": "Allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 92,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAllocate.test_sends_email_on_out_of_stock_error",
        "to": "FakeNotifications",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 98,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAllocate.test_sends_email_on_out_of_stock_error",
        "to": "bootstrap",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 98,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAllocate.test_sends_email_on_out_of_stock_error",
        "to": "FakeUnitOfWork",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 98,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAllocate.test_sends_email_on_out_of_stock_error",
        "to": "handle",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 98,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAllocate.test_sends_email_on_out_of_stock_error",
        "to": "CreateBatch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 98,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAllocate.test_sends_email_on_out_of_stock_error",
        "to": "handle",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 98,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestAllocate.test_sends_email_on_out_of_stock_error",
        "to": "Allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 98,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestChangeBatchQuantity.test_changes_available_quantity",
        "to": "bootstrap_test_app",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 114,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestChangeBatchQuantity.test_changes_available_quantity",
        "to": "handle",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 114,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestChangeBatchQuantity.test_changes_available_quantity",
        "to": "CreateBatch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 114,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestChangeBatchQuantity.test_changes_available_quantity",
        "to": "get",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 114,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestChangeBatchQuantity.test_changes_available_quantity",
        "to": "handle",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 114,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestChangeBatchQuantity.test_changes_available_quantity",
        "to": "ChangeBatchQuantity",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 114,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestChangeBatchQuantity.test_reallocates_if_necessary",
        "to": "bootstrap_test_app",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 123,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestChangeBatchQuantity.test_reallocates_if_necessary",
        "to": "CreateBatch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 123,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestChangeBatchQuantity.test_reallocates_if_necessary",
        "to": "CreateBatch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 123,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestChangeBatchQuantity.test_reallocates_if_necessary",
        "to": "Allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 123,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestChangeBatchQuantity.test_reallocates_if_necessary",
        "to": "Allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 123,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestChangeBatchQuantity.test_reallocates_if_necessary",
        "to": "handle",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 123,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestChangeBatchQuantity.test_reallocates_if_necessary",
        "to": "get",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 123,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestChangeBatchQuantity.test_reallocates_if_necessary",
        "to": "handle",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 123,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "TestChangeBatchQuantity.test_reallocates_if_necessary",
        "to": "ChangeBatchQuantity",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 123,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_prefers_warehouse_batches_to_shipments",
        "to": "Batch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 11,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_prefers_warehouse_batches_to_shipments",
        "to": "Batch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 11,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_prefers_warehouse_batches_to_shipments",
        "to": "Product",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 11,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_prefers_warehouse_batches_to_shipments",
        "to": "OrderLine",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 11,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_prefers_warehouse_batches_to_shipments",
        "to": "allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 11,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_prefers_earlier_batches",
        "to": "Batch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 23,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_prefers_earlier_batches",
        "to": "Batch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 23,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_prefers_earlier_batches",
        "to": "Batch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 23,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_prefers_earlier_batches",
        "to": "Product",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 23,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_prefers_earlier_batches",
        "to": "OrderLine",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 23,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_prefers_earlier_batches",
        "to": "allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 23,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_returns_allocated_batch_ref",
        "to": "Batch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 37,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_returns_allocated_batch_ref",
        "to": "Batch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 37,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_returns_allocated_batch_ref",
        "to": "OrderLine",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 37,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_returns_allocated_batch_ref",
        "to": "Product",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 37,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_returns_allocated_batch_ref",
        "to": "allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 37,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_outputs_allocated_event",
        "to": "Batch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 46,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_outputs_allocated_event",
        "to": "OrderLine",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 46,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_outputs_allocated_event",
        "to": "Product",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 46,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_outputs_allocated_event",
        "to": "allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 46,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_outputs_allocated_event",
        "to": "Allocated",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 46,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_records_out_of_stock_event_if_cannot_allocate",
        "to": "Batch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 57,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_records_out_of_stock_event_if_cannot_allocate",
        "to": "Product",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 57,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_records_out_of_stock_event_if_cannot_allocate",
        "to": "allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 57,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_records_out_of_stock_event_if_cannot_allocate",
        "to": "OrderLine",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 57,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_records_out_of_stock_event_if_cannot_allocate",
        "to": "allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 57,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_records_out_of_stock_event_if_cannot_allocate",
        "to": "OrderLine",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 57,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_records_out_of_stock_event_if_cannot_allocate",
        "to": "OutOfStock",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 57,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_increments_version_number",
        "to": "OrderLine",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 67,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_increments_version_number",
        "to": "Product",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 67,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_increments_version_number",
        "to": "Batch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 67,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_increments_version_number",
        "to": "allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 67,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_allocating_to_a_batch_reduces_the_available_quantity",
        "to": "Batch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 5,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_allocating_to_a_batch_reduces_the_available_quantity",
        "to": "OrderLine",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 5,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_allocating_to_a_batch_reduces_the_available_quantity",
        "to": "allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 5,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "make_batch_and_line",
        "to": "Batch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 14,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "make_batch_and_line",
        "to": "OrderLine",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 14,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_can_allocate_if_available_greater_than_required",
        "to": "make_batch_and_line",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 21,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_can_allocate_if_available_greater_than_required",
        "to": "can_allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 21,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_cannot_allocate_if_available_smaller_than_required",
        "to": "make_batch_and_line",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 26,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_cannot_allocate_if_available_smaller_than_required",
        "to": "can_allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 26,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_can_allocate_if_available_equal_to_required",
        "to": "make_batch_and_line",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 31,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_can_allocate_if_available_equal_to_required",
        "to": "can_allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 31,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_cannot_allocate_if_skus_do_not_match",
        "to": "Batch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 36,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_cannot_allocate_if_skus_do_not_match",
        "to": "OrderLine",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 36,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_cannot_allocate_if_skus_do_not_match",
        "to": "can_allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 36,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_allocation_is_idempotent",
        "to": "make_batch_and_line",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 42,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_allocation_is_idempotent",
        "to": "allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 42,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_allocation_is_idempotent",
        "to": "allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 42,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_get_by_batchref",
        "to": "sqlite_session_factory",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 8,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_get_by_batchref",
        "to": "SqlAlchemyRepository",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 8,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_get_by_batchref",
        "to": "Batch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 8,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_get_by_batchref",
        "to": "Batch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 8,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_get_by_batchref",
        "to": "Batch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 8,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_get_by_batchref",
        "to": "Product",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 8,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_get_by_batchref",
        "to": "Product",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 8,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_get_by_batchref",
        "to": "add",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 8,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_get_by_batchref",
        "to": "add",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 8,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_get_by_batchref",
        "to": "get_by_batchref",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 8,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_get_by_batchref",
        "to": "get_by_batchref",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 8,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "bus",
        "to": "bootstrap",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 13,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "bus",
        "to": "SqlAlchemyUnitOfWork",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 13,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "bus",
        "to": "EmailNotifications",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 13,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "get_email_from_mailhog",
        "to": "get_email_host_and_port",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 24,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "get_email_from_mailhog",
        "to": "get",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 24,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_out_of_stock_email",
        "to": "random_sku",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 30,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_out_of_stock_email",
        "to": "handle",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 30,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_out_of_stock_email",
        "to": "CreateBatch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 30,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_out_of_stock_email",
        "to": "handle",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 30,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_out_of_stock_email",
        "to": "Allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 30,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_out_of_stock_email",
        "to": "get_email_from_mailhog",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 30,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "sqlite_bus",
        "to": "bootstrap",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 14,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "sqlite_bus",
        "to": "SqlAlchemyUnitOfWork",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 14,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_allocations_view",
        "to": "handle",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 25,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_allocations_view",
        "to": "CreateBatch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 25,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_allocations_view",
        "to": "handle",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 25,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_allocations_view",
        "to": "CreateBatch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 25,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_allocations_view",
        "to": "handle",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 25,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_allocations_view",
        "to": "Allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 25,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_allocations_view",
        "to": "handle",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 25,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_allocations_view",
        "to": "Allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 25,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_allocations_view",
        "to": "handle",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 25,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_allocations_view",
        "to": "CreateBatch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 25,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_allocations_view",
        "to": "handle",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 25,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_allocations_view",
        "to": "Allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 25,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_allocations_view",
        "to": "handle",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 25,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_allocations_view",
        "to": "Allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 25,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_allocations_view",
        "to": "allocations",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 25,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_deallocation",
        "to": "handle",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 41,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_deallocation",
        "to": "CreateBatch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 41,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_deallocation",
        "to": "handle",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 41,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_deallocation",
        "to": "CreateBatch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 41,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_deallocation",
        "to": "handle",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 41,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_deallocation",
        "to": "Allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 41,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_deallocation",
        "to": "handle",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 41,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_deallocation",
        "to": "ChangeBatchQuantity",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 41,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_deallocation",
        "to": "allocations",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 41,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_uow_can_retrieve_a_batch_and_allocate_to_it",
        "to": "sqlite_session_factory",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 40,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_uow_can_retrieve_a_batch_and_allocate_to_it",
        "to": "insert_batch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 40,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_uow_can_retrieve_a_batch_and_allocate_to_it",
        "to": "commit",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 40,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_uow_can_retrieve_a_batch_and_allocate_to_it",
        "to": "SqlAlchemyUnitOfWork",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 40,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_uow_can_retrieve_a_batch_and_allocate_to_it",
        "to": "get",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 40,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_uow_can_retrieve_a_batch_and_allocate_to_it",
        "to": "OrderLine",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 40,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_uow_can_retrieve_a_batch_and_allocate_to_it",
        "to": "allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 40,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_uow_can_retrieve_a_batch_and_allocate_to_it",
        "to": "commit",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 40,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_uow_can_retrieve_a_batch_and_allocate_to_it",
        "to": "get_allocated_batch_ref",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 40,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_rolls_back_uncommitted_work_by_default",
        "to": "SqlAlchemyUnitOfWork",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 56,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_rolls_back_uncommitted_work_by_default",
        "to": "insert_batch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 56,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_rolls_back_uncommitted_work_by_default",
        "to": "sqlite_session_factory",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 56,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_rolls_back_on_error",
        "to": "MyException",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 66,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_rolls_back_on_error",
        "to": "SqlAlchemyUnitOfWork",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 66,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_rolls_back_on_error",
        "to": "insert_batch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 66,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_rolls_back_on_error",
        "to": "MyException",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 66,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_rolls_back_on_error",
        "to": "sqlite_session_factory",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 66,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "try_to_allocate",
        "to": "OrderLine",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 81,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "try_to_allocate",
        "to": "SqlAlchemyUnitOfWork",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 81,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "try_to_allocate",
        "to": "get",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 81,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "try_to_allocate",
        "to": "allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 81,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "try_to_allocate",
        "to": "commit",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 81,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_concurrent_updates_to_version_are_not_allowed",
        "to": "random_sku",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 94,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_concurrent_updates_to_version_are_not_allowed",
        "to": "random_batchref",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 94,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_concurrent_updates_to_version_are_not_allowed",
        "to": "postgres_session_factory",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 94,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_concurrent_updates_to_version_are_not_allowed",
        "to": "insert_batch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 94,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_concurrent_updates_to_version_are_not_allowed",
        "to": "commit",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 94,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_concurrent_updates_to_version_are_not_allowed",
        "to": "random_orderid",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 94,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_concurrent_updates_to_version_are_not_allowed",
        "to": "random_orderid",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 94,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_concurrent_updates_to_version_are_not_allowed",
        "to": "try_to_allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 94,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_concurrent_updates_to_version_are_not_allowed",
        "to": "try_to_allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 94,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_concurrent_updates_to_version_are_not_allowed",
        "to": "SqlAlchemyUnitOfWork",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 94,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "publish_message",
        "to": "publish",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 17,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_happy_path_returns_202_and_batch_is_allocated",
        "to": "random_orderid",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 8,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_happy_path_returns_202_and_batch_is_allocated",
        "to": "random_sku",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 8,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_happy_path_returns_202_and_batch_is_allocated",
        "to": "random_sku",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 8,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_happy_path_returns_202_and_batch_is_allocated",
        "to": "random_batchref",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 8,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_happy_path_returns_202_and_batch_is_allocated",
        "to": "random_batchref",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 8,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_happy_path_returns_202_and_batch_is_allocated",
        "to": "random_batchref",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 8,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_happy_path_returns_202_and_batch_is_allocated",
        "to": "post_to_add_batch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 8,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_happy_path_returns_202_and_batch_is_allocated",
        "to": "post_to_add_batch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 8,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_happy_path_returns_202_and_batch_is_allocated",
        "to": "post_to_add_batch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 8,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_happy_path_returns_202_and_batch_is_allocated",
        "to": "post_to_allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 8,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_happy_path_returns_202_and_batch_is_allocated",
        "to": "get_allocation",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 8,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_unhappy_path_returns_400_and_error_message",
        "to": "random_sku",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 30,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_unhappy_path_returns_400_and_error_message",
        "to": "random_orderid",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 30,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_unhappy_path_returns_400_and_error_message",
        "to": "post_to_allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 30,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_unhappy_path_returns_400_and_error_message",
        "to": "get_allocation",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 30,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_change_batch_quantity_leading_to_reallocation",
        "to": "random_orderid",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 11,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_change_batch_quantity_leading_to_reallocation",
        "to": "random_sku",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 11,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_change_batch_quantity_leading_to_reallocation",
        "to": "random_batchref",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 11,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_change_batch_quantity_leading_to_reallocation",
        "to": "random_batchref",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 11,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_change_batch_quantity_leading_to_reallocation",
        "to": "post_to_add_batch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 11,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_change_batch_quantity_leading_to_reallocation",
        "to": "post_to_add_batch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 11,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_change_batch_quantity_leading_to_reallocation",
        "to": "post_to_allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 11,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_change_batch_quantity_leading_to_reallocation",
        "to": "get_allocation",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 11,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_change_batch_quantity_leading_to_reallocation",
        "to": "subscribe_to",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 11,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "test_change_batch_quantity_leading_to_reallocation",
        "to": "publish_message",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 11,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "post_to_add_batch",
        "to": "get_api_url",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 5,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "post_to_allocate",
        "to": "get_api_url",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 13,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "get_allocation",
        "to": "get_api_url",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 28,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "get_allocation",
        "to": "get",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 28,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "bootstrap",
        "to": "SqlAlchemyUnitOfWork",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 11,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "bootstrap",
        "to": "EmailNotifications",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 11,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "bootstrap",
        "to": "start_mappers",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 11,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "bootstrap",
        "to": "inject_dependencies",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 11,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "bootstrap",
        "to": "inject_dependencies",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 11,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "bootstrap",
        "to": "MessageBus",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 11,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "get_postgres_uri",
        "to": "get",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 4,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "get_postgres_uri",
        "to": "get",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 4,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "get_api_url",
        "to": "get",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 12,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "get_redis_host_and_port",
        "to": "get",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 18,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "get_email_host_and_port",
        "to": "get",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 24,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "AbstractRepository.add",
        "to": "_add",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 11,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "AbstractRepository.get",
        "to": "_get",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 15,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "AbstractRepository.get",
        "to": "add",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 15,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "AbstractRepository.get_by_batchref",
        "to": "_get_by_batchref",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 21,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "AbstractRepository.get_by_batchref",
        "to": "add",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 21,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "SqlAlchemyRepository._add",
        "to": "add",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 45,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "add_batch",
        "to": "get",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 17,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "add_batch",
        "to": "Product",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 17,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "add_batch",
        "to": "add",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 17,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "add_batch",
        "to": "Batch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 17,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "add_batch",
        "to": "commit",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 17,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "allocate",
        "to": "OrderLine",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 30,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "allocate",
        "to": "get",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 30,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "allocate",
        "to": "InvalidSku",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 30,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "allocate",
        "to": "commit",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 30,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "reallocate",
        "to": "allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 43,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "reallocate",
        "to": "Allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 43,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "change_batch_quantity",
        "to": "get_by_batchref",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 50,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "change_batch_quantity",
        "to": "commit",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 50,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "send_out_of_stock_notification",
        "to": "send",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 63,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "publish_allocated_event",
        "to": "publish",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 73,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "add_allocation_to_read_model",
        "to": "commit",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 80,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "remove_allocation_from_read_model",
        "to": "commit",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 95,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "MessageBus.handle",
        "to": "handle_event",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 26,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "MessageBus.handle",
        "to": "handle_command",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 26,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "MessageBus.handle_event",
        "to": "collect_new_events",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 37,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "MessageBus.handle_command",
        "to": "collect_new_events",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 47,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "AbstractUnitOfWork.__exit__",
        "to": "rollback",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 19,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "AbstractUnitOfWork.commit",
        "to": "_commit",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 22,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "SqlAlchemyUnitOfWork.__enter__",
        "to": "SqlAlchemyRepository",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 51,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "SqlAlchemyUnitOfWork._commit",
        "to": "commit",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 60,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "main",
        "to": "bootstrap",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 13,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "main",
        "to": "handle_change_batch_quantity",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 13,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "handle_change_batch_quantity",
        "to": "ChangeBatchQuantity",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 23,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "handle_change_batch_quantity",
        "to": "handle",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 23,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "add_batch",
        "to": "CreateBatch",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 12,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "add_batch",
        "to": "handle",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 12,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "allocate_endpoint",
        "to": "Allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 24,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "allocate_endpoint",
        "to": "handle",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 24,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "allocations_view_endpoint",
        "to": "allocations",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 37,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "Product.allocate",
        "to": "can_allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 15,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "Product.allocate",
        "to": "Allocated",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 15,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "Product.allocate",
        "to": "OutOfStock",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 15,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "Product.change_batch_quantity",
        "to": "deallocate_one",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 33,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "Product.change_batch_quantity",
        "to": "Deallocated",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 33,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "Batch.allocate",
        "to": "can_allocate",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 74,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      },
      {
        "from": "Batch.allocate",
        "to": "add",
        "type": "CALLS",
        "weight": 1.0,
        "confidence": 0.7,
        "file_path": "",
        "line": 74,
        "color": "#00d4ff",
        "dashes": false,
        "arrows": true,
        "metadata": {}
      }
    ];
    const vizMetadata = {};
    /* <!-- DATA_INJECTION_END --> */

    // Safe layer color lookup with fallback
    function getLayerColor(layer) {
      return layerColors[layer] || layerColors['unknown'] || { bg: '#6b7280', border: '#4b5563', icon: '‚ùì' };
    }



    // ==========================================
    // VISUALIZATION ENGINE
    // ==========================================

    let network;
    let nodes;
    let edges;
    let activeFilters = { layers: new Set(), roles: new Set() };
    let currentLayout = 'force';
    let physicsEnabled = false;

    async function initGraph() {
      // Wait for library to load
      try {
        await window.visPromise;
      } catch (e) {
        logToScreen("Failed to wait for vis promise: " + e, "error");
      }

      if (typeof vis === 'undefined') {
        logToScreen("CRITICAL: Vis library object is undefined after load", "error");
        return;
      } else {
        logToScreen("Vis library loaded successfully. Version: " + (vis.version || "unknown"));
      }

      // Kind to shape mapping
      const kindShapes = {
        'class': 'box',
        'method': 'diamond',
        'function': 'ellipse'
      };

      try {
        // Debug: Log first particle
        logToScreen(`Processing ${particles.length} particles...`);
        if (particles.length > 0) {
          const sample = particles[0];
          logToScreen(`Sample node: ${sample.label}, Layer: ${sample.layer}`);
        }

        // Create nodes with rich visual mappings
        nodes = new vis.DataSet(particles.map(p => {
          const layerInfo = getLayerColor(p.layer);

          // Size based on complexity and LOC
          const baseSize = 18;
          const complexityBonus = Math.min((p.complexity || 0) * 2, 15);
          const locBonus = Math.log((p.lines_of_code || 1) + 1) * 3;
          const nodeSize = baseSize + complexityBonus + locBonus;

          // Border width based on connectivity
          const connections = (p.in_degree || 0) + (p.out_degree || 0);
          const borderWidth = Math.min(1 + connections / 3, 6);

          // Opacity based on role confidence
          const confidence = p.role_confidence || 70;
          const opacity = 0.5 + (confidence / 200);

          // Border dashes for LLM-classified nodes
          const borderDashes = p.discovery_method === 'llm' ? [5, 3] : false;

          return {
            id: p.id,
            label: p.label,
            title: `${p.name}\n${p.role} (${Math.round(confidence)}%)\n${p.kind} ‚Ä¢ ${p.lines_of_code} LOC`,
            group: p.layer,
            color: {
              background: layerInfo.bg,
              border: layerInfo.border,
              highlight: { background: '#fff', border: layerInfo.border },
              hover: { background: '#fff', border: layerInfo.border }
            },
            font: {
              color: '#000',
              size: 11,
              face: 'Inter',
              bold: { color: '#000' }
            },
            shape: kindShapes[p.kind] || 'ellipse',
            size: nodeSize,
            borderWidth: borderWidth,
            borderDashes: borderDashes,
            opacity: opacity,
            shadow: {
              enabled: p.is_hotspot,
              size: p.is_hotspot ? 15 : 10,
              color: p.is_hotspot ? 'rgba(239,68,68,0.5)' : 'rgba(0,0,0,0.3)'
            },
            ...p
          };
        }));

        // Create edges with rich visual mappings
        edges = new vis.DataSet(connections.map((c, i) => {
          // Edge styling based on type
          const edgeColor = c.color || '#00d4ff';
          const edgeDashes = c.dashes ? [5, 5] : false;
          const showArrows = c.arrows !== false;
          const edgeWidth = 1 + (c.weight || 1) * 0.5;
          const edgeOpacity = 0.3 + (c.confidence || 1) * 0.4;

          return {
            id: i,
            from: c.from,
            to: c.to,
            label: c.type !== 'CONTAINS' ? c.type : '',
            title: `${c.type}\nWeight: ${c.weight || 1}\nConfidence: ${Math.round((c.confidence || 1) * 100)}%`,
            arrows: { to: { enabled: showArrows, scaleFactor: 0.5 } },
            color: {
              color: edgeColor,
              opacity: edgeOpacity,
              highlight: '#00d4ff',
              hover: '#00d4ff'
            },
            dashes: edgeDashes,
            font: { color: '#666', size: 8, strokeWidth: 0, align: 'middle' },
            smooth: { type: 'curvedCW', roundness: 0.12 },
            width: edgeWidth,
            hoverWidth: edgeWidth + 1
          };
        }));

        // Options
        const options = getLayoutOptions(currentLayout);

        // Create network
        const container = document.getElementById('graph');
        network = new vis.Network(container, { nodes, edges }, options);

        // Event handlers
        network.on('click', handleNodeClick);
        network.on('stabilizationIterationsDone', () => network.fit({ animation: true }));

        updateStats();
        buildFilters();
      } catch (err) {
        logToScreen("CRITICAL ERROR in initGraph: " + err, "error");
        console.error(err);
      }
    }

    function getLayoutOptions(layout) {
      const base = {
        nodes: { borderWidthSelected: 3 },
        edges: { selectionWidth: 3 },
        interaction: {
          hover: true,
          tooltipDelay: 100,
          zoomView: true,
          dragView: true,
          multiselect: true
        },
      };

      switch (layout) {
        case 'hierarchical':
          return {
            ...base,
            layout: {
              hierarchical: {
                direction: 'UD',
                sortMethod: 'hubsize',
                levelSeparation: 100,
                nodeSpacing: 120,
                treeSpacing: 200
              }
            },
            physics: false
          };
        case 'radial':
          return {
            ...base,
            layout: { improvedLayout: true },
            physics: {
              solver: 'repulsion',
              repulsion: { nodeDistance: 200, centralGravity: 0.3 },
              stabilization: { iterations: 150 }
            }
          };
        case 'grid':
          return {
            ...base,
            layout: { improvedLayout: false },
            physics: false
          };
        default: // force
          return {
            ...base,
            layout: { improvedLayout: false },
            physics: {
              enabled: physicsEnabled,
              solver: 'forceAtlas2Based',
              forceAtlas2Based: {
                gravitationalConstant: -80,
                centralGravity: 0.01,
                springLength: 120,
                springConstant: 0.05,
                damping: 0.4
              },
              stabilization: false
            }
          };
      }
    }

    function setLayout(layout) {
      currentLayout = layout;
      document.querySelectorAll('.layout-btn').forEach(b => b.classList.remove('active'));
      event.target.classList.add('active');

      if (layout === 'grid') {
        // Manual grid layout
        const layerOrder = ['Interface', 'App', 'Core', 'Infra', 'Data', 'Tests'];
        const nodesByLayer = {};
        particles.forEach(p => {
          if (!nodesByLayer[p.layer]) nodesByLayer[p.layer] = [];
          nodesByLayer[p.layer].push(p);
        });

        let y = 0;
        layerOrder.forEach(layer => {
          const layerNodes = nodesByLayer[layer] || [];
          layerNodes.forEach((p, i) => {
            nodes.update({ id: p.id, x: i * 150, y: y });
          });
          y += 150;
        });
        network.setOptions({ physics: false });
        network.fit({ animation: true });
      } else {
        network.setOptions(getLayoutOptions(layout));
        if (layout !== 'grid') {
          network.stabilize();
        }
      }
    }

    function handleNodeClick(params) {
      if (params.nodes.length > 0) {
        const nodeId = params.nodes[0];
        const node = nodes.get(nodeId);
        showNodeDetails(node);
      }
    }

    function showNodeDetails(node) {
      const connectedEdges = network.getConnectedEdges(node.id);
      const outgoing = [];
      const incoming = [];

      connectedEdges.forEach(edgeId => {
        const edge = edges.get(edgeId);
        if (edge.from === node.id) {
          const target = nodes.get(edge.to);
          if (target) outgoing.push({ node: target, type: edge.label, edgeType: edge.label });
        } else {
          const source = nodes.get(edge.from);
          if (source) incoming.push({ node: source, type: edge.label, edgeType: edge.label });
        }
      });

      const layerInfo = getLayerColor(node.layer);
      const confidence = Math.round(node.role_confidence || 70);
      const filePath = node.file_path || '';
      const fileName = filePath.split('/').pop() || 'Unknown';
      const lineRange = node.start_line && node.end_line ? `L${node.start_line}-${node.end_line}` : '';

      // Format decorators
      const decorators = (node.decorators || []).map(d => `<span style="background:#a855f7;color:#fff;padding:2px 6px;border-radius:4px;margin-right:4px;font-size:0.7rem;">@${d}</span>`).join('');

      // Format params
      const params = (node.params || []).map(p => p.name || p).join(', ');

      // Format base classes
      const baseClasses = (node.base_classes || []).join(', ');

      // Code preview (limit to 300 chars)
      const codePreview = (node.body_source || '').slice(0, 300);
      const hasMoreCode = (node.body_source || '').length > 300;

      document.getElementById('node-details').innerHTML = `
                <div class="node-detail-header">
                    <div class="node-icon" style="background: ${layerInfo.bg}">
                        ${node.role_icon || layerInfo.icon}
                    </div>
                    <div style="flex:1">
                        <div class="node-title">${node.name || node.label}</div>
                        <div class="node-subtitle">${node.kind} ‚Ä¢ ${node.layer} Layer</div>
                    </div>
                    <div style="text-align:right">
                        <div style="font-size:0.8rem;color:${confidence >= 80 ? '#22c55e' : confidence >= 60 ? '#eab308' : '#ef4444'}">${confidence}%</div>
                        <div style="font-size:0.65rem;color:var(--text-secondary)">${node.discovery_icon || 'üîç'} ${node.discovery_method || 'pattern'}</div>
                    </div>
                </div>
                
                ${decorators ? `<div style="margin-bottom:12px">${decorators}</div>` : ''}
                
                <div class="section-title">Location</div>
                <div style="background:var(--bg-card);border:1px solid var(--border);border-radius:8px;padding:10px;margin-bottom:16px;font-size:0.8rem">
                    <div style="color:var(--accent-cyan);cursor:pointer" title="${filePath}">${fileName} ${lineRange}</div>
                    ${node.signature ? `<div style="font-family:monospace;color:var(--text-secondary);margin-top:6px;font-size:0.75rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${node.signature}</div>` : ''}
                </div>
                
                <div class="section-title">Metrics</div>
                <div class="dimension-grid">
                    <div class="dimension-card">
                        <div class="dimension-label">Role</div>
                        <div class="dimension-value">${node.role_icon || ''} ${node.role}</div>
                    </div>
                    <div class="dimension-card">
                        <div class="dimension-label">Kind</div>
                        <div class="dimension-value">${node.kind}</div>
                    </div>
                    <div class="dimension-card">
                        <div class="dimension-label">Complexity</div>
                        <div class="dimension-value">${node.complexity || 0}</div>
                    </div>
                    <div class="dimension-card">
                        <div class="dimension-label">LOC</div>
                        <div class="dimension-value">${node.lines_of_code || 0}</div>
                    </div>
                    <div class="dimension-card">
                        <div class="dimension-label">In / Out</div>
                        <div class="dimension-value">${node.in_degree || 0} / ${node.out_degree || 0}</div>
                    </div>
                    <div class="dimension-card">
                        <div class="dimension-label">Cost</div>
                        <div class="dimension-value">${node.estimated_cost || 0}</div>
                    </div>
                </div>
                
                ${params ? `
                <div class="section-title">Parameters</div>
                <div style="background:var(--bg-card);border:1px solid var(--border);border-radius:8px;padding:10px;margin-bottom:16px;font-family:monospace;font-size:0.75rem;color:var(--text-secondary)">${params}</div>
                ` : ''}
                
                ${baseClasses ? `
                <div class="section-title">Inherits</div>
                <div style="background:var(--bg-card);border:1px solid var(--border);border-radius:8px;padding:10px;margin-bottom:16px;font-size:0.8rem;color:var(--accent-pink)">${baseClasses}</div>
                ` : ''}
                
                <div class="section-title">Dimensions</div>
                <div class="dimension-grid">
                    <div class="dimension-card">
                        <div class="dimension-label">Boundary</div>
                        <div class="dimension-value">${node.boundary}</div>
                    </div>
                    <div class="dimension-card">
                        <div class="dimension-label">State</div>
                        <div class="dimension-value">${node.state}</div>
                    </div>
                    <div class="dimension-card">
                        <div class="dimension-label">Activation</div>
                        <div class="dimension-value">${node.activation}</div>
                    </div>
                    <div class="dimension-card">
                        <div class="dimension-label">Lifetime</div>
                        <div class="dimension-value">${node.lifetime}</div>
                    </div>
                    <div class="dimension-card">
                        <div class="dimension-label">Effect</div>
                        <div class="dimension-value">${node.effect}</div>
                    </div>
                    <div class="dimension-card">
                        <div class="dimension-label">Time Type</div>
                        <div class="dimension-value">${node.time_type}</div>
                    </div>
                </div>
                
                ${node.is_hotspot ? '<div style="background:#ef4444;color:#fff;padding:8px 12px;border-radius:8px;margin:12px 0;font-size:0.8rem;text-align:center">üî• Performance Hotspot</div>' : ''}
                ${node.is_entry_point ? '<div style="background:#22c55e;color:#fff;padding:8px 12px;border-radius:8px;margin:12px 0;font-size:0.8rem;text-align:center">üöÄ Entry Point</div>' : ''}
                
                ${codePreview ? `
                <div class="section-title">Code Preview</div>
                <pre style="background:var(--bg-card);border:1px solid var(--border);border-radius:8px;padding:10px;font-size:0.7rem;overflow-x:auto;white-space:pre-wrap;color:var(--text-secondary);max-height:150px">${codePreview}${hasMoreCode ? '...' : ''}</pre>
                ` : ''}
                
                ${outgoing.length > 0 ? `
                    <div class="section-title">Outgoing (${outgoing.length})</div>
                    <div class="connection-list">
                        ${outgoing.slice(0, 10).map(c => `
                            <div class="connection-item" onclick="focusNode('${c.node.id}')">
                                <span class="connection-arrow">‚Üí</span>
                                <span>${c.node.label}</span>
                                <span class="connection-type">${c.type || 'CALLS'}</span>
                            </div>
                        `).join('')}
                        ${outgoing.length > 10 ? `<div style="font-size:0.75rem;color:var(--text-secondary);padding:8px">...and ${outgoing.length - 10} more</div>` : ''}
                    </div>
                ` : ''}
                
                ${incoming.length > 0 ? `
                    <div class="section-title">Incoming (${incoming.length})</div>
                    <div class="connection-list">
                        ${incoming.slice(0, 10).map(c => `
                            <div class="connection-item" onclick="focusNode('${c.node.id}')">
                                <span class="connection-arrow">‚Üê</span>
                                <span>${c.node.label}</span>
                                <span class="connection-type">${c.type || 'CALLS'}</span>
                            </div>
                        `).join('')}
                        ${incoming.length > 10 ? `<div style="font-size:0.75rem;color:var(--text-secondary);padding:8px">...and ${incoming.length - 10} more</div>` : ''}
                    </div>
                ` : ''}
            `;
    }

    function focusNode(nodeId) {
      network.selectNodes([nodeId]);
      network.focus(nodeId, { scale: 1.5, animation: true });
      showNodeDetails(nodes.get(nodeId));
    }

    function updateStats() {
      document.getElementById('stat-nodes').textContent = particles.length;
      document.getElementById('stat-edges').textContent = connections.length;
      document.getElementById('stat-layers').textContent = Object.keys(layerColors).length;
      const maxEdges = particles.length * (particles.length - 1);
      const density = ((connections.length / maxEdges) * 100).toFixed(1);
      document.getElementById('stat-density').textContent = density + '%';
    }

    function buildFilters() {
      // Layer filters
      const layerCounts = {};
      particles.forEach(p => {
        layerCounts[p.layer] = (layerCounts[p.layer] || 0) + 1;
      });

      const layerFiltersHtml = Object.entries(layerColors).map(([layer, info]) => `
                <div class="filter-item active" data-layer="${layer}" onclick="toggleFilter('layer', '${layer}', this)">
                    <div class="filter-dot" style="background: ${info.bg}"></div>
                    <span class="filter-label">${layer}</span>
                    <span class="filter-count">${layerCounts[layer] || 0}</span>
                </div>
            `).join('');
      document.getElementById('layer-filters').innerHTML = layerFiltersHtml;

      // Role filters
      const roleCounts = {};
      particles.forEach(p => {
        roleCounts[p.role] = (roleCounts[p.role] || 0) + 1;
      });

      const roleFiltersHtml = Object.entries(roleIcons).map(([role, icon]) => `
                <div class="filter-item active" data-role="${role}" onclick="toggleFilter('role', '${role}', this)">
                    <span>${icon}</span>
                    <span class="filter-label">${role}</span>
                    <span class="filter-count">${roleCounts[role] || 0}</span>
                </div>
            `).join('');
      document.getElementById('role-filters').innerHTML = roleFiltersHtml;
    }

    function toggleFilter(type, value, element) {
      element.classList.toggle('active');
      const set = type === 'layer' ? activeFilters.layers : activeFilters.roles;
      if (set.has(value)) {
        set.delete(value);
      } else {
        set.add(value);
      }
      applyFilters();
    }

    function applyFilters() {
      const activeLayerFilters = document.querySelectorAll('[data-layer].active');
      const activeRoleFilters = document.querySelectorAll('[data-role].active');

      const activeLayers = new Set(Array.from(activeLayerFilters).map(el => el.dataset.layer));
      const activeRoles = new Set(Array.from(activeRoleFilters).map(el => el.dataset.role));

      nodes.forEach(node => {
        const visible = activeLayers.has(node.layer) && activeRoles.has(node.role);
        nodes.update({ id: node.id, hidden: !visible });
      });
    }

    function searchNodes(query) {
      const q = query.toLowerCase();
      nodes.forEach(node => {
        const match = !q || node.label.toLowerCase().includes(q);
        nodes.update({
          id: node.id,
          opacity: match ? 1 : 0.2,
          font: { ...node.font, color: match ? '#000' : '#999' }
        });
      });

      if (q) {
        const matches = particles.filter(p => p.label.toLowerCase().includes(q));
        if (matches.length === 1) {
          focusNode(matches[0].id);
        }
      }
    }

    function fitGraph() {
      network.fit({ animation: { duration: 500 } });
    }

    function togglePhysics() {
      physicsEnabled = !physicsEnabled;
      network.setOptions({ physics: { enabled: physicsEnabled } });
      event.target.classList.toggle('active');
    }

    function exportJSON() {
      const data = {
        particles: particles,
        connections: connections,
        exported_at: new Date().toISOString()
      };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'spectrometer_graph.json';
      a.click();
    }

    // Initialize

    try {
      if (!particles || particles.length === 0) {
        console.warn("No particles data found. Waiting for injection or empty graph.");
      }
      initGraph();
    } catch (e) {
      console.error("Spectrometer Initialization Error:", e);
      document.body.innerHTML = `<div style="color:red; padding:20px; font-family:monospace">
                <h1>Spectrometer Error</h1>
                <p>Failed to initialize visualization.</p>
                <pre>${e.toString()}</pre>
            </div>`;
    }

  </script>
</body>

</html>