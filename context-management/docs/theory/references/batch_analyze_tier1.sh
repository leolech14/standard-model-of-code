#!/bin/bash
# Batch analyze Tier 1 priority references

TIER1="REF-001 REF-040 KOESTLER REF-081 REF-080 REF-025 REF-088 GIBSON REF-119"

echo "=== TIER 1 BATCH ANALYSIS ==="
echo "Processing 9 priority references"
echo ""

completed=0
pending=0

for ref_id in $TIER1; do
    # Check if already analyzed
    if [ -f "metadata/${ref_id}.json" ]; then
        summary=$(python3 -c "import json; m=json.load(open('metadata/${ref_id}.json')); print(m.get('summary', '')[:50])")

        if [[ "$summary" != "[TO BE GENERATED BY LLM]"* ]]; then
            echo "✓ $ref_id (already analyzed)"
            ((completed++))
        else
            echo "⏳ $ref_id (pending)"
            ((pending++))
        fi
    else
        echo "✗ $ref_id (metadata not found)"
    fi
done

echo ""
echo "=== STATUS ==="
echo "Completed: $completed / 9"
echo "Pending:   $pending / 9"
echo ""

if [ $pending -gt 0 ]; then
    echo "To complete remaining:"
    echo "  1. python3 analyze_ref.py <REF-ID>   # Generate prompt"
    echo "  2. Feed to LLM, get JSON"
    echo "  3. Save to metadata/<REF-ID>_analysis.json"
    echo "  4. python3 merge_analysis.py <REF-ID>"
    echo "  5. python3 validate_metadata.py <REF-ID>"
fi
