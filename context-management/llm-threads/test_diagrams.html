<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mermaid Diagram Test</title>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f0f0f0; }
        .diagram-container { background: white; padding: 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        h2 { border-bottom: 2px solid #ddd; padding-bottom: 10px; }
    </style>
</head>
<body>
    <h1>Mermaid Validity Test</h1>
    <p>If you see the diagrams below, the code is VALID and the issue is your VS Code Extensions.</p>

    <!-- UI DRIFT SEQUENCE -->
    <div class="diagram-container">
        <h2>1. UI Drift Sequence</h2>
        <pre class="mermaid">
sequenceDiagram
    participant U as User
    participant OG as output_generator.py
    participant VG as visualize_graph_webgl.py
    participant T as template.html
    participant S as styles.css
    participant J as app.js
    participant B as Browser

    U->>OG: collider full . --output .collider
    OG->>VG: generate_webgl_html(...)
    VG->>T: read template
    VG->>S: read styles
    VG->>J: read app.js
    VG->>VG: inject tokens and payload
    VG-->>U: output HTML file

    U->>B: open HTML
    B->>B: parse DOM from template
    B->>B: execute app.js
    B->>B: getElementById for expected IDs
    alt ID exists in DOM
        B->>B: feature renders
    else ID missing
        B->>B: feature does not render
    end
        </pre>
    </div>

    <!-- UI DRIFT GRAPH -->
    <div class="diagram-container">
        <h2>2. UI Drift Graph</h2>
        <pre class="mermaid">
graph TD
    subgraph TEMPLATE_DOM
        TD1[bottom-dock]
        TD2[full accordion sidebar]
        TD3[hover selection file panels]
        TD4[compatibility block with duplicate IDs]
    end

    subgraph JS_EXPECTS
        JE1[command bar cmd-*]
        JE2[floating panels panel-*]
        JE3[side-dock]
        JE4[oklch-* controls]
        JE5[topo-* and tooltip-*]
        JE6[extra sliders density2 node-size edge-opacity]
    end

    subgraph STYLES
        S1[command bar styles]
        S2[floating panel styles]
        S3[side-dock styles]
        S4[compact bottom dock styles]
    end

    TEMPLATE_DOM -->|renders| R[Visible UI]
    JS_EXPECTS -->|wires| R
    STYLES -->|skins| R

    CONFLICT1[Missing IDs 52]
    CONFLICT2[Duplicate IDs 6]

    JS_EXPECTS --> CONFLICT1
    TEMPLATE_DOM --> CONFLICT2
        </pre>
    </div>

    <!-- UI DRIFT CLASS -->
    <div class="diagram-container">
        <h2>3. UI Drift Class</h2>
        <pre class="mermaid">
classDiagram
    class OutputGenerator
    class VisualizeGraphWebGL
    class TemplateHTML
    class StylesCSS
    class AppJS
    class TokenResolver
    class AppearanceEngine
    class PhysicsEngine
    class ControlsEngine
    class OutputHTML

    OutputGenerator --> VisualizeGraphWebGL : calls
    VisualizeGraphWebGL --> TemplateHTML : reads
    VisualizeGraphWebGL --> StylesCSS : reads
    VisualizeGraphWebGL --> AppJS : reads
    VisualizeGraphWebGL --> AppearanceEngine
    VisualizeGraphWebGL --> PhysicsEngine
    VisualizeGraphWebGL --> ControlsEngine
    AppearanceEngine --> TokenResolver
    PhysicsEngine --> TokenResolver
    ControlsEngine --> TokenResolver
    VisualizeGraphWebGL --> OutputHTML : generates
        </pre>
    </div>

    <!-- UI DRIFT STATE -->
    <div class="diagram-container">
        <h2>4. UI Drift State</h2>
        <pre class="mermaid">
stateDiagram-v2
    [*] --> Legacy_Scattered
    Legacy_Scattered: Old scattered button strip (legacy output)

    Legacy_Scattered --> CommandBar_UI: command bar and floating panels and side dock
    CommandBar_UI: cmd-* + panel-* + side-dock + oklch + topo tooltip

    CommandBar_UI --> Compact_Dock: template regressed to compact bottom dock and full sidebar
    Compact_Dock: bottom-dock + accordion sidebar

    Compact_Dock --> CommandBar_UI: fix template to match JS and CSS
        </pre>
    </div>

</body>
</html>
