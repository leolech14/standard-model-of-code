<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Context Bubble Analysis - PROJECT_elements</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'SF Mono', 'Fira Code', monospace;
            background: linear-gradient(135deg, #0d1117 0%, #161b22 100%);
            color: #c9d1d9;
            min-height: 100vh;
            padding: 2rem;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 {
            color: #58a6ff;
            margin-bottom: 0.5rem;
            font-size: 1.8rem;
        }
        .subtitle { color: #8b949e; margin-bottom: 2rem; }

        .metrics-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .metric-card {
            background: rgba(22, 27, 34, 0.8);
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
        }
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #58a6ff;
        }
        .metric-label { color: #8b949e; font-size: 0.85rem; }
        .metric-card.warning .metric-value { color: #d29922; }
        .metric-card.danger .metric-value { color: #f85149; }
        .metric-card.success .metric-value { color: #3fb950; }

        .section {
            background: rgba(22, 27, 34, 0.6);
            border: 1px solid #30363d;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .section h2 { color: #58a6ff; margin-bottom: 1rem; font-size: 1.2rem; }

        .bubble-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
            padding: 1rem;
        }
        .bubble {
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }
        .bubble:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(88, 166, 255, 0.3);
        }
        .bubble-name { font-weight: bold; font-size: 0.8rem; }
        .bubble-tokens { font-size: 0.7rem; opacity: 0.8; }

        .bar-chart { margin-top: 1rem; }
        .bar-row {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        .bar-label { width: 120px; font-size: 0.85rem; }
        .bar-track {
            flex: 1;
            height: 24px;
            background: #21262d;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }
        .bar-fill {
            height: 100%;
            border-radius: 4px;
            display: flex;
            align-items: center;
            padding-left: 8px;
            font-size: 0.75rem;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }
        .bar-fill.code { background: linear-gradient(90deg, #238636, #3fb950); }
        .bar-fill.schema { background: linear-gradient(90deg, #1f6feb, #58a6ff); }
        .bar-fill.docs { background: linear-gradient(90deg, #8957e5, #a371f7); }
        .bar-fill.viz { background: linear-gradient(90deg, #bf4b8a, #db61a2); }

        .limit-line {
            position: absolute;
            top: 0;
            height: 100%;
            width: 2px;
            background: #f85149;
        }
        .limit-label {
            position: absolute;
            top: -18px;
            font-size: 0.7rem;
            color: #f85149;
            transform: translateX(-50%);
        }

        .combo-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        .combo-card {
            background: #21262d;
            border-radius: 8px;
            padding: 1rem;
        }
        .combo-title {
            color: #58a6ff;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        .combo-tokens {
            font-size: 1.5rem;
            font-weight: bold;
        }
        .combo-tokens.fits { color: #3fb950; }
        .combo-tokens.exceeds { color: #f85149; }
        .combo-items { font-size: 0.8rem; color: #8b949e; margin-top: 0.5rem; }

        .recommendation {
            background: linear-gradient(135deg, #238636 0%, #1a4721 100%);
            border: 1px solid #3fb950;
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1rem;
        }
        .recommendation h3 { color: #3fb950; margin-bottom: 0.5rem; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Context Bubble Analysis</h1>
        <p class="subtitle">PROJECT_elements Token Distribution | Generated 2026-01-22</p>

        <div class="metrics-row">
            <div class="metric-card danger">
                <div class="metric-value">1.52M</div>
                <div class="metric-label">Total Source Tokens</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">1M</div>
                <div class="metric-label">Context Window</div>
            </div>
            <div class="metric-card success">
                <div class="metric-value">500K</div>
                <div class="metric-label">Safe Limit (50%)</div>
            </div>
            <div class="metric-card warning">
                <div class="metric-value">~120K</div>
                <div class="metric-label">Current Usage</div>
            </div>
        </div>

        <div class="section">
            <h2>Context Bubbles (Size = Token Count)</h2>
            <div class="bubble-container">
                <div class="bubble" style="width: 180px; height: 180px; background: linear-gradient(135deg, #238636, #1a4721);">
                    <span class="bubble-name">patterns</span>
                    <span class="bubble-tokens">359K (72%)</span>
                </div>
                <div class="bubble" style="width: 140px; height: 140px; background: linear-gradient(135deg, #8957e5, #6e40aa);">
                    <span class="bubble-name">docs-cm</span>
                    <span class="bubble-tokens">237K (47%)</span>
                </div>
                <div class="bubble" style="width: 135px; height: 135px; background: linear-gradient(135deg, #1f6feb, #0d419d);">
                    <span class="bubble-name">pipeline</span>
                    <span class="bubble-tokens">221K (44%)</span>
                </div>
                <div class="bubble" style="width: 120px; height: 120px; background: linear-gradient(135deg, #bf4b8a, #8b2c5a);">
                    <span class="bubble-name">viz-js</span>
                    <span class="bubble-tokens">172K (34%)</span>
                </div>
                <div class="bubble" style="width: 115px; height: 115px; background: linear-gradient(135deg, #8957e5, #6e40aa);">
                    <span class="bubble-name">docs-smc</span>
                    <span class="bubble-tokens">167K (33%)</span>
                </div>
                <div class="bubble" style="width: 85px; height: 85px; background: linear-gradient(135deg, #bf4b8a, #8b2c5a);">
                    <span class="bubble-name">viz-core</span>
                    <span class="bubble-tokens">83K (17%)</span>
                </div>
                <div class="bubble" style="width: 82px; height: 82px; background: linear-gradient(135deg, #8957e5, #6e40aa);">
                    <span class="bubble-name">specs</span>
                    <span class="bubble-tokens">82K (16%)</span>
                </div>
                <div class="bubble" style="width: 80px; height: 80px; background: linear-gradient(135deg, #1f6feb, #0d419d);">
                    <span class="bubble-name">schema</span>
                    <span class="bubble-tokens">76K (15%)</span>
                </div>
                <div class="bubble" style="width: 55px; height: 55px; background: linear-gradient(135deg, #238636, #1a4721);">
                    <span class="bubble-name">ai-tools</span>
                    <span class="bubble-tokens">40K</span>
                </div>
                <div class="bubble" style="width: 50px; height: 50px; background: linear-gradient(135deg, #238636, #1a4721);">
                    <span class="bubble-name">tests</span>
                    <span class="bubble-tokens">34K</span>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>Token Distribution vs 500K Safe Window</h2>
            <div class="bar-chart">
                <div class="bar-row">
                    <span class="bar-label">patterns</span>
                    <div class="bar-track">
                        <div class="bar-fill schema" style="width: 71.9%">359K</div>
                        <div class="limit-line" style="left: 100%"></div>
                        <span class="limit-label" style="left: 100%">500K</span>
                    </div>
                </div>
                <div class="bar-row">
                    <span class="bar-label">docs-cm</span>
                    <div class="bar-track">
                        <div class="bar-fill docs" style="width: 47.4%">237K</div>
                    </div>
                </div>
                <div class="bar-row">
                    <span class="bar-label">pipeline</span>
                    <div class="bar-track">
                        <div class="bar-fill code" style="width: 44.1%">221K</div>
                    </div>
                </div>
                <div class="bar-row">
                    <span class="bar-label">viz-js</span>
                    <div class="bar-track">
                        <div class="bar-fill viz" style="width: 34.4%">172K</div>
                    </div>
                </div>
                <div class="bar-row">
                    <span class="bar-label">docs-smc</span>
                    <div class="bar-track">
                        <div class="bar-fill docs" style="width: 33.4%">167K</div>
                    </div>
                </div>
                <div class="bar-row">
                    <span class="bar-label">viz-core</span>
                    <div class="bar-track">
                        <div class="bar-fill viz" style="width: 16.6%">83K</div>
                    </div>
                </div>
                <div class="bar-row">
                    <span class="bar-label">schema</span>
                    <div class="bar-track">
                        <div class="bar-fill schema" style="width: 15.3%">76K</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>Optimal Context Combinations</h2>
            <div class="combo-grid">
                <div class="combo-card">
                    <div class="combo-title">FULL CODE (No Patterns/Docs)</div>
                    <div class="combo-tokens fits">~470K ✓</div>
                    <div class="combo-items">pipeline + viz-js + viz-core + schema + classifiers + registry + ai-tools + tests</div>
                </div>
                <div class="combo-card">
                    <div class="combo-title">PIPELINE DEEP DIVE</div>
                    <div class="combo-tokens fits">~410K ✓</div>
                    <div class="combo-items">pipeline + schema + classifiers + registry + ai-tools + tests + specs</div>
                </div>
                <div class="combo-card">
                    <div class="combo-title">VIZ COMPLETE</div>
                    <div class="combo-tokens fits">~330K ✓</div>
                    <div class="combo-items">viz-js + viz-core + pipeline (for data context)</div>
                </div>
                <div class="combo-card">
                    <div class="combo-title">THEORY + IMPL</div>
                    <div class="combo-tokens exceeds">~660K ✗</div>
                    <div class="combo-items">patterns + pipeline + schema (Too big!)</div>
                </div>
            </div>
        </div>

        <div class="recommendation">
            <h3>Recommendation: Create "max_safe" Analysis Set</h3>
            <p>Current sets use only ~24% of safe capacity. Create a new set:</p>
            <pre style="background: #0d1117; padding: 1rem; border-radius: 4px; margin-top: 1rem; overflow-x: auto;">
max_safe:
  description: "Maximum safe context - all code, no patterns/llm-threads"
  max_tokens: 480000
  patterns:
    - "standard-model-of-code/src/core/**/*.py"
    - "standard-model-of-code/src/core/viz/assets/modules/*.js"
    - "standard-model-of-code/src/core/viz/assets/*.html"
    - "standard-model-of-code/src/core/viz/assets/*.css"
    - "standard-model-of-code/schema/**/*.yaml"
    - "standard-model-of-code/tests/*.py"
    - "context-management/tools/**/*.py"
    - "context-management/config/*.yaml"
  exclude:
    - "**/output/**"
    - "**/outputs/**"
    - "**/__pycache__/**"
            </pre>
        </div>

        <div class="section" style="margin-top: 1.5rem;">
            <h2>Key Insight</h2>
            <p style="font-size: 1.1rem; line-height: 1.6;">
                The <strong>patterns/</strong> directory (ATOMS_T*.yaml files) consumes 72% of the safe window alone.
                These are <em>reference data</em>, not active code. By excluding patterns and llm-threads,
                we can fit <strong>all actual source code</strong> (~470K tokens) within the safe window.
            </p>
        </div>
    </div>
</body>
</html>
