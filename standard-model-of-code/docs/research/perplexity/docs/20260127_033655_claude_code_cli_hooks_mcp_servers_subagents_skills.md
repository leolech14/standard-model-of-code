# Research: Claude Code CLI hooks MCP servers subagents skills configuration best practices

> **Date:** 2026-01-27 03:36:55
> **Source:** perplexity-mcp
> **Model:** sonar-pro
> **Checksum:** `sha256:aaba17da06e02bea349d95186733859676681cc204c497ef41545304de5ae16e`
> **Raw JSON:** `raw/20260127_033655_claude_code_cli_hooks_mcp_servers_subagents_skills.json`

---

## Query

Claude Code CLI hooks MCP servers subagents skills configuration best practices

---

## Response

**Claude Code CLI hooks** automate workflows by running shell commands at specific events (e.g., **PreToolUse**, **PostToolUse**) and are configured via the interactive `/hooks` command or JSON files like `~/.claude/settings.json` (global), `.claude/settings.json` (project), or `.claude/settings.local.json` (local, uncommitted).[1][2][3][4]

**MCP servers** are managed with the `/mcp` slash command in Claude Code CLI, which handles connections to Model Context Protocol (MCP) servers for enhanced capabilities like external tools or data access.[5]

**Subagents** trigger hooks such as **SubagentStop** when tasks complete, allowing post-processing like logging or validation alongside main agent events.[3]

**Skills** refer to slash commands (e.g., `/hooks`, `/agents`) and custom configurations that extend Claude Code's functionality, often auto-generated by asking Claude to build project-specific setups.[4][5]

### Configuration Structure
Hooks use this JSON format in settings files:

```json
"hooks": {
  "PostToolUse": [
    {
      "matcher": "Write|Edit",
      "hooks": [
        {
          "type": "command",
          "command": "python -m black .",
          "timeout": 30
        }
      ]
    }
  ]
}
```

- **Matcher**: Specifies triggers (e.g., `"Write(*.py)"` for Python files, `"Bash"` for shell tools, or `*` for all).[3][5]
- Environment variables: `$CLAUDE_PROJECT_DIR` (project root), `$CLAUDE_ENV_FILE` (persist vars), `$CLAUDE_PLUGIN_ROOT` (plugins).[2]
- Reload: Run `/hooks` or restart Claude Code.[1][3]

### Best Practices
- **Start interactive**: Use `/hooks` for beginners to select events, matchers, and commands step-by-step (e.g., log Bash commands with `jq`).[1][3][4]
- **Scope appropriately**: Global for cross-project (e.g., notifications), project-specific for codebases (e.g., auto-format).[1][2][5]
- **Automation examples**:
  | Use Case | Event | Matcher | Command |
  |----------|--------|---------|---------|
  | Auto-format | PostToolUse | Write\|Edit | `prettier --write .`[3][4] |
  | Log commands | PreToolUse | Bash | `jq ... >> log.txt`[3] |
  | Type check | PostToolUse | Write(*.ts) | `tsc --noEmit`[4] |
  | Notifications | Notification | * | `say 'Task complete'`[1] |
- **Advanced**:
  - Block risky actions in **PreToolUse** (e.g., deny prod file edits).[3]
  - Combine with plugins: Hooks merge automatically.[2]
  - Setup hooks: Load context on `--init` via **Setup** event with `additionalContext`.[2]
  - Test: Verify with `/hooks` and trigger events.[3]
- **Enterprise**: Use `allowManagedHooksOnly` policy to restrict user hooks.[2]
- **Avoid pitfalls**: Set timeouts to prevent hangs; use regex matchers precisely; check remote vs. local with `$CLAUDE_CODE_REMOTE`.[2][5]

For full event lifecycles and JSON I/O, consult official docs.[2][6]

---

## Citations

1. https://www.datacamp.com/tutorial/claude-code-hooks
2. https://code.claude.com/docs/en/hooks
3. https://code.claude.com/docs/en/hooks-guide
4. https://www.builder.io/blog/claude-code
5. https://shipyard.build/blog/claude-code-cheat-sheet/
6. https://github.com/karanb192/claude-code-hooks
7. https://docs.gitbutler.com/features/ai-integration/claude-code-hooks
8. https://www.youtube.com/watch?v=CEODfvJLIGQ

---

## Usage Stats

- Prompt tokens: 13
- Completion tokens: 732
- Total tokens: 745
